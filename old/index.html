<!DOCTYPE html>
<html lang="ru" class="splash-open" style="overflow:hidden;">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
  <title>FastInstaller_cloud</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; background-color: #000; color: #fff; }
    select, input, button { font-size: 18px; padding: 10px; margin: 10px; width: 250px; }
    #status { margin-top: 20px; font-weight: bold; min-height: 24px; transition: opacity .5s ease; opacity: 0; position: fixed; top: 10px; left: 0; right: 0; text-align: center; z-index: 1001; }
    #status.visible { opacity: 1; }
    .spin { display: inline-block; animation: spin 1s linear infinite; }
    @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
    #adbScanStatus {
      transition: color .2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    #adbScanStatus .adb-scan-spinner {
      height: 18px;
      width: 18px;
      vertical-align: middle;
      filter: drop-shadow(0 0 2px rgba(0,0,0,0.35));
    }
    #adbScanStatus .adb-scan-spinwrap {
      display: inline-flex;
      align-items: center;
    }
    #adbScanStatus.adb-scan-complete {
      color: #4caf50;
    }

    
    .card-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 20px; }
    .card {
      background-color: #2a2a2a; border-radius: 16px; padding: 20px;
      width: 80px; height: 62px; display: flex; flex-direction: column; align-items: center; justify-content: center;
      color: #fff; font-size: 13px; border: 2px solid transparent; transition: all .2s ease; cursor: pointer;
    }
    .card:hover, .card:focus { background-color: #004d61; border-color: #00cfff; box-shadow: 0 0 10px rgba(0,0,0,.5); outline: none; }
    .card.selected { background-color: #00cfff; color: #000; border: 2px solid #fff; }

    .modal { 
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,.7); 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      z-index: 999; 
      outline: none;
      overscroll-behavior: contain;
      touch-action: none; /* –ë–ª–æ–∫–∏—Ä—É–µ–º touch —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Ñ–æ–Ω–µ –º–æ–¥–∞–ª–∫–∏ */
    }

    .adb-status-indicator {
      font-size: 13px;
      text-align: center;
      margin-top: -6px;
      margin-bottom: 10px;
      color: rgba(255,255,255,0.75);
      transition: color .2s ease;
    }
    .storage-usage-badge {
      font-size: 13px;
      opacity: 0.85;
      margin-left: 6px;
      white-space: nowrap;
    }
    .adb-status-indicator.connected {
      color: #0ff;
      font-weight: 600;
    }
    .modal-header {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: nowrap;
    }
    .modal-header-title {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .modal-content {
      position: relative;
      background: #111;
      color: #fff;
      padding: 20px;
      border-radius: 10px;
      max-height: 80vh;
      overflow: hidden;
      width: 80%;
      border: 1px solid #333;
      touch-action: auto;
      overscroll-behavior: contain;
    }
    .modal-header-tools {
      position: absolute;
      top: -5px;
      right: -5px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      z-index: 6;
    }
    .modal-header-tools button {
      width: 36px;
      height: 36px;
      border: 2px solid transparent;
      background: transparent;
      padding: 4px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      -webkit-tap-highlight-color: transparent;
      transition: border-color .2s ease, box-shadow .2s ease, background-color .2s ease;
    }
    .modal-header-tools button img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }
    .modal-header-tools button:focus,
    .modal-header-tools button:focus-visible,
    .modal-header-tools button:hover,
    .modal-header-tools button:active {
      outline: none !important;
      border-color: #fff;
      box-shadow: 0 0 0 2px rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.08);
      filter: none !important;
    }
    .modal-adb-indicator {
      width: 26px;
      height: 26px;
      border: none;
      background: transparent;
      padding: 0;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      z-index: 5;
      -webkit-tap-highlight-color: transparent;
      appearance: none;
    }
    .modal-adb-indicator:focus-visible {
      outline: none;
    }
    .modal-adb-indicator img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }
    .modal-adb-indicator:hover,
    .modal-adb-indicator:focus,
    .modal-adb-indicator:focus-visible,
    .modal-adb-indicator:active {
      outline: none !important;
      background: transparent !important;
      box-shadow: none !important;
      filter: none !important;
    }

    /* –ö–Ω–æ–ø–∫–∏-–∏–∫–æ–Ω–∫–∏ —É –±–ª–æ–∫–∞ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è */
    #passwordRow .password-row-icon-btn,
    #passwordRow .modal-adb-indicator {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 2px solid transparent;
      padding: 6px;
      background: transparent;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    #passwordRow .password-row-icon-btn img,
    #passwordRow .modal-adb-indicator img {
      height: 30px;
      width: 30px;
      object-fit: contain;
    }
    #passwordRow .password-row-icon-btn:focus,
    #passwordRow .password-row-icon-btn:focus-visible,
    #passwordRow .modal-adb-indicator:focus,
    #passwordRow .modal-adb-indicator:focus-visible {
      outline: none !important;
      border-color: #fff;
      box-shadow: 0 0 0 3px rgba(255,255,255,0.35);
    }

    #adbScannerModal .modal-content {
      max-height: 85vh;
      overflow-y: auto;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
    }

    /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ "–†–∞–∑–Ω–æ–µ" */
    #miscModal .modal-content {
      display: flex;
      flex-direction: column;
      max-height: 80vh;
    }

    #miscModal .misc-buttons-container {
      max-height: 60vh;
      overflow-y: auto;
      overscroll-behavior: contain;
      scroll-behavior: auto;
      scrollbar-gutter: stable both-edges;
      margin-bottom: 20px;
    }

    body.modal-open { 
      overflow: hidden; 
      position: fixed; 
      width: 100%; 
      height: 100%; 
      overscroll-behavior: none; 
    }
    body.splash-open { overflow: hidden; height: 100vh; }
    html.splash-open { overflow: hidden; height: 100vh; }
    body.splash-open > :not(#splash) { display: none !important; }
    html, body { overscroll-behavior: none; }
    html.splash-open::-webkit-scrollbar, body.splash-open::-webkit-scrollbar { width: 0; height: 0; }

    /* –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ –≥—Ä—É–ø–ø */
    #modalListContainer { max-height: 60vh; overflow-y: auto; overscroll-behavior: contain; scroll-behavior: auto; scrollbar-gutter: stable both-edges; }
    #modalList { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; justify-items: center; }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ - 1 –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –ª—É—á—à–µ–π —ç—Å—Ç–µ—Ç–∏–∫–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö */
    @media (orientation: portrait) {
      #modalList { 
        grid-template-columns: 1fr; 
        gap: 12px; 
        max-width: 320px; 
        margin: 0 auto; 
      }
      
      #modalList .component-btn {
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
      }
      
      #installAllBtn {
        width: 100%;
        max-width: 300px;
        margin: 12px auto 0;
      }
    }
    #modalList .component-btn { transition: none !important; }
    #modalList .component-btn:focus,
    #installAllBtn:focus,
    #installAllBtn.selected { background-color: #00cfff; box-shadow: 0 0 0 1px rgba(255, 255, 255, 0) !important; border-color: #fff !important; outline: none; }
    /* –ü–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –æ–±—Ä–µ–∑–∫–∞ –¥–æ 2 —Å—Ç—Ä–æ–∫ */
#modalList .component-btn {
  white-space: normal;
  overflow-wrap: anywhere;   /* –¥–ª—è —Å–ø–ª–æ—à–Ω—ã—Ö —Å—Ç—Ä–æ–∫ */
  word-break: break-word;    /* fallback */
  line-height: 1.25;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;     /* –º–∞–∫—Å–∏–º—É–º 2 —Å—Ç—Ä–æ–∫–∏ */
  line-clamp: 2;             /* —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ */
  overflow: hidden;
  text-overflow: ellipsis;
  min-height: 48px;          /* —á—Ç–æ–±—ã –≤—ã—Å–æ—Ç–∞ –Ω–µ "–ø—Ä—ã–≥–∞–ª–∞" */
  max-height: 48px; 
}
    /* –ö–Ω–æ–ø–∫–∏ –≤ —Å—Ç–∏–ª–µ Google TV */
    button {
      background-color: #004d61; color: #fff; border: 2px solid transparent; border-radius: 8px;
      padding: 10px 20px; font-size: 14px; width: 250px; cursor: pointer;
      transition: background-color .2s ease, box-shadow .2s ease, border-color .2s ease; box-sizing: border-box;
    }
    button:hover { background-color: #00cfff; }
    button:focus { outline: none; border-color: #fff; box-shadow: 0 0 10px #004d61; }

    .system-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 12px; }
    .sys-btn {
      flex: 1 1 calc(33.33% - 20px); min-width: 100px; max-width: 240px; padding: 10px; font-size: 13px; text-align: center;
      background-color: #004d61; color: #fff; border: 2px solid transparent; border-radius: 10px; cursor: pointer; transition: background-color .3s ease;
    }
    .sys-btn:hover { background-color: #00cfff; }
    .sys-btn:focus {
      border-color: #fff;
      box-shadow: 0 0 10px #004d61;
    }
    #mainSystemButtons .sys-btn:focus {
      background-color: #00cfff;
      color: #000;
      border-color: #fff;
      box-shadow: 0 0 10px #004d61;
    }
    /* –í –º–æ–¥–∞–ª–∫–µ "–†–∞–∑–Ω–æ–µ" –æ—Ç–∫–ª—é—á–∞–µ–º hover, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –ø–æ–¥—Å–≤–µ—Ç–∫–µ –ø–æ —Ñ–æ–∫—É—Å—É */
    #miscModal .sys-btn { background-color: #004d61; color:#fff; }
    #miscModal .sys-btn:hover { background-color: #004d61; }

    /* ATV —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π */
    .app-filters { display:flex; flex-wrap:wrap; justify-content:center; gap:8px; margin:8px 0 12px; }
    .app-filters .sys-btn {
      min-width: 92px;
      max-width: 140px;
      padding: 8px;
      font-size: 12px;
      background: #10131A;
      border: 1px solid #1f3a5a;
      color: #e8f0ff;
    }
    .app-filters .sys-btn.active,
    .app-filters .sys-btn:focus {
      background: #10131A;
      border-color: #3fa9f5;
      color: #fff;
    }
    .apps-list { display:flex; flex-direction:column; gap:8px; }
    .app-row {
      display:flex; gap:12px; align-items:flex-start; padding:10px 12px;
      background:#10131A; border-radius:14px; border:1px solid #1f3a5a;
      box-shadow: 0 4px 10px rgba(0,0,0,0.28);
    }
    .app-row:hover { background:#152b45; }
    .app-icon { width:42px; height:42px; border-radius:10px; object-fit:contain; background:#101316; padding:6px; }
    .app-meta { display:flex; flex-direction:column; gap:4px; overflow:hidden; align-items:flex-start; width:100%; text-align:left; }
    .app-title { font-weight:700; font-size:15px; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; width:100%; text-align:left; }
    .app-sub { font-size:12px; color:rgba(255,255,255,0.85); overflow:hidden; text-overflow:ellipsis; display:flex; justify-content:space-between; align-items:flex-start; flex-wrap:nowrap; width:100%; gap:8px; text-align:left; }
    .app-badge { display:inline-flex; align-items:center; gap:4px; padding:2px 8px; border-radius:20px; font-size:11px; font-weight:700; text-transform:uppercase; margin-left:12px; white-space:nowrap; background:#d0a447; color:#0b1d25; }
    .badge-user { background:#2abf6d; color:#0b1d25; }
    .badge-system { background:#7e6735; color:#e2e3e4; }
    /* –ö–Ω–æ–ø–∫–∏ –≤ —Ö–µ–¥–µ—Ä–µ –º–æ–¥–∞–ª–∫–∏ ATV ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–µ —Å—Ç–∏–ª–∏ modal-header-tools/modal-quick-action */
    #atvAppsModal .modal-header-tools { right: -8px; top: -5px; gap: 1px; }
    #atvAppsModal #atvAppsHeader { margin-top: 6px; margin-bottom: 6px; }
    #atvAppsModal .modal-content { max-height: 90vh; }
    #atvAppsModal .atv-loading { display:flex; flex-direction:column; align-items:center; gap:8px; padding:20px; opacity:0.9; }
    #atvAppsModal .atv-loading .spin { display:inline-flex; align-items:center; justify-content:center; animation: spin 1s linear infinite; transform-origin:center; }
    #atvAppsModal .atv-loading img { height:40px; width:40px; display:block; }
    .app-state { font-size:12px; color:#ffc107; }

    /* –ú–æ–¥–∞–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é ATV */
    #atvAppActionsModal .sys-btn {
      background: #10131A;
      border: 1px solid #1f3a5a;
      color: #e8f0ff;
    }
    #atvAppActionsModal .sys-btn:hover,
    #atvAppActionsModal .sys-btn:focus,
    #atvAppActionsModal .sys-btn.selected {
      background: #10131A;
      border-color: #3fa9f5;
      color: #fff;
    }
    #miscModal .sys-btn:focus {
      background-color: #00cfff; color:#000;
       border: 2px solid #fff;
    }
    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –≤ –º–æ–¥–∞–ª–∫–µ "–†–∞–∑–Ω–æ–µ" */
    #miscModal .sys-btn.selected { background-color: #00cfff; color: #000; border: 2px solid #fff; }
    
    /* –í –º–æ–¥–∞–ª–∫–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏" –æ—Ç–∫–ª—é—á–∞–µ–º hover, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –ø–æ–¥—Å–≤–µ—Ç–∫–µ –ø–æ —Ñ–æ–∫—É—Å—É */
    #miscMoreModal .sys-btn { background-color: #004d61; color:#fff; }
    #miscMoreModal .sys-btn:hover { background-color: #004d61; }
    #miscMoreModal .sys-btn:focus {
      background-color: #00cfff; color:#000;
      border: 2px solid #fff;
    }
    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –≤ –º–æ–¥–∞–ª–∫–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏" */
    #miscMoreModal .sys-btn.selected { background-color: #00cfff; color: #000; border: 2px solid #fff; }
    
    /* === –°–ö–ê–ù–ï–† ADB === */
    #adbScanListContainer {
      max-height: 60vh;
      overflow-y: auto;
      overscroll-behavior: contain;
      scroll-behavior: auto;
      scrollbar-gutter: stable both-edges;
      touch-action: pan-y;
      -ms-touch-action: pan-y;
      -webkit-overflow-scrolling: touch;
    }
    #adbScanList {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 360px;
      width: 100%;
      margin: 0 auto;
      align-items: center;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ADB */
    .adb-chip {
      width: min(86vw, 288px) !important;
      max-width: 288px;
      min-height: 48px;
      padding: 8px 12px;
      margin: 0 auto;
      border-radius: 12px;
      border: 2px solid transparent;
      background-color: #004d61;
      color: #fff;
      display: inline-flex;
      flex-direction: column;
      gap: 2px;
      align-items: center;
      justify-content: center;
      text-align: center;
      box-shadow: 0 5px 10px rgba(0,0,0,0.35);
      cursor: pointer;
      transition: transform .15s ease, box-shadow .2s ease, background-color .2s ease, border-color .2s ease;
      line-height: 1.2;
      appearance: none;
      box-sizing: border-box;
    }
    .adb-chip:focus,
    .adb-chip:focus-visible {
      outline: none;
      transform: translateY(-2px);
      background-color: #00cfff;
      color: #000;
      border-color: #fff;
      box-shadow: 0 16px 24px rgba(0,0,0,0.4);
    }
    .adb-chip.has-selected-style {
      transform: translateY(-2px);
      background-color: #00cfff;
      color: #000;
      border-color: #fff;
      box-shadow: 0 16px 24px rgba(0,0,0,0.4);
    }
    
    .adb-device-card {
      border-radius: 16px;
    }
    
    .adb-device-name {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 2px;
      color: inherit;
      text-align: center;
      width: 100%;
    }

    .adb-device-name--placeholder {
      opacity: .65;
      font-style: italic;
    }
    
    .adb-device-ip {
      font-size: 13px;
      font-weight: 500;
      margin: 0;
      opacity: .85;
      text-align: center;
      width: 100%;
      color: inherit;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–∞–Ω–µ—Ä–æ–º */
    #adbScannerModal .sys-btn { background-color: #004d61; color: #fff; }
    #adbScannerModal .sys-btn:hover { background-color: #004d61; }
    #adbScannerModal .sys-btn:focus {
      background-color: #00cfff;
      color: #000;
      border: 2px solid #fff;
    }
    #adbScannerModal .sys-btn.selected { background-color: #00cfff; color: #000; border: 2px solid #fff; }

    .adb-last-connection {
      display: none;
      margin-bottom: 16px;
      text-align: center;
    }
    .adb-last-connection.active {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 8px;
    }
    .adb-last-connection-title {
      font-size: 13px;
      opacity: .8;
      margin-bottom: 6px;
    }
    .adb-last-connection-btn-line1 {
      display: block;
      font-weight: 600;
      font-size: 15px;
    }
    .adb-last-connection-btn-line2 {
      display: block;
      font-size: 13px;
      opacity: .85;
    }
    

    #splash { position: fixed; inset: 0; background-color: #000; display: flex; justify-content: center; align-items: center; z-index: 9999; }
     #logo { position: fixed; inset: 0; z-index: 9999; background-repeat: no-repeat; background-position: center; background-size: cover; }

    /* –¢–æ—Å—Ç—ã */
    .toast {
      display: inline-flex; align-items: center; gap: 8px; box-sizing: border-box; background: rgba(0,0,0,.85); color: #fff;
      border-radius: 10px; padding: 12px 18px; font-size: 14px; line-height: 1.3; max-width: min(70vw,720px);
      white-space: normal; overflow-wrap: anywhere; word-break: break-word; opacity: 0; transform: translateY(8px);
      transition: opacity .25s ease, transform .25s ease; pointer-events: auto;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast--pill { border-radius: 999px; padding: 10px 16px; }
    .toast--compact { padding: 8px 12px; font-size: 16px; }
    .toast--card { box-shadow: 0 8px 24px rgba(0,0,0,.35); }
    .toast .spin { display:inline-block; animation: spin 1s linear infinite; }
    .toast-stack { position: fixed; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
    .toast-stack--top{ top: 40px; } .toast-stack--bottom{ bottom: 40px; } .toast-stack--center{ top: 50%; transform: translateY(-50%); }
    .toast-stack--left{ left: 40px; align-items: flex-start; } .toast-stack--centerX{ left: 50%; transform: translateX(-50%); align-items: center; }
    .toast-stack--right{ right: 40px; align-items: flex-end; }
    .toast--anchored { position: fixed; z-index: 10000; }

    /* === –ê–í–¢–û–ó–ê–ü–£–°–ö === */
    #autostartListContainer { max-height: 60vh; overflow-y: auto; overscroll-behavior: contain; scroll-behavior: auto; scrollbar-gutter: stable both-edges; }
    #autostartList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —à–∏—Ä–∏–Ω–µ –º–æ–¥–∞–ª–∫–∏ */
      gap: 10px;
      justify-items: center;
    }
    #autostartList .card { transition: none !important; }
    #autostartList .card:focus { box-shadow: 0 0 0 3px rgba(255,255,255,.6) !important; border-color: #fff !important; outline: none; }
    /* –û—Ç–∫–ª—é—á–∞–µ–º hover –≤ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–µ, —á—Ç–æ–±—ã –º—ã—à—å –Ω–µ –¥–∞–≤–∞–ª–∞ "–ª–æ–∂–Ω—É—é" –ø–æ–¥—Å–≤–µ—Ç–∫—É */
    #autostartList .card:hover { background-color: #2a2a2a; border-color: transparent; box-shadow: none; }
    #autostartList .card.selected:hover { background-color: #00cfff; color:#000; border: 2px solid #fff; }

    /* –°–¥–µ–ª–∞–µ–º ¬´–ó–∞–∫—Ä—ã—Ç—å¬ª –≤–∏–¥–∏–º–æ–π –∫–∞–∫ "–Ω–∏–∑ —Å–ø–∏—Å–∫–∞" */
    #autostartCloseBtn { margin: 12px auto 0; width: 100%; max-width: 320px; }


     /* –ö—Ä–∞—Å–∏–º –∏–º—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è*/
  .app-name {
    color: #00cfff;       /* –æ—Ç—Ç–µ–Ω–æ–∫ –±–∏—Ä—é–∑–æ–≤–æ–≥–æ, –∫–∞–∫ —É –∫–Ω–æ–ø–æ–∫ */
    font-weight: 700;
  }

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–∞–∫ –º–æ–¥–∞–ª–∫–∞ "–†–∞–∑–Ω–æ–µ") */
#installMethodModal {
  z-index: 1000 !important; /* –í—ã—à–µ —á–µ–º —É –º–æ–¥–∞–ª–∫–∏ "–†–∞–∑–Ω–æ–µ" (999) */
}

#installMethodModal .modal-content {
  display: flex;
  flex-direction: column;
  max-height: 96vh;
  overflow: hidden;
}

#installMethodModal .install-method-settings {
  max-width: 560px;         /* —Å–ø–∏—Å–æ–∫ —É–∂–µ, –Ω–µ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —ç–∫—Ä–∞–Ω–∞ */
  margin: 0 auto;
  max-height: 72vh;
  overflow-y: auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  padding-right: 6px;
}

#miscMoreModal .modal-content {
  display: flex;
  flex-direction: column;
  max-height: 80vh;
}

#miscMoreModal .misc-buttons-container {
  max-height: 60vh;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: auto;
  scrollbar-gutter: stable both-edges;
  margin-bottom: 20px;
}

#installMethodModal .method-option {
  margin: 12px 0;
  padding: 14px 18px;
  border: 2px solid #333;
  border-radius: 14px;
  cursor: pointer;
  transition: all 0.25s ease;
  display: grid;
  grid-template-columns: auto 1fr;
  column-gap: 14px;
  align-items: center;
  background: #141414;
  position: relative;
}
#installMethodModal .method-option strong {
  font-size: 1rem;
}
#installMethodModal .method-option small {
  display: block;
  margin-top: 4px;
  line-height: 1.3;
}
/* –£–ø–ª–æ—Ç–Ω—è–µ–º –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ä–∞–¥–∏–æ-–æ–ø—Ü–∏–∏ */

/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–æ–¥–∞–ª–∫–∏ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
@media (orientation: portrait) {
  #installMethodModal .modal-content {
    max-height: 96vh;
    width: 92%;
    padding: 18px 16px;
  }
  
  #installMethodModal .install-method-settings {
    max-width: 100%;
    margin: 0;
    max-height: 78vh;
    padding-right: 4px;
  }
}

@media (max-width: 1100px) {
  #installMethodModal .modal-content {
    width: 92%;
    padding: 22px 18px 20px;
    border-radius: 22px;
  }

  #installMethodModal .install-method-settings {
    max-width: 100%;
    margin: 0;
    max-height: 74vh;
    padding-right: 4px;
  }

  #installMethodModal h3 {
    text-align: center;
    font-size: 1.18rem;
    margin-bottom: 16px;
  }

  #installMethodModal .method-option {
    grid-template-columns: 1fr;
    row-gap: 10px;
    text-align: center;
    justify-items: center;
    padding: 16px 14px;
  }

  #installMethodModal .method-option input[type="radio"] {
    transform: scale(1.4);
  }

  #installMethodModal .method-option label {
    text-align: center;
  }

  #installMethodModal .method-option strong {
    font-size: 1.1rem;
  }

  #installMethodModal .method-option small {
    font-size: .92rem;
    line-height: 1.4;
  }

  #installMethodModal .sys-btn {
    max-width: 100%;
  }
}


#installMethodModal .method-option:focus {
  border-color: #00cfff;
  background-color: rgba(0, 207, 255, 0.1);
  outline: none;
}

#installMethodModal .method-option input[type="radio"] {
  margin: 0;
  transform: scale(1.2);
  flex-shrink: 0;
  pointer-events: none; /* –Ω–µ –¥–∞—ë–º —Ñ–æ–∫—É—Å—É/–∫–ª–∏–∫—É —É—Ö–æ–¥–∏—Ç—å –≤ –∫—Ä—É–∂–æ–∫ */
  opacity: 1;
}

#installMethodModal .method-option label {
  margin-left: -5px;
  cursor: pointer;
  display: block;
  margin: 0;
  flex: 1;
}

#installMethodModal .method-option label small {
  color: #d0d0d0;
  transition: color 0.2s ease;
}

#installMethodModal .method-option.selected label small {
  color: #4caf50;
}

/* –ú–æ–¥–∞–ª–∫–∞ ADB-–∫–æ–º–∞–Ω–¥ */
#adbCommandsModal .modal-content {
  max-width: 640px;
  width: 90%;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

#adbCommandsListContainer {
  max-height: 70vh;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: auto;
  scrollbar-gutter: stable both-edges;
}

#adbCommandsList {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 12px;
  justify-items: center;
}

.adb-command-btn {
  width: 100%;
  max-width: 280px;
  min-height: 64px;
  background: #10131A;
  color: #e8f0ff;
  border: 1px solid #1f3a5a;
  border-radius: 12px;
  padding: 12px;
  display: flex;
  align-items: center;
  gap: 12px;
  text-align: left;
  cursor: pointer;
  transition: background-color .2s ease, border-color .2s ease, box-shadow .2s ease;
}

.adb-command-btn:hover,
.adb-command-btn:focus,
.adb-command-btn.selected {
  background: #10131A;
  border-color: #3fa9f5;
  color: #fff;
  box-shadow: none;
  outline: none;
}

.adb-command-btn__icon {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: rgba(0,0,0,0.2);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.adb-command-btn__icon img {
  max-width: 28px;
  max-height: 28px;
  object-fit: contain;
}

.adb-command-btn__text {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.adb-command-btn__label {
  font-weight: 400;
  font-size: 13px;
}

.adb-command-btn__command {
  font-size: 11px;
  opacity: .8;
  word-break: break-all;
}

#adbCommandsEmpty {
  text-align: center;
  opacity: .75;
  padding: 20px 0;
}

#adbCommandsCloseBtn {
  margin: 16px auto 0;
  width: min(280px, 90%);
  background: #10131A;
  border: 1px solid #1f3a5a;
  color: #e8f0ff;
}
#adbCommandsCloseBtn:hover,
#adbCommandsCloseBtn:focus {
  background: #10131A;
  border-color: #3fa9f5;
  color: #fff;
  box-shadow: none;
}

#screenSaverModal .modal-content {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: min(640px, 92vw);
  max-height: 85vh;
  overflow: hidden;
}

#screenSaverModal .screen-saver-body {
  display: flex;
  flex-direction: column;
  gap: 16px;
  max-height: 70vh;
  overflow-y: auto;
  overscroll-behavior: contain;
  scrollbar-gutter: stable both-edges;
}

#screenSaverModal .screen-saver-body {
  display: flex;
  flex-direction: column;
  gap: 16px;
  max-height: 70vh;
  overflow-y: auto;
  overscroll-behavior: contain;
  scrollbar-gutter: stable both-edges;
}

.screen-saver-section {
  background: rgba(255,255,255,0.04);
  border-radius: 14px;
  padding: 14px;
  border: 1px solid rgba(255,255,255,0.08);
}

.screen-saver-section h4 {
  margin: 0 0 8px;
  font-size: 15px;
  color: #00cfff;
}

.screen-saver-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.screen-saver-row label {
  font-size: 14px;
  opacity: .85;
}

.screen-saver-value {
  font-weight: 600;
  font-size: 15px;
}

.screen-saver-actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  justify-content: center;
  align-items: center;
}

.screen-saver-actions .sys-btn {
  width: min(340px, 100%);
}

.screen-saver-action-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  text-align: left;
}

.screen-saver-action-btn img {
  display: block;
  height: 20px;
  width: auto;
}

.screen-saver-cta {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

#screenSaverTimeoutModal .modal-content {
  max-width: 400px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.screen-saver-timeout-body {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.screen-saver-timeout-field {
  display: flex;
  flex-direction: column;
  gap: 6px;
  text-align: left;
}

.screen-saver-timeout-field label {
  font-size: 13px;
  opacity: .85;
}

#screenSaverTimeoutInput {
  width: 100%;
  box-sizing: border-box;
  padding: 10px 12px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 10px;
  background: rgba(255,255,255,0.05);
  color: #fff;
  font-size: 18px;
  text-align: center;
}

.screen-saver-step-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.screen-saver-step {
  flex: 1 1 calc(33% - 8px);
  min-width: 90px;
  width: auto;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.2);
  background: rgba(0,77,97,0.5);
  color: #fff;
  text-align: center;
  font-weight: 600;
  transition: background .2s ease, border-color .2s ease;
}

.screen-saver-step:focus,
.screen-saver-step:hover {
  background-color: #00cfff;
  color: #000;
  border-color: #fff;
  outline: none;
}

.screen-saver-timeout-hint {
  font-size: 12px;
  opacity: 0.7;
  text-align: left;
}

    
    /* –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ */
    html {
      -webkit-text-size-adjust: 100% !important;
      -moz-text-size-adjust: 100% !important;
      -ms-text-size-adjust: 100% !important;
      text-size-adjust: 100% !important;
      font-size: 16px !important; /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä */
    }

    body {
      font-size: 1rem !important; /* –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ html */
      -webkit-text-size-adjust: none !important;
      -moz-text-size-adjust: none !important;
      -ms-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    *, *::before, *::after {
      -webkit-text-size-adjust: none !important;
      -moz-text-size-adjust: none !important;
      -ms-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    /* –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ */
    select, input, button {
      font-size: 18px !important; /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
      -webkit-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    .card {
      font-size: 13px !important;
      -webkit-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    .sys-btn {
      font-size: 13px !important;
      -webkit-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    button {
      font-size: 14px !important;
      -webkit-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }
    
  </style>
</head>

<body style="margin:0; padding:0;" class="splash-open">
  <div id="splash"><div id="logo"></div></div>
  <div id="main-content" style="display:none;"></div>

   <script>
  (function(){
    const logo = document.getElementById('logo');
    if (!logo) return;
    const LAND = "url('https://appassets.androidplatform.net/assets/webview/logo/usr.gif')";
    const PORT = "url('https://appassets.androidplatform.net/assets/webview/logo/usrPort.gif')";
    const mql = window.matchMedia('(orientation: portrait)');
    function apply() { logo.style.backgroundImage = mql.matches ? PORT : LAND; }
    apply();
    if (mql.addEventListener) mql.addEventListener('change', apply);
    else if (mql.addListener) mql.addListener(apply);
    window.addEventListener('orientationchange', apply);
  })();
  </script>

  <h5 style="margin:0 0 2px; display:inline-flex; align-items:center; gap:4px;">
  <img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_launcher_round.png" alt="" style="height:18px; width:18px; object-fit:contain;">
  FastInstaller
</h5>
  <div id="adbStatusIndicator" class="adb-status-indicator">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ADB‚Ä¶</div>

  <div id="progress-container" style="display:none; width:100%; background:#000; padding:5px; z-index:1002; position:fixed; bottom:0; left:0; right:0;">
    <div id="progress-text" style="color:#fff; margin-bottom:5px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div style="width:100%; background:#000; height:8px; border-radius:6px;">
      <div id="progress-bar" style="height:8px; width:0%; background:#42A5F5; border-radius:6px;"></div>
    </div>
  </div>

  <div class="card-container" id="groupCards"></div>

  <script>
    // Enter/OK –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
    document.addEventListener('keydown', function (e) {
      const isOk = e.key === 'Enter' || e.key === 'NumpadEnter' || e.key === 'OK' || e.code === 'Enter';
      if (!isOk) return;
      if (anyModalOpen()) return;

      const selected = document.querySelector('.card.selected');
      if (!selected) return;
      currentGroup = selected.dataset.group;
      startInstall();
    });
  </script>

  <select id="groupSelect" style="display:none;"></select>
  <div id="passwordRow" style="display:flex;align-items:center;justify-content:center;gap:-8px;margin:8px 0;">
    <button class="password-row-icon-btn" onclick="ignoreNextEnter=true;openAdbScanner()" title="–ö –¥—Ä—É–≥–æ–º—É (RSA)" aria-label="–ö –¥—Ä—É–≥–æ–º—É (RSA)">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/network/ic_ADB_scan.png" alt="" loading="lazy">
    </button>

    <button type="button" id="passwordBtn">üîë –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</button>

    <button class="modal-adb-indicator adb-status-icon" onclick="reconnectLastAdbFromChip(event)" title="–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É ADB" aria-label="–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É ADB">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic10_updWebView.png" alt="" loading="lazy">
    </button>
  </div>
  <div id="status"></div>

  <div class="system-buttons" id="mainSystemButtons">
    <button onclick="event.stopPropagation();window.AndroidInterface.openUnknownSources()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic1_unknow.png" alt="" style="height:30px;"><br>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAppSettingsList()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic2_appsSettings.png" alt="" style="height:28px;"><br>–í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    </button>
    <button onclick="openAtvAppsModalFast(this)" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic2_appsSettings.png" alt="" style="height:28px;"><br>–ü–∞–∫–µ—Ç—ã
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAccessibilitySettings()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic3_accessibility.png" alt="" style="height:28px;"><br>–°–ø–µ—Ü –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openBatteryOptimization()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic4_allSettings.png" alt="" style="height:28px;"><br>–û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openFileManagerPlus()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic5_FileManagerPlus.png" alt="" style="height:25px;"><br>File Manager
    </button>
    <button onclick="openMiscModal(this)" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic_launcher_round.png" alt="" style="height:30px;"><br>FastInstaller+
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAllAppsSide()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic7_appsdriver.png" alt="" style="height:28px;"><br>–ú–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
          </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAnydesk()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic8_anydesk.png" alt="" style="height:28px;"><br>AnyDesk
    </button>
    <button onclick="AndroidInterface.updateWebView()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic10_updWebView.png" alt="" style="height:28px;"><br>–û–±–Ω–æ–≤–∏—Ç—å AndroidWebView
    </button>
    <button onclick="ignoreNextEnter=true;showDeviceStats()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic20_ATV.png" alt="" style="height:28px;"><br>CPU / RAM / Storage
    </button>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ -->
  <div id="autostartModal" class="modal" style="display:none;">
    <div class="modal-content">
      <div id="autostartCurrent" style="margin-bottom:10px; font-weight:bold;">–í—ã–±—Ä–∞–Ω–æ: –ù–µ—Ç</div>
      <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:</h3>
      <button onclick="disableAutostart()" class="sys-btn">üö´ –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫</button>
      <button onclick="ignoreNextEnter=true;window.AndroidInterface.testAutostart()" class="sys-btn">üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞</button>

      <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –°–û –°–ö–†–û–õ–õ–û–ú (–∏ –∑–¥–µ—Å—å –∂–µ –∫–Ω–æ–ø–∫–∞ –ó–∞–∫—Ä—ã—Ç—å) -->
      <div id="autostartListContainer">
        <div id="autostartList"></div>
        <button id="autostartCloseBtn" onclick="closeAutostartModal()">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π Android TV -->
  <div id="atvAppsModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <div class="modal-header-tools" style="justify-content:flex-end;">
        <button class="modal-adb-indicator" onclick="refreshAtvAppsList('remote')" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫">
          <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic10_updWebView.png" alt="Refresh" loading="lazy">
        </button>
      </div>
      <h3 id="atvAppsHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:4px;margin-top:0;font-size:1.1rem;">
        <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic20_ATV.png" alt="" style="height:22px;">
        –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è Android TV
      </h3>
      <div class="app-filters" id="atvAppsFilters" style="margin-bottom:6px;display:flex;gap:4px;justify-content:center;flex-wrap:wrap;">
        <button class="sys-btn" style="min-width:70px; padding:6px 8px; font-size:11px;" data-filter="all" onclick="setAtvAppsFilter('all')">–í—Å–µ</button>
        <button class="sys-btn" style="min-width:70px; padding:6px 8px; font-size:11px;" data-filter="user" onclick="setAtvAppsFilter('user')">–°—Ç–æ—Ä–æ–Ω–Ω–∏–µ</button>
        <button class="sys-btn" style="min-width:70px; padding:6px 8px; font-size:11px;" data-filter="system" onclick="setAtvAppsFilter('system')">–°–∏—Å—Ç–µ–º–Ω—ã–µ</button>
        <button class="sys-btn" style="min-width:70px; padding:6px 8px; font-size:11px;" data-filter="disabled" onclick="setAtvAppsFilter('disabled')">–û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ</button>
        <button class="sys-btn" style="min-width:70px; padding:6px 8px; font-size:11px;" data-filter="deleted" onclick="setAtvAppsFilter('deleted')">–£–¥–∞–ª–µ–Ω–Ω—ã–µ</button>
        <button class="sys-btn" style="min-width:70px; padding:6px 8px; font-size:11px;" data-filter="system_launchable" onclick="setAtvAppsFilter('system_launchable')">–°–∏—Å—Ç –æ—Ç–∫—Ä</button>
      </div>

      <div id="atvAppsContainer" style="max-height:calc(90vh - 160px);overflow-y:auto;overscroll-behavior:contain;scrollbar-gutter:stable both-edges;margin-bottom:4px;padding-right:4px;padding-bottom:24px;-webkit-overflow-scrolling:touch;">
        <div id="atvAppsList" class="apps-list"></div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é -->
  <div id="atvAppActionsModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="atvAppActionsTitle" style="display:flex;align-items:center;gap:8px;">–î–µ–π—Å—Ç–≤–∏—è</h3>
      <div id="atvAppActionsInfo" style="font-size:13px; opacity:0.8; margin-bottom:10px;"></div>
      <div class="system-buttons" id="atvAppActionsButtons" style="justify-content:center; gap:8px; flex-wrap:wrap;"></div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ ¬´–†–∞–∑–Ω–æ–µ¬ª -->
  <div id="miscModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="miscHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">–†–∞–∑–Ω–æ–µ</h3>
      <div class="misc-buttons-container">
        <div class="system-buttons">
          <!-- <button onclick="ignoreNextEnter=true;window.AndroidInterface.openFilePicker()" class="sys-btn">
            <img src="https://raw.githubusercontent.com/F4IPTV/Play/main/Pictures/–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è (15).svg" alt="" style="height:26px;"><br>–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
          </button> -->
	  <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ -->
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openWirelessDebuggingSettings()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic3_developer.png" alt="" style="height:26px;"><br>–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    </button>
    <button onclick="ignoreNextEnter=true;requestLocalAdbConnection()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:26px;"><br>–ü–æ–¥–∫–ª—é—á–∏—Ç—å ADB (RSA)
    </button>
    <button onclick="ignoreNextEnter=true;openAdbScanner()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:26px;"><br>–ö –¥—Ä—É–≥–æ–º—É (RSA)
    </button>
    <button onclick="handleOpenApkFilePicker()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic11_usb.png" alt="" style="height:26px;"><br>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å APK+
    </button>
    <button onclick="dumpLocalApps()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic10_updWebView.png" alt="" style="height:28px;"><br>–î–∞–º–ø –∏–∫–æ–Ω–æ–∫
    </button>
          <button onclick="disablePackages(['com.amazon.amazonvideo.livingroom','com.android.cts.priv.ctsshim','com.android.printspooler','com.android.providers.calendar','com.android.providers.contacts','com.apple.atve.androidtv.appletv','com.google.android.feedback','com.xiaomi.mitv.mediaexplorer','com.google.android.play.games','com.google.android.syncadapters.calendar','com.iqiyi.i18n.tv','com.mitv.tvhome.michannel','com.mitv.tvhome.mitvplus','com.mitv.videoplayer','com.miui.tv.analytics','com.netflix.ninja','com.google.android.videos','com.sonyliv','in.startv.hotstar','com.android.dreams.basic','com.google.android.apps.tv.dreamx','com.mitv.tvhome.atv','com.mitv.dream'])" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic22_disableside.png" alt="" style="height:26px;"><br>–û—Ç–∫–ª\–≤–∫–ª —Å–∏—Å—Ç–µ–º–Ω—ã–µ
          </button>
           <button onclick="ignoreNextEnter=true;handleConfirmWipeThirdPartyApps()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic8_cleartrash.png" alt="" style="height:26px;"><br>–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
          </button>
          <button onclick="openScreenSaverModal(this)" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic12_ScreenServer.png" alt="" style="height:26px;"><br>–ó–∞—Å—Ç–∞–≤–∫–∞
          </button>
          <button onclick="openAdbCommandsFromButton(this)" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic13_ADB_cmd.png" alt="" style="height:24px;"><br>ADB –∫–æ–º–∞–Ω–¥—ã
          </button>
			<button onclick="ignoreNextEnter=true;window.AndroidInterface.confirmDeleteCopiedBackups()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic8_cleartrash.png" alt="" style="height:26px;"><br>–£–¥–∞–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤
          </button>
          <button onclick="showInstallMethodSettings()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic1_tools.png" alt="" style="height:26px;"><br>–í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            </button>
			<button onclick="openMiscMoreModal(this)" class="sys-btn">
    <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic1_disable.png" alt="" style="height:26px;"><br>–î–æ–ø. —Ñ—É–Ω–∫—Ü–∏–∏
  </button>

		  
          
        </div>
      </div>
    </div>
  </div>

  <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ –≤–Ω—É—Ç—Ä–∏ ¬´–†–∞–∑–Ω–æ–µ¬ª -->
  <div id="miscMoreModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="miscMoreHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
      <div class="misc-buttons-container">
        <div class="system-buttons">

			    <button onclick="ignoreNextEnter=true; window.AndroidInterface.openActivityStubOneButton()" class="sys-btn">
          <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic9_AndroidWebView.png" alt="" style="height:24px;"><br>Activity Stub
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openSettingsForPackage('com.android.documentsui')" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic10_Files.webp" alt="" style="height:22px;"><br> –§–∞–π–ª—ã
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openFilesPermissionSettings()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic_launcher_round.png" alt="" style="height:28px;"><br>–î–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏
          </button>
			
			    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openFilesPermissionSettingsForPackage('com.anydesk.anydeskandroid')" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic8_anydesk.png" alt="" style="height:26px;"><br>–î–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openPlayMarket()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic9_googleplay.png" alt="" style="height:24px;"><br>Google Play
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openSettingsForPackage('com.google.android.katniss')" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic5_googlekatniss.png" alt="" style="height:24px;"><br>Google Katniss
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openApkFilePickerDownload()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic11_usb.png" alt="" style="height:26px;"><br>–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openDownloadToDevice()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic11_usb.png" alt="" style="height:26px;"><br>–°–∫–∞—á–∞—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.clearWebCache()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic7_clearcash.png" alt="" style="height:26px;"><br>–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à
          </button>
          <button onclick="ignoreNextEnter=true;handleAdbTcpToggle(true,this)" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic15_connect.webp" alt="" style="height:22px;"><br>ADB TCP 5555 (root)
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAddAccountSettings()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic6_account.png" alt="" style="height:28px;"><br>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç
          </button>
          <button onclick="openAutostartModal(this)" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic2_autostart.png" alt="" style="height:26px;"><br>–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
          </button>
          <button onclick="ignoreNextEnter=true;runAllAutoPermissions()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:28px;"><br>–ê–≤—Ç–æ—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
          </button>
          <button onclick="ignoreNextEnter=true;installFastInstaller()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:28px;"><br>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å FastInstaller
          </button>
        
			    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openNetworkSettings()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/network/ic_wifi.png" alt="" style="height:28px;"><br>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Wi-Fi
          </button>
          <button onclick="showSettingsCash()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic1_tools.png" alt="" style="height:26px;"><br>–í—ã–±–æ—Ä –∫–µ—à–∞
            </button>
          
          <button onclick="ignoreNextEnter=true; openInternal('https://tvboxsetup.ru/sv/');" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic11_about.png" alt="" style="height:28px;"><br>–û –ø—Ä–æ–≥—Ä–∞–º–º–µ
          </button>
        </div>
        <div id="adbRootDiagOutput" style="margin-top:12px;padding:10px 12px;border-radius:12px;background:#11131a;color:#d5e3ff;font-family:monospace;font-size:12px;white-space:pre-wrap;max-height:160px;overflow:auto;display:none;line-height:1.5;">
          –õ–æ–≥ ADB (root) –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞ ADB -->
  <div id="adbScannerModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <div id="lastAdbConnectionWrapper" class="adb-last-connection">
        <div class="adb-last-connection-title">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</div>
        <button id="lastAdbConnectionBtn" class="adb-chip adb-last-connection-btn" onclick="connectToLastAdb()" tabindex="0"></button>
      </div>
      <h3 id="adbScannerHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">
        <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:25px;">
        –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ADB
      </h3>
      <div id="adbScanStatus" style="font-size:13px;opacity:.85;margin-bottom:12px;text-align:center;">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
      
      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º –¥–ª—è —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
      <div id="adbScanListContainer" style="max-height:60vh;overflow-y:auto;overscroll-behavior:contain;scroll-behavior:auto;scrollbar-gutter:stable both-edges;margin-bottom:20px;">
        <div id="adbScanList" style="display:flex;flex-direction:column;gap:12px;align-items:center;"></div>
      </div>
      
      <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
      <div class="system-buttons" style="justify-content:center;">
        <button class="sys-btn" onclick="restartAdbScan()" tabindex="0">
          <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic10_updWebView.png" alt="" style="height:22px;"><br>–ü–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å
        </button>
        <button class="sys-btn" onclick="ignoreNextEnter=true;openAdbManualConnectModal()" tabindex="0">
          <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic14_ADB_Input.png" alt="" style="height:22px;"><br>–í–≤–µ—Å—Ç–∏ IP:–ø–æ—Ä—Ç
        </button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
  <div id="adbManualConnectModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content" style="max-width:420px;">
      <h3 id="adbManualHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">
        <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:26px;">
        –†—É—á–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ADB
      </h3>
      <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:16px;align-items:center;">
        <div style="display:flex;flex-direction:column;gap:4px;width:100%;max-width:280px;">
          <label for="adbManualHostInput" style="font-size:13px;opacity:.85;">IP –∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</label>
          <input id="adbManualHostInput" type="text" placeholder="192.168.0.15" autocomplete="off" spellcheck="false"
                 style="padding:10px 12px;border-radius:10px;border:none;background:#1c1c1f;color:#fff;font-size:15px;">
        </div>
        <div style="display:flex;flex-direction:column;gap:4px;width:100%;max-width:280px;">
          <label for="adbManualPortInput" style="font-size:13px;opacity:.85;">–ü–æ—Ä—Ç ADB (–∏–∑ &laquo;IP address &amp; port&raquo;)</label>
          <input id="adbManualPortInput" type="text" placeholder="5555" autocomplete="off" spellcheck="false"
                 style="padding:10px 12px;border-radius:10px;border:none;background:#1c1c1f;color:#fff;font-size:15px;">
        </div>
        <div style="font-size:13px;line-height:1.4;opacity:.85;">
          –í–≤–µ–¥–∏—Ç–µ IP –∏ –ø–æ—Ä—Ç –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ <strong>Wireless debugging ‚Üí IP address &amp; port</strong>. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–∂–µ paired –∏–ª–∏ –∏–º–µ—Ç—å –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∫–ª—é—á ADB.
        </div>
      </div>
      <div class="system-buttons" style="justify-content:center;">
        <button id="adbManualSubmitBtn" class="sys-btn" onclick="submitAdbManualConnect()" type="button">
          <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic15_connect.webp" alt="" style="height:22px;"><br>–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
        </button>
        <button id="adbManualCloseBtn" class="sys-btn" onclick="closeAdbManualConnectModal()" type="button">
          <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic16_back.webp" alt="" style="height:22px;"><br>–ó–∞–∫—Ä—ã—Ç—å
        </button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ADB –∫–æ–º–∞–Ω–¥ -->
  <div id="adbCommandsModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="adbCommandsHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">
        <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:26px;">
        ADB –∫–æ–º–∞–Ω–¥—ã
      </h3>
      <div id="adbCommandsListContainer">
        <div id="adbCommandsList"></div>
        <button id="adbCommandsCloseBtn" class="component-btn" onclick="closeAdbCommandsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞—Å—Ç–∞–≤–∫–∏ -->
  <div id="screenSaverModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="screenSaverHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">
        <img src="https://appassets.androidplatform.net/assets/webview/icons/network/ic_wifi.png" alt="" style="height:26px;">
        –ó–∞—Å—Ç–∞–≤–∫–∞
      </h3>
      <div class="screen-saver-body">
        <div class="screen-saver-section">
          <div class="screen-saver-row">
            <label>–°–æ—Å—Ç–æ—è–Ω–∏–µ</label>
            <div id="screenSaverState" class="screen-saver-value">‚Äî</div>
          </div>
          <div class="screen-saver-row">
            <label>–¢–µ–∫—É—â–∞—è –∑–∞—Å—Ç–∞–≤–∫–∞</label>
            <div id="screenSaverCurrent" class="screen-saver-value">‚Äî</div>
          </div>
          <div class="screen-saver-row">
            <label>–ó–∞–ø—É—Å–∫ –∑–∞—Å—Ç–∞–≤–∫–∏</label>
            <button id="screenSaverIdleBtn" class="sys-btn" onclick="openScreenSaverTimeoutModal('screen')">
              ‚Äî
            </button>
          </div>
          <div class="screen-saver-row">
            <label>–°–æ–Ω –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏</label>
            <button id="screenSaverSleepBtn" class="sys-btn" onclick="openScreenSaverTimeoutModal('sleep')">
              ‚Äî
            </button>
          </div>
        </div>

        <div class="screen-saver-section">
          <h4>–í—ã–±–æ—Ä –∑–∞—Å—Ç–∞–≤–∫–∏</h4>
          <div class="screen-saver-actions">
            <button id="screenSaverAerialViewsBtn" class="sys-btn screen-saver-action-btn" onclick="setScreenSaverPackage('com.neilturner.aerialviews')">
              <img src="https://appassets.androidplatform.net/assets/webview/icons/screenserver/ic_AerialViews.webp" alt="Aerial Views">
              <span>Aerial Views</span>
            </button>
            <button id="screenSaverAerialDreamBtn" class="sys-btn screen-saver-action-btn" onclick="setScreenSaverPackage('com.codingbuffalo.aerialdream')">
              <img src="https://appassets.androidplatform.net/assets/webview/icons/screenserver/ic_AerialDream.webp" alt="Aerial Dream" style="height:22px;">
              <span>Aerial Dream</span>
            </button>
            <button id="screenSaverToggleBtn" class="sys-btn" onclick="toggleScreenSaver()">
              –û—Ç–∫–ª—é—á–∏—Ç—å –∑–∞—Å—Ç–∞–≤–∫—É
            </button>
          <button class="sys-btn" onclick="RunScreenSaverSettings()">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Å—Ç–∞–≤–∫–∏</button>
            <button class="sys-btn" onclick="resetScreenSaverSettings()">–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞—Å—Ç–∞–≤–∫–∏</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞ –∑–∞—Å—Ç–∞–≤–∫–∏ -->
  <div id="screenSaverTimeoutModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="screenSaverTimeoutTitle" style="text-align:center;">–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞</h3>
      <div class="screen-saver-timeout-body">
        <div class="screen-saver-timeout-field">
          <label id="screenSaverTimeoutLabel">–ú–∏–Ω—É—Ç—ã</label>
          <input id="screenSaverTimeoutInput" type="text" inputmode="numeric" pattern="[0-9]*" />
          <div class="screen-saver-timeout-hint" id="screenSaverTimeoutHint">–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: 1‚Äì1440 –º–∏–Ω—É—Ç</div>
        </div>
      </div>
      <div class="system-buttons" style="justify-content:center;">
        <button id="screenSaverTimeoutApply" class="sys-btn" onclick="applyScreenSaverTimeout()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <button id="screenSaverTimeoutCancel" class="sys-btn" onclick="closeScreenSaverTimeoutModal()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ -->
  <div id="modal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3 id="modalGroupHeader" style="display:flex;gap:8px;align-items:center;justify-content:center;"></h3>
      <div id="modalListContainer">
        <div id="modalList"></div>
        <button id="installAllBtn" onclick="installAll()" class="component-btn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë</button>
      </div>
    </div>
  </div>

  <script>
    // –°–ø–∏—Å–æ–∫ ADB-–∫–æ–º–∞–Ω–¥. –ò–∑–º–µ–Ω—è–π—Ç–µ —ç—Ç–æ—Ç –º–∞—Å—Å–∏–≤, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    const ADB_COMMANDS = [
      {
        id: 1008,
        command: "am start -a android.intent.action.OPEN_DOCUMENT -c android.intent.category.OPENABLE -t \"application/vnd.android.package-archive\"",
        description: "–î–ª—è Google TV 12+",
        label: "–í—ã–±–æ—Ä –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–∞",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/group/ic_default_icon_groups2.png",
        isEnabled: true,
        uid: "d1c3a7ab-8f7a-4c9a-9f5e-commands-open-document"
      },
      {
        id: 1009,
        command: "settings put system screen_off_timeout 1800000",
        description: "–¢–∞–π–º–µ—Ä –∑–∞—Å—Ç–∞–≤–∫–∏",
        label: "–ó–∞—Å—Ç–∞–≤–∫–∞: 30 –º–∏–Ω—É—Ç",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic12_ScreenServer.png",
        isEnabled: true,
        uid: "3fcd28d1-0f6e-4f3a-adb1-screen-timeout"
      },
      {
        id: 1010,
        command: "settings put secure sleep_timeout 28800000",
        description: "–¢–∞–π–º–µ—Ä —Å–Ω–∞",
        label: "–°–æ–Ω: 8 —á–∞—Å–æ–≤",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic12_ScreenServer.png",
        isEnabled: true,
        uid: "12dc0a6d-7fb2-4149-adb1-sleep-timeout"
      },
      {
        id: 1011,
        command: "cmd package install-existing com.google.android.apps.tv.launcherx || pm install-existing com.google.android.apps.tv.launcherx; cmd package enable --user 0 com.google.android.apps.tv.launcherx; pm enable --user 0 com.google.android.apps.tv.launcherx; cmd package enable com.google.android.apps.tv.launcherx; cmd package enable --user 0 com.google.android.tungsten.setupwraith; pm enable --user 0 com.google.android.tungsten.setupwraith; cmd package enable com.google.android.tungsten.setupwraith; pm path com.google.android.apps.tv.launcherx >/dev/null 2>&1 && { cmd notification allow_listener com.google.android.apps.tv.launcherx/com.google.android.apps.tv.launcherx.notifications.NotificationListenerService || true; cmd notification allow_listener com.google.android.apps.tv.launcherx/com.google.android.apps.tv.launcherx.coreservices.notificationlistener.TvNotificationListenerService || true; cmd notification disallow_listener com.spocky.projengmenu/com.spocky.projengmenu.services.ProjectivyNotificationListener || true; cmd notification disallow_listener com.spocky.projengmenu/com.spocky.projengmenu.services.notification.NotificationListener || true; cmd notification disallow_listener com.google.android.tvlauncher/com.google.android.tvlauncher.notifications.NotificationListenerService || true; } || true; cmd role add-role-holder android.app.role.HOME com.google.android.apps.tv.launcherx || true; cmd package set-home-activity com.google.android.apps.tv.launcherx/.ui.HomeActivity || true",
        description: " ",
        label: "–í–∫–ª—é—á–∏—Ç—å Google TV Home",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic19_GTV.webp",
        isEnabled: true,
        uid: "launcher-restore-google-tv"
      },
      {
        id: 1012,
        command: "cmd package install-existing com.google.android.tvlauncher || pm install-existing com.google.android.tvlauncher; cmd package enable --user 0 com.google.android.tvlauncher; pm enable --user 0 com.google.android.tvlauncher; cmd package enable com.google.android.tvlauncher; pm path com.google.android.tvlauncher >/dev/null 2>&1 && { cmd notification allow_listener com.google.android.tvlauncher/com.google.android.tvlauncher.notifications.NotificationListenerService || true; cmd notification disallow_listener com.spocky.projengmenu/com.spocky.projengmenu.services.ProjectivyNotificationListener || true; cmd notification disallow_listener com.spocky.projengmenu/com.spocky.projengmenu.services.notification.NotificationListener || true; pm path com.google.android.apps.tv.launcherx >/dev/null 2>&1 && { cmd notification disallow_listener com.google.android.apps.tv.launcherx/com.google.android.apps.tv.launcherx.notifications.NotificationListenerService || true; cmd notification disallow_listener com.google.android.apps.tv.launcherx/com.google.android.apps.tv.launcherx.coreservices.notificationlistener.TvNotificationListenerService || true; } || true; } || true; cmd role add-role-holder android.app.role.HOME com.google.android.tvlauncher || true; cmd package set-home-activity com.google.android.tvlauncher/.ui.HomeActivity || true",
        description: " ",
        label: "–í–∫–ª—é—á–∏—Ç—å Android TV Home",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic20_ATV.png",
        isEnabled: true,
        uid: "launcher-restore-android-tv"
      },
      {
        id: 1015,
        command: "su -c 'pm uninstall -k --user 0 com.google.android.apps.tv.launcherx || true; cmd package install-existing com.google.android.tvlauncher || pm install-existing com.google.android.tvlauncher || true; cmd package enable --user 0 com.google.android.tvlauncher; pm enable --user 0 com.google.android.tvlauncher; cmd package enable com.google.android.tvlauncher; pm path com.google.android.tvlauncher >/dev/null 2>&1 && { cmd notification allow_listener com.google.android.tvlauncher/com.google.android.tvlauncher.notifications.NotificationListenerService || true; } || true'",
        description: "Root: —É–¥–∞–ª—è–µ—Ç GTV Home –¥–ª—è user 0, –≤–∫–ª—é—á–∞–µ—Ç ATV Home –∏ –≤—ã–¥–∞—ë—Ç —Å–ª—É—à–∞—Ç–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.",
        label: "–í–∫–ª—é—á–∏—Ç—å ATV (root)",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic20_ATV.png",
        isEnabled: true,
        uid: "launcher-restore-android-tv-root"
      },
      {
        id: 1013,
        command: "cmd package install-existing com.spocky.projengmenu || pm install-existing com.spocky.projengmenu; cmd package enable --user 0 com.spocky.projengmenu; pm enable --user 0 com.spocky.projengmenu; cmd package enable com.spocky.projengmenu && { cmd notification allow_listener com.spocky.projengmenu/com.spocky.projengmenu.services.ProjectivyNotificationListener || true; cmd notification allow_listener com.spocky.projengmenu/com.spocky.projengmenu.services.notification.NotificationListener || true; pm path com.google.android.apps.tv.launcherx >/dev/null 2>&1 && { cmd notification disallow_listener com.google.android.apps.tv.launcherx/com.google.android.apps.tv.launcherx.notifications.NotificationListenerService || true; cmd notification disallow_listener com.google.android.apps.tv.launcherx/com.google.android.apps.tv.launcherx.coreservices.notificationlistener.TvNotificationListenerService || true; } || true; pm path com.google.android.tvlauncher >/dev/null 2>&1 && { cmd notification disallow_listener com.google.android.tvlauncher/com.google.android.tvlauncher.notifications.NotificationListenerService || true; } || true; pm path com.google.android.tvlauncher >/dev/null 2>&1 && { cmd package install-existing com.google.android.tvlauncher || pm install-existing com.google.android.tvlauncher || true; cmd package disable-user --user 0 com.google.android.tvlauncher || true; pm disable-user --user 0 com.google.android.tvlauncher || true; } || true; pm path com.google.android.apps.tv.launcherx >/dev/null 2>&1 && { cmd package install-existing com.google.android.apps.tv.launcherx || pm install-existing com.google.android.apps.tv.launcherx || true; cmd package disable-user --user 0 com.google.android.apps.tv.launcherx || true; pm disable-user --user 0 com.google.android.apps.tv.launcherx || true; cmd package disable-user --user 0 com.google.android.tungsten.setupwraith || true; pm disable-user --user 0 com.google.android.tungsten.setupwraith || true; } || true; }",
        description: " ",
        label: "Projectivy Launcher",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic21_PJL.png",
        isEnabled: true,
        uid: "launcher-enable-projectivy"
      },
      {
        id: 1016,
        command: "am start -a android.settings.HOME_SETTINGS",
        description: "–û—Ç–∫—Ä—ã—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–±–æ—Ä –¥–æ–º–∞—à–Ω–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ª–∞—É–Ω—á–µ—Ä–∞).",
        label: "–í—ã–±–æ—Ä –ª–∞—É–Ω—á–µ—Ä–∞",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic20_ATV.png",
        isEnabled: true,
        uid: "launcher-picker"
      },
      {
        id: 1017,
        command: "su -c 'setprop persist.vendor.usb.debug 0'",
        description: "ATV 11: —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ä–∞–±–æ—á–∏–π USB/ADB –ø–æ Wi‚ÄëFi –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.",
        label: "USB debug —Ñ–∏–∫—Å (ATV11)",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic20_ATV.png",
        isEnabled: true,
        uid: "usb-debug-fix-atv11"
      },
      {
        id: 1018,
        command: "su -c 'while [ \"$(getprop sys.boot_completed)\" != \"1\" ]; do sleep 1; done; GPIO=474; BASE=/sys/class/gpio/gpio$GPIO; [ -e \"$BASE/direction\" ] || echo $GPIO > /sys/class/gpio/export 2>/dev/null; if [ -e \"$BASE/direction\" ]; then echo out > \"$BASE/direction\" 2>/dev/null; echo 1 > \"$BASE/value\" 2>/dev/null; fi'",
        description: "ATV 14: —Å—Ç–∞–≤–∏—Ç GPIO 474 –≤ out –∏ value=1 –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ GPIO –¥–æ—Å—Ç—É–ø–µ–Ω.",
        label: "USB fix (ATV14)",
        icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic20_ATV.png",
        isEnabled: true,
        uid: "usb-fix-atv14"
      },
      
      { id: 1014, command: "am force-stop com.google.android.katniss", description: "–≠—Ñ—Ñ–µ–∫—Ç ¬´—Å—Ç–æ–ø-–∫–∞–¥—Ä¬ª", label: "–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Katniss", icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic18_back.png", isEnabled: true, uid: "force-stop-katniss" },
      { id: 1001, command: "reboot", description: "reboot", label: "–°–∏—Å—Ç–µ–º–∞", icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic18_back.png", isEnabled: true, uid: "171afb09-e150-4348-83b8-1f4fef2787aa" },
      { id: 1002, command: "reboot bootloader", description: "reboot bootloader", label: "Bootloader", icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic18_back.png", isEnabled: true, uid: "1000e8c1-025c-4621-92ff-a867210e8b96" },
      { id: 1003, command: "reboot fastboot", description: "reboot fastboot", label: "FastbootD", icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic18_back.png", isEnabled: true, uid: "29dcff70-46b2-4626-83d4-0b4bebc83957" },
      { id: 1004, command: "reboot recovery", description: "reboot recovery", label: "Recovery", icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic18_back.png", isEnabled: true, uid: "1f1426c1-1676-4e8b-845c-5349e7a1a9ae" },
      { id: 1005, command: "reboot sideload", description: "reboot sideload", label: "Sideload", icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic18_back.png", isEnabled: true, uid: "91788dc4-4247-488f-831a-7b0e823d50a3" },
      { id: 1006, command: "reboot update", description: "reboot update", label: "TWRP", icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic18_back.png", isEnabled: true, uid: "f537d6b2-4c49-46ab-affe-7f29e400f7fe" },
      { id: 1007, command: "reboot -p", description: "reboot -p", label: "–í—ã–∫–ª—é—á–µ–Ω–∏–µ (–ø–æ–ª–Ω–æ–µ)", icon: "https://appassets.androidplatform.net/assets/webview/icons/misc/ic18_back.png", isEnabled: true, uid: "bdf56bfe-03ba-40b0-bb52-5723e9ee70af" }
    ];
    const BATTERY_WHITELIST_PACKAGES = [
      "dev.vodik7.tvquickactions",
      "org.acestream.media",
      "org.acestream.start",
      "org.acestream.core",
      "org.free.aceserve",
      "ru.yourok.torrserve",
      "io.github.romanvht.byedpi",
      "org.amnezia.awg",
      "org.acestream.live",
      "org.acestream.core.atv"
    ];
    const USAGE_STATS_PACKAGES = [
      "dev.vodik7.tvquickactions",
      "org.acestream.media",
      "org.acestream.start",
      "org.acestream.core",
      "org.free.aceserve",
      "ru.yourok.torrserve",
      "io.github.romanvht.byedpi",
      "org.amnezia.awg",
      "org.acestream.live",
      "org.acestream.core.atv"
    ];
    const MANAGE_STORAGE_PACKAGES = [
      "dev.vodik7.tvquickactions",
      "ru.yourok.torrserve",
	    "com.mexplorer.silver",
      "ru.tiardev.kinotrend"
    ];
    const OVERLAY_PACKAGES = [
      "dev.vodik7.tvquickactions",
      "ar.tvplayer.tv",
      "com.softmedia.receiver"
    ];
    const WRITE_SETTINGS_PACKAGES = [
      "dev.vodik7.tvquickactions",
      "ru.yourok.torrserve",
      "org.acestream.media"
    ];
    const EXACT_ALARM_PACKAGES = [
      "dev.vodik7.tvquickactions",
      "org.amnezia.awg"
    ];
    const NOTIFICATION_LISTENER_SERVICES = [
      {
        pkg: "dev.vodik7.tvquickactions",
        service: "dev.vodik7.tvquickactions/.services.NotificationListenerService"
      }
    ];
    const ACCESSIBILITY_SERVICES = [
      "ru.yourok.torrserve/ru.yourok.torrserve.server.local.services.GlobalTorrService",
      "dev.vodik7.tvquickactions/dev.vodik7.tvquickactions.KeyAccessibilityService",
      "flar2.homebutton/a.i",
      "com.spocky.projengmenu/com.spocky.projengmenu.services.ProjectivyAccessibilityService"
    ];
const ACCESSIBILITY_PACKAGES = [
  "ru.yourok.torrserve",
  "dev.vodik7.tvquickactions",
  "flar2.homebutton",
  "com.spocky.projengmenu",
  "io.github.romanvht.byedpi",
  "org.amnezia.awg"
];
    const MICROPHONE_PERMISSION = "android.permission.RECORD_AUDIO";
    const MICROPHONE_PERMISSION_PACKAGES = [
      
      "com.google.android.youtube.tv",
      
      "org.liskovsoft.androidtv.rukeyboard"
    ];
    const DEFAULT_KEYBOARD_IME = "org.liskovsoft.androidtv.rukeyboard/com.liskovsoft.leankeyboard.ime.LeanbackImeService";
    const DEFAULT_SCREENSAVER_COMPONENT = "com.neilturner.aerialviews/.ui.screensaver.DreamActivity";
    const DEFAULT_SCREENSAVER_PACKAGE = "com.neilturner.aerialviews";
    const ADB_ICON_CONNECTED = "https://appassets.androidplatform.net/assets/webview/icons/network/ic_ADB_on.png";
    const ADB_ICON_DISCONNECTED = "https://appassets.androidplatform.net/assets/webview/icons/network/ic_ADB_off.png";
    const modalActionAtvRefresh = {
      key: 'modal-action-atv-refresh',
      icon: 'https://appassets.androidplatform.net/assets/webview/icons/main/ic10_updWebView.png',
      label: '–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫',
      run() { refreshAtvAppsList('remote'); }
    };

    const MODAL_HEADER_ACTIONS = [
      {
        key: 'modal-action-all-apps',
        icon: 'https://appassets.androidplatform.net/assets/webview/icons/main/ic12_about.png',
        label: '–ú–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π',
        run(btn) {
          ignoreNextEnter = true;
          try {
            window.AndroidInterface?.openAllAppsSide?.();
          } catch (err) {
            console.warn('openAllAppsSide –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', err);
          }
        }
      },
      {
        key: 'modal-action-screen-saver',
        icon: 'https://appassets.androidplatform.net/assets/webview/icons/main/ic13_about.png',
        label: '–ó–∞—Å—Ç–∞–≤–∫–∞',
        run(btn) {
          openScreenSaverModal(btn);
        }
      },
      {
        key: 'modal-action-adb-commands',
        icon: 'https://appassets.androidplatform.net/assets/webview/icons/main/ic14_about.png',
        label: 'ADB –∫–æ–º–∞–Ω–¥—ã',
        run(btn) {
          openAdbCommandsFromButton(btn);
        }
      },
      modalActionAtvRefresh
    ];
    let modalOverlayCounter = 1000;
    const MODAL_Z_STEP = 5;

    const SCREEN_SAVER_TIMEOUT_LIMITS = { min: 1, max: 1440 };
    const SCREEN_SAVER_TIMEOUT_DEFAULTS = { screen: 60, sleep: 480 };
    const SCREEN_SAVER_TIMEOUT_LABELS = {
      screen: '–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏',
      sleep: '–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ'
    };

    let currentGroup = "";
    let cachedConfig = null;
    let lastFocusedElement = null;
    let lastPassword = "";
    let backupQueue = [];
    let backupTarget = "";
    let savedPassword = "";
let ignoreNextEnter = false;
let __installMethodApplying = false;
let lastFocusedElementMiscMore = null;
let lastFocusedElementManualConnect = null;
let lastFocusedElementAdbCommands = null;
let lastAdbCommandsTriggerButton = null;
let lastScreenSaverTrigger = null;
let screenSaverTimeoutState = { screen: null, sleep: null };
let screenSaverTimeoutModalType = null;
let screenSaverTimeoutReturnEl = null;
let currentScreenSaverComponent = null;
let storageUsageLabel = '';
let lastAdbIndicatorText = '';
let lastAdbIndicatorConnected = false;
let autostartReturnModal = null;
let autostartOpener = null;

const ADB_ROOT_LOG_ID = 'adbRootDiagOutput';

function setAdbRootLog(text) {
  const box = document.getElementById(ADB_ROOT_LOG_ID);
  if (!box) return;
  if (text && text.length) {
    box.style.display = 'block';
    box.textContent = text;
  } else {
    box.textContent = '';
    box.style.display = 'none';
  }
}

    document.getElementById('passwordBtn').addEventListener('click', () => {
      const ai = window.AndroidInterface;
      if (ai?.requestPasswordPrefill) { ai.requestPasswordPrefill(savedPassword || ""); return; }
      if (ai?.requestPassword) { try { ai.requestPassword(savedPassword || ""); return; } catch (e) { ai.requestPassword(); return; } }
      const pwd = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å", savedPassword || "");
      if (pwd !== null) { savedPassword = pwd.trim(); updatePasswordBtn(); }
    });

    function setPasswordFromAndroid(pwd) { savedPassword = (pwd || "").trim(); updatePasswordBtn(); }
    function updatePasswordBtn() {
      const btn = document.getElementById('passwordBtn');
      btn.textContent = savedPassword ? `üîë –ü–∞—Ä–æ–ª—å: ${'*'.repeat(savedPassword.length)}` : "üîë –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å";
    }
    function anyModalOpen() { return ['modal','autostartModal','atvAppsModal','atvAppActionsModal','miscModal','installMethodModal','adbScannerModal','adbManualConnectModal','adbCommandsModal','screenSaverModal','screenSaverTimeoutModal'].some(id => document.getElementById(id)?.style.display === 'flex'); }

    function copyBackupsSequentially(urls, folder) { if (!urls.length) return; backupQueue = urls; backupTarget = folder; copyNextBackup(); }
    function copyNextBackup() {
      if (backupQueue.length === 0) { showStatus("‚úÖ –í—Å–µ –±—ç–∫–∞–ø—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã", "green"); return; }
      const url = backupQueue.shift(); const fileName = url.split('/').pop();
      showStatus(`‚è≥ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: ${fileName} <span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`, "#00cfff", 4000);
      window.AndroidInterface?.copyBackup(url, backupTarget);
    }
    function onBackupCopied() { copyNextBackup(); }

    const disablePackageStates = new Map();

let adbStatusRetryTimer = null;

function setAdbIndicator(text, connected) {
  lastAdbIndicatorText = text || '';
  lastAdbIndicatorConnected = !!connected;
  const safeBase = escapeHtml(lastAdbIndicatorText);
  const base = safeBase.length ? safeBase : '&nbsp;';
  const storagePart = storageUsageLabel
    ? ` <span class="storage-usage-badge">${escapeHtml(storageUsageLabel)}</span>`
    : '';
  document.querySelectorAll('.adb-status-indicator').forEach((el) => {
    el.innerHTML = `${base}${storagePart}`;
    el.classList.toggle('connected', !!connected);
  });
  document.querySelectorAll('#passwordRow .adb-status-icon').forEach((btn) => {
    btn.title = (text || '').trim() || '–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É ADB';
    btn.setAttribute('aria-label', btn.title);
    btn.classList.toggle('connected', !!connected);
  });
  syncModalAdbIndicators(!!connected);
}

function refreshAdbStatusIndicator() {
  try {
    const raw = window.AndroidInterface?.getAdbConnectionInfo?.();
    if (!raw || raw === 'undefined') {
      setAdbIndicator('–õ–æ–∫–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', false);
      scheduleAdbStatusRetry();
      return;
    }
    const info = JSON.parse(raw);
    const fallback = info.connected ? 'ADB –ø–æ–¥–∫–ª—é—á–µ–Ω' : '–õ–æ–∫–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ';
    setAdbIndicator(info.label || fallback, info.connected);
  } catch (e) {
    console.warn('ADB status update error', e);
    setAdbIndicator('ADB: —Å—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω', false);
  }
}

function scheduleAdbStatusRetry() {
  clearTimeout(adbStatusRetryTimer);
  adbStatusRetryTimer = setTimeout(refreshAdbStatusIndicator, 2000);
}

window.refreshAdbStatusIndicator = refreshAdbStatusIndicator;

function updateStorageUsage(label) {
  if (typeof label === 'string' && label.trim().length) {
    storageUsageLabel = label.trim();
  } else {
    storageUsageLabel = '';
  }
  setAdbIndicator(lastAdbIndicatorText, lastAdbIndicatorConnected);
}

function escapeHtml(value) {
  return String(value ?? '')
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}

window.updateStorageUsage = updateStorageUsage;

function handleAdbTcpToggle(enable, triggerBtn) {
  const method = enable ? 'enableAdbTcp5555' : 'disableAdbTcp';
  const available = window.AndroidInterface?.[method];
  if (!available) {
    showToast({ message: "‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ADB –ø–æ —Å–µ—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ", type: "error" });
    return;
  }
  if (window.AndroidInterface?.hasRootAccess && !window.AndroidInterface.hasRootAccess()) {
    showToast({ message: "‚ùå –ù—É–∂–µ–Ω root (su)", type: "error" });
    setAdbRootLog("–ù—É–∂–µ–Ω root (su) –¥–ª—è —ç—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏");
    return;
  }
  setAdbRootLog(enable ? '‚è≥ –í–∫–ª—é—á–∞—é ADB –ø–æ —Å–µ—Ç–∏ (5555)‚Ä¶' : '‚è≥ –û—Ç–∫–ª—é—á–∞—é ADB –ø–æ —Å–µ—Ç–∏‚Ä¶');
  let raw = '';
  try {
    raw = available.call(window.AndroidInterface) || '';
  } catch (e) {
    showToast({ message: "‚ùå –û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ su-–∫–æ–º–∞–Ω–¥—ã", type: "error" });
    setAdbRootLog(`–û—à–∏–±–∫–∞: ${e?.message || e}`);
    return;
  }
  let data = null;
  try { data = JSON.parse(raw); } catch (_) {}
  const ok = data?.ok === true;
  const output = (data?.output || raw || '').trim();
  setAdbRootLog(output || '–ù–µ—Ç –≤—ã–≤–æ–¥–∞');
  if (ok) {
    showToast({ message: enable ? "‚úÖ ADB –ø–æ —Å–µ—Ç–∏ 5555 –≤–∫–ª—é—á—ë–Ω" : "‚úÖ ADB –ø–æ —Å–µ—Ç–∏ –æ—Ç–∫–ª—é—á—ë–Ω", type: "success" });
  } else {
    const reason = data?.error === "root_required" ? "–ù—É–∂–µ–Ω root (su)" : (output || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
    showToast({ message: `‚ùå ${reason}`, type: "error" });
  }
}

const adbScanState = {
  hosts: [],
  running: false,
  status: '–û–∂–∏–¥–∞–Ω–∏–µ...'
};
const FRIENDLY_NAME_FALLBACK = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ';

function applyFriendlyNameNode(node, friendlyName) {
  if (!node) return;
  const label = (friendlyName || '').trim();
  if (label) {
    node.textContent = label;
    node.classList.remove('adb-device-name--placeholder');
  } else {
    node.textContent = FRIENDLY_NAME_FALLBACK;
    node.classList.add('adb-device-name--placeholder');
  }
}

function resetAdbConnectionState() {
  window.AndroidInterface?.disconnectAdb?.();
  setAdbIndicator('–õ–æ–∫–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', false);
  updateStorageUsage('');
}

function requestLocalAdbConnection() {
  resetAdbConnectionState();
  window.AndroidInterface?.connectAdb?.();
}

function refreshLastAdbConnection() {
  const wrapper = document.getElementById('lastAdbConnectionWrapper');
  const btn = document.getElementById('lastAdbConnectionBtn');
  if (!wrapper || !btn) return;
  const hideWrapper = () => {
    wrapper.style.display = 'none';
    wrapper.classList.remove('active');
    btn.dataset.host = '';
    btn.dataset.port = '';
    btn.innerHTML = '';
    btn.classList.remove('is-selected', 'selected');
  };
  let raw;
  try {
    raw = window.AndroidInterface?.getLastAdbConnectionInfo?.();
  } catch (e) {
    raw = null;
  }
  if (!raw || raw === 'undefined') {
    hideWrapper();
    return;
  }
  let info;
  try {
    info = JSON.parse(raw);
  } catch (e) {
    hideWrapper();
    return;
  }
  if (!info || !info.available) {
    hideWrapper();
    return;
  }
  const host = (info.host || '').trim();
  const friendly = (info.friendly || '').trim();
  const topLine = friendly || host;
  const ipLine = host;
  btn.innerHTML = topLine
    ? `<span class="adb-last-connection-btn-line1">${topLine}</span>${ipLine ? `<span class="adb-last-connection-btn-line2">${ipLine}</span>` : ''}`
    : '';
  btn.dataset.host = host;
  btn.dataset.port = info.port != null ? String(info.port) : '';
  if (topLine) {
    wrapper.style.display = 'flex';
    wrapper.classList.add('active');
    btn.classList.remove('is-selected', 'selected');
  } else {
    hideWrapper();
  }
}

function connectToLastAdb() {
  const btn = document.getElementById('lastAdbConnectionBtn');
  if (!btn) return;
  const host = btn.dataset.host;
  const port = parseInt(btn.dataset.port || '', 10) || 5555;
  if (!host) return;
  const scannerModal = document.getElementById('adbScannerModal');
  const scannerVisible = scannerModal && scannerModal.style.display === 'flex';
  if (scannerVisible) {
    closeAdbScanner();
    setTimeout(() => connectToRemoteAdb(host, port), 150);
  } else {
    connectToRemoteAdb(host, port);
  }
}

window.refreshLastAdbConnection = refreshLastAdbConnection;

function openAdbScanner() {
  resetAdbConnectionState();
  refreshAdbStatusIndicator();
  updateStorageUsage('');
  window.AndroidInterface?.requestStorageUsageRefresh?.();
  const modal = document.getElementById('adbScannerModal');
  if (!modal) return;
  const miscModal = document.getElementById('miscModal');
  const miscMoreModal = document.getElementById('miscMoreModal');
  modal.dataset.restoreMisc = '0';
  modal.dataset.restoreMiscMore = '0';
  if (miscModal && miscModal.style.display === 'flex') {
    miscModal.setAttribute('inert', '');
    miscModal.style.pointerEvents = 'none';
    modal.dataset.restoreMisc = '1';
  }
  if (miscMoreModal && miscMoreModal.style.display === 'flex') {
    miscMoreModal.setAttribute('inert', '');
    miscMoreModal.style.pointerEvents = 'none';
    modal.dataset.restoreMiscMore = '1';
  }
  lastFocusedElement = document.activeElement;
  adbScanState.hosts = [];
  renderAdbScanHosts();
  updateAdbScanStatus('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏...', 0);
  modal.style.display = 'flex';
  bringModalToFront(modal);
  document.body.classList.add('modal-open');
  document.activeElement?.blur();
  refreshLastAdbConnection();
  setTimeout(() => {
    if (focusLastAdbConnectionButton(true)) return;
    const firstCard = document.querySelector('#adbScanList .adb-device-card');
    if (firstCard) {
      focusAndRevealAdbCard(firstCard);
      return;
    }
    const firstBtn = modal.querySelector('.system-buttons .sys-btn');
    if (firstBtn) {
      firstBtn.focus({ preventScroll: true });
    } else {
      modal.focus();
    }
  }, 120);
  try {
    window.AndroidInterface?.startNativeAdbScan?.();
  } catch (e) {}
}

function closeAdbScanner() {
  const modal = document.getElementById('adbScannerModal');
  if (!modal) return;
  modal.style.display = 'none';
  modal.style.zIndex = '';
  document.body.classList.remove('modal-open');
  if (modal.dataset.restoreMisc === '1') {
    const misc = document.getElementById('miscModal');
    if (misc) {
      misc.removeAttribute('inert');
      misc.style.pointerEvents = '';
    }
    modal.dataset.restoreMisc = '0';
  }
  if (modal.dataset.restoreMiscMore === '1') {
    const miscMore = document.getElementById('miscMoreModal');
    if (miscMore) {
      miscMore.removeAttribute('inert');
      miscMore.style.pointerEvents = '';
    }
    modal.dataset.restoreMiscMore = '0';
  }
  try {
    window.AndroidInterface?.stopNativeAdbScan?.();
  } catch (e) {}
  if (lastFocusedElement && document.body.contains(lastFocusedElement)) {
    lastFocusedElement.focus({ preventScroll: true });
  }
  lastFocusedElement = null;
    restoreGroupModalOverlay();
}

function restartAdbScan() {
  try {
    window.AndroidInterface?.stopNativeAdbScan?.();
  } catch (e) {}
  setTimeout(() => {
    try { window.AndroidInterface?.startNativeAdbScan?.(); } catch (err) {}
  }, 250);
}

function renderAdbScanHosts() {
  const list = document.getElementById('adbScanList');
  if (!list) return;
  list.innerHTML = '';
  if (!adbScanState.hosts.length) {
    const placeholder = document.createElement('div');
    placeholder.style.opacity = '.7';
    placeholder.style.textAlign = 'center';
    placeholder.textContent = adbScanState.running ? '–ò—â–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞...' : '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
    list.appendChild(placeholder);
    return;
  }
  adbScanState.hosts.forEach(host => {
    const card = document.createElement('button');
    card.type = 'button';
    card.className = 'adb-chip adb-device-card';
    let connectTriggered = false;

    const nameEl = document.createElement('div');
    nameEl.className = 'adb-device-name';
    applyFriendlyNameNode(nameEl, host?.friendlyName);

    const ipEl = document.createElement('div');
    ipEl.className = 'adb-device-ip';
    ipEl.textContent = host?.ip || '‚Äî';

    card.append(nameEl, ipEl);
    const handleConnect = () => {
      if (connectTriggered) return;
      const ip = host?.ip;
      if (!ip) return;
      connectTriggered = true;
      closeAdbScanner();
      setTimeout(() => {
        connectToRemoteAdb(ip, host?.port || 5555);
        connectTriggered = false;
      }, 150);
    };
    const activationKeys = ['Enter', 'OK', 'Select', ' '];

    card.addEventListener('click', (event) => {
      event.preventDefault();
      document.querySelectorAll('#adbScanList .adb-device-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      handleConnect();
    });
    card.addEventListener('focus', () => {
      document.querySelectorAll('#adbScanList .adb-device-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      focusAndRevealAdbCard(card);
    });
    const handleKeyActivation = (event) => {
      if (!activationKeys.includes(event.key)) return;
      event.preventDefault();
      handleConnect();
    };
    card.addEventListener('keydown', handleKeyActivation);
    card.addEventListener('keyup', handleKeyActivation);
    card.addEventListener('keypress', handleKeyActivation);
    list.appendChild(card);
  });
}

function updateAdbScanStatus(message = null, totalOverride = null) {
  const status = document.getElementById('adbScanStatus');
  if (!status) return;
  if (typeof message === 'string' && message.length) {
    adbScanState.status = message;
  }
  const running = !!adbScanState.running;
  const fallback = running ? '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏‚Ä¶' : '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ';
  const base = adbScanState.status || fallback;
  const total = typeof totalOverride === 'number' ? totalOverride : adbScanState.hosts.length;

  status.classList.toggle('adb-scan-complete', !running);
  status.textContent = '';

  const label = document.createElement('span');
  label.className = 'adb-scan-label';
  label.textContent = base;
  status.appendChild(label);

  if (running) {
    const spinnerWrap = document.createElement('span');
    spinnerWrap.className = 'spin adb-scan-spinwrap';
    const spinnerImg = document.createElement('img');
    spinnerImg.src = 'https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png';
    spinnerImg.alt = '';
    spinnerImg.className = 'adb-scan-spinner';
    spinnerWrap.appendChild(spinnerImg);
    status.appendChild(spinnerWrap);
  }

  const totalSpan = document.createElement('span');
  totalSpan.className = 'adb-scan-total';
  totalSpan.textContent = `‚Ä¢ –ù–∞–π–¥–µ–Ω–æ: ${total}`;
  status.appendChild(totalSpan);
}

window.__applyAdbScanResults = function(payload) {
  let data = [];
  try {
    data = Array.isArray(payload) ? payload : JSON.parse(payload);
  } catch (e) {
    console.error('applyAdbScanResults parse error', e);
    return;
  }
  if (!Array.isArray(data)) data = [];
  adbScanState.hosts = data;
  renderAdbScanHosts();
  updateAdbScanStatus();
};

window.__handleAdbScanStatus = function(message, running, total) {
  if (typeof running === 'boolean') {
    adbScanState.running = running;
  }
  updateAdbScanStatus(typeof message === 'string' ? message : null, typeof total === 'number' ? total : null);
};

function connectToRemoteAdb(ip, port) {
  ignoreNextEnter = true;
  try {
    if (window.AndroidInterface?.connectAdbToHost) {
      window.AndroidInterface.connectAdbToHost(ip, port);
    } else if (window.AndroidInterface?.connectAdbTo) {
      window.AndroidInterface.connectAdbTo(`${ip}:${port}`);
    } else if (window.AndroidInterface?.connectAdb) {
      window.AndroidInterface.connectAdb(`${ip}:${port}`);
    } else {
      showToast({ message: '–ú–µ—Ç–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ADB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', type: 'error' });
    }
  } catch (e) {
    showToast({ message: '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ADB', type: 'error' });
  }
}

function attachAdbManualInputHandlers() {
  ['adbManualHostInput', 'adbManualPortInput'].forEach((id) => {
    const input = document.getElementById(id);
    if (input && !input.dataset.manualBound) {
      input.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          event.preventDefault();
          submitAdbManualConnect();
        }
      });
      input.dataset.manualBound = '1';
    }
  });
}

function openAdbManualConnectModal() {
  const modal = document.getElementById('adbManualConnectModal');
  if (!modal) return;
  ignoreNextEnter = true;
  const miscModal = document.getElementById('miscModal');
  const miscMoreModal = document.getElementById('miscMoreModal');
  const scannerModal = document.getElementById('adbScannerModal');
  modal.dataset.restoreMisc = '0';
  modal.dataset.restoreMiscMore = '0';
  modal.dataset.restoreScanner = '0';
  if (miscModal && miscModal.style.display === 'flex') {
    miscModal.setAttribute('inert', '');
    miscModal.style.pointerEvents = 'none';
    modal.dataset.restoreMisc = '1';
  }
  if (miscMoreModal && miscMoreModal.style.display === 'flex') {
    miscMoreModal.setAttribute('inert', '');
    miscMoreModal.style.pointerEvents = 'none';
    modal.dataset.restoreMiscMore = '1';
  }
  if (scannerModal && scannerModal.style.display === 'flex') {
    scannerModal.setAttribute('inert', '');
    scannerModal.style.pointerEvents = 'none';
    modal.dataset.restoreScanner = '1';
  }
  lastFocusedElementManualConnect = document.activeElement;
  document.activeElement?.blur();
  modal.style.display = 'flex';
  bringModalToFront(modal);
  document.body.classList.add('modal-open');

  const hostInput = document.getElementById('adbManualHostInput');
  const portInput = document.getElementById('adbManualPortInput');
  try {
    const raw = window.AndroidInterface?.getLastAdbConnectionInfo?.();
    if (raw && raw !== 'undefined') {
      const info = JSON.parse(raw);
      if (hostInput && !hostInput.value.trim()) hostInput.value = info.host || '';
      if (portInput && !portInput.value.trim()) {
        const lastPort = parseInt(info.port, 10);
        if (Number.isFinite(lastPort) && lastPort > 0) portInput.value = String(lastPort);
      }
    }
  } catch (err) {
    console.warn('prefill manual connect error', err);
  }

  attachAdbManualInputHandlers();

  setTimeout(() => hostInput?.focus({ preventScroll: true }), 120);
}

function closeAdbManualConnectModal() {
  const modal = document.getElementById('adbManualConnectModal');
  if (!modal) return;
  modal.style.display = 'none';
  document.body.classList.remove('modal-open');

  let needRestoreModalClass = false;

  if (modal.dataset.restoreMisc === '1') {
    const misc = document.getElementById('miscModal');
    if (misc) {
      misc.removeAttribute('inert');
      misc.style.pointerEvents = '';
      if (misc.style.display === 'flex') needRestoreModalClass = true;
    }
    modal.dataset.restoreMisc = '0';
  }
  if (modal.dataset.restoreMiscMore === '1') {
    const miscMore = document.getElementById('miscMoreModal');
    if (miscMore) {
      miscMore.removeAttribute('inert');
      miscMore.style.pointerEvents = '';
      if (miscMore.style.display === 'flex') needRestoreModalClass = true;
    }
    modal.dataset.restoreMiscMore = '0';
  }
  if (modal.dataset.restoreScanner === '1') {
    const scanner = document.getElementById('adbScannerModal');
    if (scanner) {
      scanner.removeAttribute('inert');
      scanner.style.pointerEvents = '';
      if (scanner.style.display === 'flex') needRestoreModalClass = true;
    }
    modal.dataset.restoreScanner = '0';
  }

  if (needRestoreModalClass) {
    document.body.classList.add('modal-open');
  }

  if (lastFocusedElementManualConnect && document.body.contains(lastFocusedElementManualConnect)) {
    setTimeout(() => lastFocusedElementManualConnect?.focus({ preventScroll: true }), 50);
  }
  lastFocusedElementManualConnect = null;
}

function submitAdbManualConnect() {
  const hostInput = document.getElementById('adbManualHostInput');
  const portInput = document.getElementById('adbManualPortInput');
  const host = hostInput?.value?.trim();
  if (!host) {
    showToast({ message: '–í–≤–µ–¥–∏—Ç–µ IP –∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', type: 'warning' });
    hostInput?.focus({ preventScroll: true });
    return;
  }
  let port = parseInt(portInput?.value, 10);
  if (!Number.isFinite(port) || port <= 0) port = 5555;
  port = Math.min(65535, Math.max(1, port));
  if (portInput) portInput.value = String(port);

  ignoreNextEnter = true;
  const modal = document.getElementById('adbManualConnectModal');
  const shouldReturnToFast = modal?.dataset?.restoreScanner === '1';
  closeAdbManualConnectModal();

  const ai = window.AndroidInterface;
  if (ai && typeof ai.connectAdbToHost === 'function') {
    ai.connectAdbToHost(host, port);
  } else if (ai && typeof ai.connectAdbTo === 'function') {
    ai.connectAdbTo(`${host}:${port}`);
  } else if (ai && typeof ai.connectAdb === 'function') {
    ai.connectAdb(`${host}:${port}`);
  } else {
    showToast({ message: '–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ADB –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', type: 'error' });
  }
  if (shouldReturnToFast) {
    closeAdbScanner();
    setTimeout(() => {
      if (document.getElementById('miscModal')?.style.display !== 'flex') {
        openMiscModal();
      }
    }, 200);
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ –≤ —Å–∫–∞–Ω–µ—Ä–µ ADB
function focusAndRevealAdbCard(el, margin = 12) {
  if (!el) return;
  const container = document.getElementById('adbScanListContainer');
  if (!container) return;
  const cr = container.getBoundingClientRect();
  const er = el.getBoundingClientRect();
  if (er.top < cr.top + margin) container.scrollTop -= (cr.top + margin - er.top);
  else if (er.bottom > cr.bottom - margin) container.scrollTop += (er.bottom - (cr.bottom - margin));
  requestAnimationFrame(() => el.focus({ preventScroll: true }));
}

function focusLastAdbConnectionButton(scrollToTop = false) {
  const btn = document.getElementById('lastAdbConnectionBtn');
  const wrap = document.getElementById('lastAdbConnectionWrapper');
  if (!btn || !wrap || wrap.style.display === 'none') return false;
  if (scrollToTop) {
    const container = document.getElementById('adbScanListContainer');
    if (container) container.scrollTop = 0;
    const content = document.querySelector('#adbScannerModal .modal-content');
    if (content) content.scrollTop = 0;
  }
  document.querySelectorAll('#adbScanList .adb-device-card.selected').forEach(c => c.classList.remove('selected'));
  requestAnimationFrame(() => btn.focus({ preventScroll: true }));
  return true;
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –º–æ–¥–∞–ª–∫–µ —Å–∫–∞–Ω–µ—Ä–∞ ADB
    function selectCard(card) {
      document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      currentGroup = card.dataset.group;
      const s = document.getElementById('status'); s.innerHTML = ""; s.classList.remove('visible');
    }

    function disablePackages(packages) {
      const list = Array.isArray(packages)
        ? packages
        : String(packages || "")
            .split(',')
            .map(p => p.trim())
            .filter(Boolean);

      if (!list.length) return;

      const actionLabel = '–û—Ç–∫–ª/–≤–∫–ª —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è';
      const ai = getAdbInterfaceOrWarn(actionLabel);
      if (!ai) return;
      if (!ensureAdbSessionConnected(actionLabel)) return;

      const key = list.join('|').toLowerCase();
      const nextDisable = !(disablePackageStates.get(key) ?? false);
      disablePackageStates.set(key, nextDisable);

      const payload = { packages: list, disable: nextDisable };

      try {
        if (typeof ai.disablePackage === 'function') {
          ai.disablePackage(JSON.stringify(payload));
          return;
        }
      } catch (e) {
        console.warn('disablePackages error', e);
      }

      try {
        window.AndroidInterface?.disablePackage(JSON.stringify(payload));
      } catch (err) {
        console.warn('disablePackages fallback error', err);
        showToast({ message: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã ADB', type: 'error' });
      }
    }

    function handleConfirmWipeThirdPartyApps() {
      const actionLabel = '–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π';
      const ai = getAdbInterfaceOrWarn(actionLabel);
      if (!ai) return;
      if (!ensureAdbSessionConnected(actionLabel)) return;
      if (typeof ai.confirmWipeThirdPartyApps !== 'function') {
        showToast({ message: '–§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ', type: 'error' });
        return;
      }
      try {
        ai.confirmWipeThirdPartyApps();
      } catch (err) {
        console.warn('confirmWipeThirdPartyApps error', err);
        showToast({ message: '–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ', type: 'error' });
      }
    }

    function handleOpenApkFilePicker() {
      ignoreNextEnter = true;

      const method = window.AndroidInterface?.getInstallMethod?.() || 'sai';
      if (method === 'adb' && !isAdbSessionConnected()) {
        showToast({
          message: '–í—ã–±—Ä–∞–Ω —Å–ø–æ—Å–æ–± ¬´ADB¬ª, –Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ ADB –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–∞ ¬´–ë—ã—Å—Ç—Ä–∞—è¬ª –ª–∏–±–æ ¬´–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è¬ª.',
          type: 'warning'
        });
        return;
      }

      try {
        window.AndroidInterface?.openApkFilePicker();
      } catch (err) {
        console.warn('openApkFilePicker error', err);
        showToast({ message: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –≤—ã–±–æ—Ä APK', type: 'error' });
      }
    }

    function formatBytesAsStorage(valueMb) {
      if (!Number.isFinite(valueMb) || valueMb < 0) return 'n/a';
      if (valueMb < 1024) {
        return `${Math.round(valueMb)} MB`;
      }
      return `${(valueMb / 1024).toFixed(2)} GB`;
    }

    function showDeviceStats() {
      ignoreNextEnter = true;
      const ai = window.AndroidInterface;
      const adbConnected = isAdbSessionConnected();
      if (!ai) {
        showToast({ message: '‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', type: 'error' });
        return;
      }
      try {
        if (adbConnected && typeof ai.showCpuRamToastAdb === 'function') {
          ai.showCpuRamToastAdb();
        } else if (typeof ai.showCpuRamToast === 'function') {
          ai.showCpuRamToast();
        } else {
          showToast({ message: '‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', type: 'error' });
        }
      } catch (err) {
        console.warn('showDeviceStats error', err);
        showToast({ message: '‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞', type: 'error' });
      }
    }
    function installFastInstaller() {
      ignoreNextEnter = true;
      if (!isAdbSessionConnected()) {
        showToast({ message: '‚ùå ADB –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω', type: 'error' });
        return;
      }
      const ai = window.AndroidInterface;
      if (!ai || typeof ai.installSelfApkViaAdb !== 'function') {
        showToast({ message: '‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', type: 'error' });
        return;
      }
      try {
        ai.installSelfApkViaAdb();
      } catch (err) {
        console.warn('installSelfApkViaAdb error', err);
        showToast({ message: '‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏', type: 'error' });
      }
    }

    function createAdbCommandIconNode(iconValue, label) {
      const wrapper = document.createElement('div');
      wrapper.className = 'adb-command-btn__icon';

      if (iconValue && /^(https?:)?\/\//i.test(iconValue)) {
        const img = document.createElement('img');
        img.src = iconValue;
        img.alt = '';
        wrapper.appendChild(img);
        return wrapper;
      }

      const text = (iconValue || label || '?').replace(/^gmd_/, '').trim();
      wrapper.textContent = text.length ? text[0].toUpperCase() : 'A';
      return wrapper;
    }

    function renderAdbCommandsList() {
      const list = document.getElementById('adbCommandsList');
      if (!list) return;
      list.innerHTML = '';

      const commands = ADB_COMMANDS.filter(item => item && item.isEnabled !== false);
      if (!commands.length) {
        const placeholder = document.createElement('div');
        placeholder.id = 'adbCommandsEmpty';
        placeholder.textContent = '–ö–æ–º–∞–Ω–¥—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –≤ index.html';
        list.appendChild(placeholder);
        return;
      }

      commands.forEach((item, index) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'adb-command-btn';
        btn.setAttribute('tabindex', '0');
        btn.dataset.index = String(index);

        const iconNode = createAdbCommandIconNode(item.icon, item.label);
        const textWrap = document.createElement('div');
        textWrap.className = 'adb-command-btn__text';

        const title = document.createElement('div');
        title.className = 'adb-command-btn__label';
        title.textContent = item.label || `–ö–æ–º–∞–Ω–¥–∞ #${index + 1}`;

        const body = document.createElement('div');
        body.className = 'adb-command-btn__command';
        body.textContent = item.description || item.command || '';

        textWrap.append(title, body);
        btn.append(iconNode, textWrap);

        const exec = () => {
          sendAdbCommand(item.command, item.label);
          if ([1001, 1002, 1003, 1004, 1005, 1006, 1007].includes(item.id)) {
            setTimeout(() => {
              resetAdbConnectionState();
            }, 300);
          }
        };
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          exec();
        });
        btn.addEventListener('keydown', (event) => {
          if (['Enter', 'OK', 'NumpadEnter', ' '].includes(event.key)) {
            event.preventDefault();
            exec();
          }
        });
        btn.addEventListener('focus', () => {
          document.querySelectorAll('#adbCommandsList .adb-command-btn').forEach(el => el.classList.remove('selected'));
          btn.classList.add('selected');
        });

        list.appendChild(btn);
      });
    }

    function focusAndRevealAdbCommand(el, margin = 12) {
      if (!el) return;
      const container = document.getElementById('adbCommandsListContainer');
      if (!container) return;
      const cr = container.getBoundingClientRect();
      const er = el.getBoundingClientRect();
      if (er.top < cr.top + margin) {
        container.scrollTop -= (cr.top + margin - er.top);
      } else if (er.bottom > cr.bottom - margin) {
        container.scrollTop += (er.bottom - (cr.bottom - margin));
      }
      requestAnimationFrame(() => el.focus({ preventScroll: true }));
    }

    function buildAdbCommandsHeader(triggerBtn) {
      const header = document.getElementById('adbCommandsHeader');
      if (!header) return;
      header.innerHTML = '';
      const source = triggerBtn?.closest?.('button, .sys-btn, .card') || triggerBtn || null;

      const icon = source?.querySelector?.('img');
      if (icon) {
        const iconClone = icon.cloneNode(true);
        iconClone.style.height = '26px';
        iconClone.style.width = '26px';
        iconClone.style.objectFit = 'contain';
        header.appendChild(iconClone);
      } else {
        const fallbackIcon = document.createElement('img');
        fallbackIcon.src = 'https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png';
        fallbackIcon.alt = '';
        fallbackIcon.style.height = '26px';
        fallbackIcon.style.width = '26px';
        fallbackIcon.style.objectFit = 'contain';
        header.appendChild(fallbackIcon);
      }

      const title = document.createElement('span');
      title.textContent = source?.innerText?.trim() || 'ADB –∫–æ–º–∞–Ω–¥—ã';
      header.appendChild(title);
    }

    // –°–±—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥, –µ—Å–ª–∏ —Ñ–æ–∫—É—Å —É—à—ë–ª –∏–∑ —Å–ø–∏—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –∏–∫–æ–Ω–∫–∏ –≤ —à–∞–ø–∫–µ)
    function bindAdbCommandsFocusReset() {
      const modal = document.getElementById('adbCommandsModal');
      if (!modal || modal.dataset.focusResetBound) return;
      modal.dataset.focusResetBound = '1';
      modal.addEventListener('focusin', (e) => {
        const list = document.getElementById('adbCommandsList');
        if (!list) return;
        if (!list.contains(e.target)) {
          document.querySelectorAll('#adbCommandsList .adb-command-btn.selected')
            .forEach(el => el.classList.remove('selected'));
        }
      });
    }

    function openAdbCommandsModal(triggerBtn = null) {
      bindAdbCommandsFocusReset();
      const modal = document.getElementById('adbCommandsModal');
      if (!modal) return;

      const miscModal = document.getElementById('miscModal');
      const miscMoreModal = document.getElementById('miscMoreModal');
      modal.dataset.restoreMisc = '0';
      modal.dataset.restoreMiscMore = '0';

      if (miscModal && miscModal.style.display === 'flex') {
        miscModal.setAttribute('inert', '');
        miscModal.style.pointerEvents = 'none';
        modal.dataset.restoreMisc = '1';
      }
      if (miscMoreModal && miscMoreModal.style.display === 'flex') {
        miscMoreModal.setAttribute('inert', '');
        miscMoreModal.style.pointerEvents = 'none';
        modal.dataset.restoreMiscMore = '1';
      }

      const originBtn = triggerBtn || lastAdbCommandsTriggerButton || document.activeElement;
      lastFocusedElementAdbCommands = originBtn || document.activeElement;
      document.activeElement?.blur();

      buildAdbCommandsHeader(originBtn);

      renderAdbCommandsList();
      const closeBtn = document.getElementById('adbCommandsCloseBtn');
      if (closeBtn && !closeBtn.dataset.focusBound) {
        closeBtn.dataset.focusBound = '1';
        closeBtn.addEventListener('focus', () => {
          document.querySelectorAll('#adbCommandsList .adb-command-btn.selected')
            .forEach(btn => btn.classList.remove('selected'));
        });
      }
      modal.style.display = 'flex';
      bringModalToFront(modal);
      document.body.classList.add('modal-open');

      const list = document.getElementById('adbCommandsList');
      setTimeout(() => {
        const first = list?.querySelector('.adb-command-btn');
        if (first) {
          focusAndRevealAdbCommand(first);
        } else {
          document.getElementById('adbCommandsCloseBtn')?.focus({ preventScroll: true });
        }
      }, 100);
    }

    function closeAdbCommandsModal() {
      const modal = document.getElementById('adbCommandsModal');
      if (!modal) return;

      modal.style.display = 'none';
      modal.style.zIndex = '';
      document.body.classList.remove('modal-open');
      document.querySelectorAll('#adbCommandsList .adb-command-btn.selected').forEach(btn => btn.classList.remove('selected'));

      let needRestoreModalClass = false;
      if (modal.dataset.restoreMisc === '1') {
        const misc = document.getElementById('miscModal');
        if (misc) {
          misc.removeAttribute('inert');
          misc.style.pointerEvents = '';
          if (misc.style.display === 'flex') needRestoreModalClass = true;
        }
        modal.dataset.restoreMisc = '0';
      }
      if (modal.dataset.restoreMiscMore === '1') {
        const miscMore = document.getElementById('miscMoreModal');
        if (miscMore) {
          miscMore.removeAttribute('inert');
          miscMore.style.pointerEvents = '';
          if (miscMore.style.display === 'flex') needRestoreModalClass = true;
        }
        modal.dataset.restoreMiscMore = '0';
      }
      if (!needRestoreModalClass && anyModalOpen()) {
        needRestoreModalClass = true;
      }
      if (needRestoreModalClass) {
        document.body.classList.add('modal-open');
      }

      const target = lastFocusedElementAdbCommands;
      lastFocusedElementAdbCommands = null;
      if (target && document.body.contains(target)) {
        setTimeout(() => target.focus({ preventScroll: true }), 60);
      }
      lastAdbCommandsTriggerButton = null;
      restoreGroupModalOverlay();
    }

    function sendAdbCommand(command, label) {
      const trimmed = (command || '').trim();
      if (!trimmed) {
        showToast({ message: '–ö–æ–º–∞–Ω–¥–∞ –Ω–µ –∑–∞–¥–∞–Ω–∞', type: 'warning' });
        return;
      }
      const ai = window.AndroidInterface;
      if (!ai || typeof ai.runAdbShellCommand !== 'function') {
        showToast({ message: 'ADB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ', type: 'error' });
        return;
      }
      try {
        ai.runAdbShellCommand(trimmed, label || '');
      } catch (err) {
        console.error('ADB command error', err);
        showToast({ message: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É', type: 'error' });
      }
    }

    function applyBatteryOptimizationWhitelist() {
      return runAdbBatch({
        items: BATTERY_WHITELIST_PACKAGES,
        perItemStatus: (pkg) => {
          showStatus(
            `‚ö° ${pkg}: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è <span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`,
            "#00cfff",
            2500
          );
        },
        buildCommands: (pkg) => ([
          { command: `dumpsys deviceidle whitelist +${pkg}`, label: `Whitelist ${pkg}` },
          { command: `appops set ${pkg} RUN_ANY_IN_BACKGROUND allow`, label: `Run in background ${pkg}` }
        ]),
        doneStatusMessage: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è'
      });
    }

    function getAdbInterfaceOrWarn(actionLabel) {
      const ai = window.AndroidInterface;
      if (!ai || typeof ai.runAdbShellCommand !== 'function') {
        const message = actionLabel
          ? `ADB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${actionLabel}`
          : 'ADB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ';
        showToast({ message, type: 'error' });
        return null;
      }
      return ai;
    }

    function isAdbSessionConnected() {
      try {
        const raw = window.AndroidInterface?.getAdbConnectionInfo?.();
        if (!raw || raw === 'undefined') return false;
        const info = typeof raw === 'string' ? JSON.parse(raw) : raw;
        return !!info?.connected;
      } catch (err) {
        console.warn('isAdbSessionConnected parse error', err);
        return false;
      }
    }

    function ensureAdbSessionConnected(actionLabel) {
      if (isAdbSessionConnected()) return true;
      const message = actionLabel
        ? `ADB –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω: ${actionLabel}`
        : 'ADB –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω';
      showToast({ message, type: 'error' });
      return false;
    }

    function getUserPackages() {
      try {
        const api = window.AndroidInterface;
        if (!api || typeof api.getUserInstalledPackages !== 'function') return [];
        const raw = api.getUserInstalledPackages();
        if (!raw || raw === 'undefined') return [];
        const data = typeof raw === 'string' ? JSON.parse(raw) : raw;
        if (!Array.isArray(data)) return [];
        return data
          .map((pkg) => (typeof pkg === 'string' ? pkg.trim() : ''))
          .filter((pkg) => pkg.length > 0);
      } catch (err) {
        console.warn('getUserPackages error', err);
        showToast({ message: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π', type: 'error' });
        return [];
      }
    }

    const MODAL_ADB_HEADER_IDS = [
      'miscHeader',
      'miscMoreHeader',
      'adbScannerHeader',
      'adbManualHeader',
      'adbCommandsHeader',
      'screenSaverHeader',
      'modalGroupHeader',
      'atvAppsHeader'
    ];
    const MODAL_ADB_HEADER_SELECTOR = MODAL_ADB_HEADER_IDS.map((id) => `#${id}`).join(', ');

    function createModalAdbIndicator() {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'modal-adb-indicator disconnected';
      const img = document.createElement('img');
      img.src = ADB_ICON_DISCONNECTED;
      img.alt = 'ADB —Å—Ç–∞—Ç—É—Å';
      img.loading = 'lazy';
      btn.appendChild(img);
      btn.setAttribute('aria-label', 'ADB –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
      btn.title = 'ADB –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω';
      btn.addEventListener('click', reconnectLastAdbFromChip);
      return btn;
    }

    function createModalQuickActionButton(action) {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'modal-quick-action';
      btn.style.width = '36px';
      btn.style.height = '36px';
      btn.style.padding = '4px';
      btn.style.border = '2px solid transparent';
      btn.style.borderRadius = '50%';
      btn.style.background = 'transparent';
      btn.style.display = 'inline-flex';
      btn.style.alignItems = 'center';
      btn.style.justifyContent = 'center';
      btn.style.transition = 'border-color .2s ease, box-shadow .2s ease, background-color .2s ease';
      btn.dataset.action = action.key;
      btn.title = action.label;
      btn.setAttribute('aria-label', action.label);

      const img = document.createElement('img');
      img.src = action.icon;
      img.alt = action.label;
      img.loading = 'lazy';
      btn.appendChild(img);

      btn.addEventListener('click', (event) => {
        event.preventDefault();
        event.stopPropagation();
        lowerGroupModalForOverlay();
        try {
          action.run?.(btn, event);
        } catch (err) {
          console.warn(`modal quick action ${action.key} failed`, err);
        }
      });

      // focus/hover —Å—Ç–∏–ª–∏ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ CSS, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∏)
      btn.addEventListener('focus', () => {
        btn.style.borderColor = '#fff';
        btn.style.boxShadow = '0 0 0 2px rgba(255,255,255,0.25)';
        btn.style.background = 'rgba(255,255,255,0.08)';
      });
      btn.addEventListener('blur', () => {
        btn.style.borderColor = 'transparent';
        btn.style.boxShadow = 'none';
        btn.style.background = 'transparent';
      });
      btn.addEventListener('mouseenter', () => {
        btn.style.borderColor = '#fff';
        btn.style.boxShadow = '0 0 0 2px rgba(255,255,255,0.25)';
        btn.style.background = 'rgba(255,255,255,0.08)';
      });
      btn.addEventListener('mouseleave', () => {
        btn.style.borderColor = 'transparent';
        btn.style.boxShadow = 'none';
        btn.style.background = 'transparent';
      });

      return btn;
    }

    function ensureModalQuickActions(container, content, indicator) {
      const modalEl = content?.closest?.('.modal');
      const isAtv = modalEl && modalEl.id === 'atvAppsModal';

      if (modalEl && modalEl.id === 'adbScannerModal') {
        container.querySelectorAll('.modal-quick-action').forEach((btn) => btn.remove());
        return;
      }

      const skipKeys = new Set();
      if (content?.querySelector?.('#adbCommandsHeader')) {
        skipKeys.add('modal-action-adb-commands');
      }
      if (content?.querySelector?.('#screenSaverHeader')) {
        skipKeys.add('modal-action-screen-saver');
      }

      const allowedActions = isAtv
        ? [modalActionAtvRefresh]
        : MODAL_HEADER_ACTIONS.filter((action) => !skipKeys.has(action.key) && action.key !== 'modal-action-atv-refresh');
      const allowedKeys = new Set(allowedActions.map((action) => action.key));

      container.querySelectorAll('.modal-quick-action').forEach((btn) => {
        const key = btn.dataset.action;
        if (!allowedKeys.has(key)) {
          btn.remove();
        }
      });

      const insertBeforeNode = indicator && indicator.parentElement === container ? indicator : null;
      allowedActions.forEach((action) => {
        if (!action) return;
        let btn = container.querySelector(`.modal-quick-action[data-action="${action.key}"]`);
        if (!btn) {
          btn = createModalQuickActionButton(action);
        }
        if (insertBeforeNode) {
          container.insertBefore(btn, insertBeforeNode);
        } else if (!btn.parentElement) {
          container.appendChild(btn);
        }
      });

      // –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫ —Å–æ–≥–ª–∞—Å–Ω–æ allowedActions
      allowedActions.forEach((action) => {
        if (!action) return;
        const btn = container.querySelector(`.modal-quick-action[data-action="${action.key}"]`);
        if (!btn || !indicator) return;
        const currentOrder = Array.from(container.children);
        const targetIndex = currentOrder.indexOf(indicator);
        const btnIndex = currentOrder.indexOf(btn);
        if (btnIndex > targetIndex || btn.nextSibling !== indicator) {
          container.insertBefore(btn, indicator);
        }
      });
    }

    function bringModalToFront(modal) {
      if (!modal) return;
      modalOverlayCounter += MODAL_Z_STEP;
      modal.style.zIndex = String(modalOverlayCounter);
    }

    function lowerGroupModalForOverlay() {
      const groupModal = document.getElementById('modal');
      if (!groupModal) return;
      if (groupModal.style.display !== 'flex') return;
      if (groupModal.dataset.overlaySuppressed === '1') return;
      groupModal.dataset.overlaySuppressed = '1';
      groupModal.style.zIndex = '900';
    }

    function restoreGroupModalOverlay() {
      const groupModal = document.getElementById('modal');
      if (!groupModal) return;
      if (groupModal.dataset.overlaySuppressed !== '1') return;
      delete groupModal.dataset.overlaySuppressed;
      groupModal.style.zIndex = '';
    }

    function ensureModalAdbIndicators() {
      const headerSelector = MODAL_ADB_HEADER_SELECTOR;
      document.querySelectorAll('.modal .modal-content').forEach((content) => {
        const hasHeader = headerSelector ? content.querySelector(headerSelector) : false;
        if (!hasHeader) {
          const tools = content.querySelector('.modal-header-tools');
          if (tools) {
            tools.remove();
          }
          const strayIndicator = content.querySelector('.modal-adb-indicator');
          if (strayIndicator && strayIndicator.parentElement === content) {
            strayIndicator.remove();
          }
          return;
        }

        let tools = content.querySelector('.modal-header-tools');
        if (!tools) {
          tools = document.createElement('div');
          tools.className = 'modal-header-tools';
          content.appendChild(tools);
        } else if (!tools.classList.contains('modal-header-tools')) {
          tools.className = 'modal-header-tools';
        }

        let indicator = tools.querySelector('.modal-adb-indicator');
        if (!indicator) {
          indicator = content.querySelector('.modal-adb-indicator') || createModalAdbIndicator();
          tools.appendChild(indicator);
        } else if (indicator.parentElement !== tools) {
          tools.appendChild(indicator);
        }

        ensureModalQuickActions(tools, content, indicator);
      });
    }

    function ensureModalHeaderStructure(header) {
      if (!header) return null;
      header.classList.add('modal-header');
      let titleWrap = header.querySelector('.modal-header-title');
      if (!titleWrap) {
        titleWrap = document.createElement('span');
        titleWrap.className = 'modal-header-title';
        while (header.firstChild) {
          titleWrap.appendChild(header.firstChild);
        }
        header.appendChild(titleWrap);
      }
      return titleWrap;
    }

    function setModalHeaderTitle(headerId, builder) {
      const header = document.getElementById(headerId);
      if (!header) return null;
      const titleWrap = ensureModalHeaderStructure(header);
      if (!titleWrap) return null;
      if (typeof builder === 'function') {
        titleWrap.innerHTML = '';
        builder(titleWrap);
      }
      return titleWrap;
    }

    function initModalAdbHeaders() {
      MODAL_ADB_HEADER_IDS.forEach((id) => {
        const header = document.getElementById(id);
        if (header) {
          ensureModalHeaderStructure(header);
        }
      });
      ensureModalAdbIndicators();
      syncModalAdbIndicators();
    }

    function syncModalAdbIndicators(forceState) {
      const connected = typeof forceState === 'boolean' ? forceState : isAdbSessionConnected();
      const title = connected
        ? 'ADB –ø–æ–¥–∫–ª—é—á–µ–Ω. –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è'
        : 'ADB –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω. –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
      const iconSrc = connected ? ADB_ICON_CONNECTED : ADB_ICON_DISCONNECTED;
      document.querySelectorAll('.modal-adb-indicator').forEach((btn) => {
        btn.classList.toggle('connected', connected);
        btn.classList.toggle('disconnected', !connected);
        btn.setAttribute('aria-label', title);
        btn.title = title;
        const img = btn.querySelector('img');
        if (img && img.src !== iconSrc) {
          img.src = iconSrc;
        }
      });
    }

    function reconnectLastAdbFromChip(event) {
      event?.preventDefault?.();
      event?.stopPropagation?.();
      refreshLastAdbConnection();
      const btn = document.getElementById('lastAdbConnectionBtn');
      const host = btn?.dataset?.host?.trim();
      if (!host) {
        showToast({ message: '–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ ADB-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', type: 'warning' });
        return;
      }
      showToast({ message: '–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É ADB‚Ä¶', type: 'blue', duration: 2500 });
      connectToLastAdb();
    }

    function runAdbBatch(options = {}) {
      ignoreNextEnter = true;
      const {
        items = [],
        buildCommands = () => [],
        startMessage = '',
        doneMessage = '',
        doneStatusMessage = '',
        emptyMessage = '',
        adbActionLabel = '',
        perItemStatus = null,
        delay = 450,
        silent = true
      } = options;

      const queue = (items || [])
        .map(item => typeof item === 'string' ? item.trim() : item)
        .filter(item => {
          if (typeof item === 'string') return item.length > 0;
          return !!item;
        });

      if (!queue.length) {
        if (emptyMessage) showToast({ message: emptyMessage, type: 'warning' });
        return Promise.resolve(false);
      }

      const ai = getAdbInterfaceOrWarn(adbActionLabel || startMessage || '–æ–ø–µ—Ä–∞—Ü–∏—è');
      if (!ai) return Promise.resolve(false);

      if (startMessage) {
        showToast({ message: startMessage, type: 'info', duration: 4000 });
      }

      let index = 0;

      return new Promise((resolve) => {
        const finish = () => {
          const statusText = doneStatusMessage || doneMessage;
          if (statusText) {
            showToast({ message: statusText, type: 'success' });
            showStatus(`‚úÖ ${statusText}`, '#00cfff', 4000);
          } else if (doneMessage) {
            showToast({ message: doneMessage, type: 'success' });
          }
          resolve(true);
        };

        const tick = () => {
          if (index >= queue.length) {
            finish();
            return;
          }
          const item = queue[index++];
          const cmdsRaw = buildCommands(item) || [];
          const commands = Array.isArray(cmdsRaw) ? cmdsRaw : [cmdsRaw];
          commands.forEach(entry => {
            const command = typeof entry === 'string' ? entry : entry?.command;
            if (!command) return;
            const label = typeof entry === 'object' ? (entry.label || '') : '';
            try {
              ai.runAdbShellCommand(command, label || '', !!silent);
            } catch (err) {
              console.warn('ADB batch error', err);
              showToast({ message: `–û—à–∏–±–∫–∞: ${command}`, type: 'error' });
            }
          });
          if (typeof perItemStatus === 'function') {
            perItemStatus(item, index, queue.length);
          }
          setTimeout(tick, delay);
        };

        tick();
      });
    }

    function normalizeListenerComponent(entry) {
      if (!entry) return null;
      const pkg = (entry.pkg || '').trim();
      let component = (entry.service || '').trim();
      if (!pkg || !component) return null;
      if (component.startsWith('/')) {
        component = `${pkg}${component}`;
      }
      if (component.startsWith('.')) {
        component = `${pkg}${component}`;
      }
      if (!component.includes('/')) {
        component = `${pkg}/${component}`;
      }
      return component;
    }

    function applyUsageStatsAccess() {
      return runAdbBatch({
        items: USAGE_STATS_PACKAGES,
        buildCommands: (pkg) => [
          { command: `pm grant ${pkg} android.permission.PACKAGE_USAGE_STATS`, label: `Grant usage stats ${pkg}` },
          { command: `appops set ${pkg} GET_USAGE_STATS allow`, label: `AppOps usage ${pkg}` }
        ],
        perItemStatus: (pkg) => {
          showStatus(`üìä ${pkg}: –æ–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è`, '#00cfff', 2500);
        }
      });
    }

    function applyManageStorageAccess() {
      return runAdbBatch({
        items: MANAGE_STORAGE_PACKAGES,
        buildCommands: (pkg) => ({
          command: `appops set --uid ${pkg} MANAGE_EXTERNAL_STORAGE allow`,
          label: `Storage access ${pkg}`
        }),
        perItemStatus: (pkg) => {
          showStatus(`üíæ ${pkg}: MANAGE_EXTERNAL_STORAGE`, '#00cfff', 2500);
        }
      });
    }

    function applyUnknownSourcesPermission() {
      const actionLabel = '–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤';
      if (window.AndroidInterface?.grantUnknownSourcesPermissionsAsync) {
        if (!ensureAdbSessionConnected(actionLabel)) return Promise.resolve(false);
        try {
          window.AndroidInterface.grantUnknownSourcesPermissionsAsync();
          return Promise.resolve(true);
        } catch (err) {
          console.warn('grantUnknownSourcesPermissionsAsync failed, fallback to JS', err);
        }
      }
      if (!ensureAdbSessionConnected(actionLabel)) return Promise.resolve(false);
      const ai = getAdbInterfaceOrWarn(actionLabel);
      if (!ai || typeof ai.runAdbShellCommandWithResult !== 'function') {
        showToast({ message: '–ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ runAdbShellCommandWithResult', type: 'error' });
        return Promise.resolve(false);
      }
      const packages = getUserPackages();
      if (!packages.length) {
        showToast({ message: '–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', type: 'warning' });
        return Promise.resolve(false);
      }

      return new Promise((resolve) => {
        const queue = [...packages];
        let failures = 0;
        const delayMs = 180;
        const concurrency = Math.min(3, queue.length);

        const sleep = (ms) => new Promise((res) => setTimeout(res, ms));

        const handlePackage = async (pkg) => {
          let primaryOk = false;
          try {
            primaryOk = !!ai.runAdbShellCommandWithResult(
              `appops set ${pkg} REQUEST_INSTALL_PACKAGES allow`,
              `Unknown sources ${pkg}`,
              true
            );
          } catch (err) {
            console.warn('Unknown sources primary command error', err);
          }
          if (!primaryOk) {
            let fallbackOk = false;
            try {
              fallbackOk = !!ai.runAdbShellCommandWithResult(
                `appops set --uid ${pkg} REQUEST_INSTALL_PACKAGES allow`,
                `Unknown sources UID ${pkg}`,
                true
              );
            } catch (err) {
              console.warn('Unknown sources fallback command error', err);
            }
            if (!fallbackOk) {
              failures += 1;
            }
          }
          await sleep(delayMs);
        };

        const worker = async () => {
          while (queue.length) {
            const pkg = queue.shift();
            if (!pkg) break;
            await handlePackage(pkg);
          }
        };

        showToast({ message: '–û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É APK‚Ä¶', type: 'info' });

        Promise.all(
          Array.from({ length: concurrency || 1 }, () => worker())
        ).then(() => {
          const statusText = failures
            ? `–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤—ã–¥–∞–Ω–æ, –Ω–æ ${failures} –ø–∞–∫–µ—Ç–æ–≤ —Å–æ–æ–±—â–∏–ª–æ –æ–± –æ—à–∏–±–∫–µ`
            : '–í—ã–¥–∞–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É APK –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤';
          showToast({ message: statusText, type: failures ? 'warning' : 'success' });
          resolve(true);
        });
      });
    }

    function applyOverlayAccess() {
      return runAdbBatch({
        items: OVERLAY_PACKAGES,
        buildCommands: (pkg) => ({
          command: `appops set ${pkg} SYSTEM_ALERT_WINDOW allow`,
          label: `Overlay ${pkg}`
        }),
        perItemStatus: (pkg) => {
          showStatus(`ü™ü ${pkg}: SYSTEM_ALERT_WINDOW`, '#00cfff', 2500);
        }
      });
    }

    function applyMicrophonePermission() {
      if (window.AndroidInterface?.grantMicrophonePermissionsAsync) {
        const actionLabel = '–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞';
        if (!ensureAdbSessionConnected(actionLabel)) return Promise.resolve(false);
        try {
          window.AndroidInterface.grantMicrophonePermissionsAsync();
          return Promise.resolve(true);
        } catch (err) {
          console.warn('grantMicrophonePermissionsAsync failed, fallback to JS', err);
        }
      }
      if (!MICROPHONE_PERMISSION) {
        showToast({ message: '–ù–µ –∑–∞–¥–∞–Ω–æ –∏–º—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞', type: 'warning' });
        return Promise.resolve(false);
      }
      const actionLabel = '–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞';
      if (!ensureAdbSessionConnected(actionLabel)) return Promise.resolve(false);
      const ai = getAdbInterfaceOrWarn(actionLabel);
      if (!ai || typeof ai.runAdbShellCommandWithResult !== 'function') {
        showToast({ message: '–ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ runAdbShellCommandWithResult', type: 'error' });
        return Promise.resolve(false);
      }
      const dynamicPackages = getUserPackages();
      const manualPackages = Array.isArray(MICROPHONE_PERMISSION_PACKAGES) ? MICROPHONE_PERMISSION_PACKAGES : [];
      const packages = Array.from(new Set([...manualPackages, ...dynamicPackages])).filter(Boolean);
      if (!packages.length) {
        showToast({ message: '–ù–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –≤—ã–¥–∞—á–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞', type: 'warning' });
        return Promise.resolve(false);
      }

      return new Promise((resolve) => {
        const queue = [...packages];
        const delayMs = 150;
        const concurrency = Math.min(3, queue.length);

        const sleep = (ms) => new Promise((res) => setTimeout(res, ms));

        const handlePackage = async (pkg) => {
          try {
            ai.runAdbShellCommandWithResult(
              `pm grant ${pkg} ${MICROPHONE_PERMISSION}`,
              `Grant mic ${pkg}`,
              true
            );
          } catch (err) {
            console.warn('applyMicrophonePermission error', pkg, err);
          }
          await sleep(delayMs);
        };

        const worker = async () => {
          while (queue.length) {
            const pkg = queue.shift();
            if (!pkg) break;
            await handlePackage(pkg);
          }
        };

        showToast({ message: '–í—ã–¥–∞—ë–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞‚Ä¶', type: 'info' });

        Promise.all(
          Array.from({ length: concurrency || 1 }, () => worker())
        ).then(() => {
          const statusText = '–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ';
          showToast({ message: statusText, type: 'success' });
          resolve(true);
        });
      });
    }

    function applyWriteSettingsAccess() {
      return runAdbBatch({
        items: WRITE_SETTINGS_PACKAGES,
        buildCommands: (pkg) => ({
          command: `appops set ${pkg} WRITE_SETTINGS allow`,
          label: `Write settings ${pkg}`
        }),
        perItemStatus: (pkg) => {
          showStatus(`‚öôÔ∏è ${pkg}: WRITE_SETTINGS`, '#00cfff', 2500);
        }
      });
    }

    function applyExactAlarmAccess() {
      return runAdbBatch({
        items: EXACT_ALARM_PACKAGES,
        buildCommands: (pkg) => ({
          command: `appops set ${pkg} SCHEDULE_EXACT_ALARM allow`,
          label: `Exact alarm ${pkg}`
        }),
        perItemStatus: (pkg) => {
          showStatus(`‚è∞ ${pkg}: —Ç–æ—á–Ω—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏`, '#00cfff', 2500);
        }
      });
    }

    function applyNotificationListeners() {
      return runAdbBatch({
        items: NOTIFICATION_LISTENER_SERVICES,
    buildCommands: (entry) => {
      const component = normalizeListenerComponent(entry);
      if (!component) return [];
      return [{
        command: `cmd notification allow_listener ${component}`,
        label: `Allow listener ${component}`
      }];
    },
    perItemStatus: (entry) => {
      const pkg = entry?.pkg || entry;
      showStatus(`üîî ${pkg}: —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π`, '#00cfff', 2500);
    }
  });
}

function applyAccessibilityServices() {
  const ai = getAdbInterfaceOrWarn('–í–∫–ª—é—á–µ–Ω–∏–µ —Å–ª—É–∂–± –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏');
  if (!ai) return Promise.resolve(false);
  if (!Array.isArray(ACCESSIBILITY_SERVICES) || !ACCESSIBILITY_SERVICES.length) {
    showToast({ message: '–ù–µ—Ç —Å–ª—É–∂–± –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞', type: 'warning' });
    return Promise.resolve(false);
  }
  const joined = ACCESSIBILITY_SERVICES.join(':');
  const commands = [
    {
      command: `settings put secure enabled_accessibility_services "${joined}"`,
      label: 'Enable accessibility services'
    },
    {
      command: 'settings put secure accessibility_enabled 1',
      label: 'Accessibility toggle'
    }
  ];
  if (Array.isArray(ACCESSIBILITY_PACKAGES) && ACCESSIBILITY_PACKAGES.length) {
    ACCESSIBILITY_PACKAGES.forEach((pkg) => {
      commands.push({
        command: `appops set ${pkg} ACCESS_RESTRICTED_SETTINGS allow`,
        label: `Restricted settings ${pkg}`
      });
      commands.push({
        command: `appops set --uid ${pkg} ACCESS_RESTRICTED_SETTINGS allow`,
        label: `Restricted settings uid ${pkg}`
      });
    });
  }
  let hasError = false;
  commands.forEach(({ command, label }) => {
    try {
      ai.runAdbShellCommand(command, label, true);
    } catch (err) {
      hasError = true;
      console.warn('applyAccessibilityServices error', err);
      showToast({ message: `–û—à–∏–±–∫–∞: ${label || command}`, type: 'error' });
    }
  });
  if (!hasError) {
    showStatus('‚ôø –°–ª—É–∂–±—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–∫–ª—é—á–µ–Ω—ã', '#00cfff', 4000);
    showToast({ message: '–î–æ—Å—Ç—É–ø –∫ —Å–ª—É–∂–±–∞–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—ã–¥–∞–Ω', type: 'success' });
  }
  return Promise.resolve(!hasError);
}

    function applyDefaultKeyboardIme() {
      return new Promise((resolve) => {
        const ai = getAdbInterfaceOrWarn('–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã');
        if (!ai) {
          resolve(false);
          return;
        }
        if (!DEFAULT_KEYBOARD_IME) {
          showToast({ message: '–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –Ω–µ –∑–∞–¥–∞–Ω', type: 'warning' });
          resolve(false);
          return;
        }

        const commands = [
          { command: `ime enable ${DEFAULT_KEYBOARD_IME}`, label: 'Enable keyboard IME' },
          { command: `ime set ${DEFAULT_KEYBOARD_IME}`, label: 'Set keyboard IME' }
        ];

        const runImeCommands = () => {
          commands.forEach(({ command, label }) => {
            try {
              ai.runAdbShellCommand(command, label, true);
            } catch (err) {
              console.warn('applyDefaultKeyboardIme command error', err);
            }
          });
        };

        const isTargetImeActive = () => {
          try {
            const value = window.AndroidInterface?.getCurrentInputMethod?.();
            if (!value || value === 'undefined') return false;
            return value.trim() === DEFAULT_KEYBOARD_IME;
          } catch (err) {
            console.warn('isTargetImeActive error', err);
            return false;
          }
        };

        const ensureIme = (silent = false) => {
          if (isTargetImeActive()) {
            if (!silent) {
              showStatus('‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ LeanKey –≤–∫–ª—é—á–µ–Ω–∞ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é', '#00cfff', 4000);
              showToast({ message: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π', type: 'success' });
            }
            return true;
          }
          runImeCommands();
          setTimeout(() => {
            if (isTargetImeActive() && !silent) {
              showStatus('‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ LeanKey –≤–∫–ª—é—á–µ–Ω–∞ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é', '#00cfff', 4000);
              showToast({ message: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π', type: 'success' });
            }
          }, 1000);
          return false;
        };

        const finalize = () => resolve(true);

        const initialApplied = ensureIme();
        if (initialApplied) {
          finalize();
          return;
        }
        setTimeout(() => ensureIme(true), 2000);
        setTimeout(finalize, 2500);
      });
    }

    function applyScreenSaverDefaults() {
      const ai = getAdbInterfaceOrWarn('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞—Å—Ç–∞–≤–∫–∏');
      if (!ai) return Promise.resolve(false);
      const commands = [
        { command: 'settings put system screen_off_timeout 1800000', label: 'Screen off timeout' },
        { command: 'settings put secure sleep_timeout 28800000', label: 'Sleep timeout' }
      ];
      let hasError = false;
      commands.forEach(({ command, label }) => {
        try {
          ai.runAdbShellCommand(command, label, true);
        } catch (err) {
          hasError = true;
          console.warn('applyScreenSaverDefaults error', err);
          showToast({ message: `–û—à–∏–±–∫–∞: ${label || command}`, type: 'error' });
        }
      });
      const pkg = DEFAULT_SCREENSAVER_PACKAGE || DEFAULT_SCREENSAVER_COMPONENT?.split('/')?.[0];
      if (!hasError && pkg && window.AndroidInterface?.setScreenSaverPackage) {
        try {
          window.AndroidInterface.setScreenSaverPackage(pkg);
        } catch (err) {
          hasError = true;
          console.warn('setScreenSaverPackage from auto error', err);
        }
      }
      if (!hasError) {
        showStatus('üåå Aerial Views –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞, —Ç–∞–π–º–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã', '#00cfff', 4000);
        showToast({ message: '–ó–∞—Å—Ç–∞–≤–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞', type: 'success' });
      }
      return Promise.resolve(!hasError);
    }

    const wait = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

    // === Spatial navigation helpers (–≥–µ–æ–º–µ—Ç—Ä–∏—è –≤–º–µ—Å—Ç–æ rows/cols) ===
    function getFocusable(scope = document) {
      return Array.from(scope.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'))
        .filter(el => !el.disabled && el.offsetParent !== null);
    }

    function center(rect) {
      return { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
    }

    function findNextByDirection(currentEl, direction, scopeEl) {
      const items = getFocusable(scopeEl);
      if (!currentEl || !items.length) return null;
      const cur = center(currentEl.getBoundingClientRect());
      const isH = direction === 'left' || direction === 'right';

      const fitsDirection = (dx, dy) => {
        if (direction === 'left') return dx < -2;
        if (direction === 'right') return dx > 2;
        if (direction === 'up') return dy < -2;
        if (direction === 'down') return dy > 2;
        return false;
      };

      const slope = 1.2;
      const pad = 32;
      const bandH = 36; // –¥–µ—Ä–∂–∏–º —Ä—è–¥ –ø—Ä–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
      const bandV = 48; // –¥–µ—Ä–∂–∏–º –∫–æ–ª–æ–Ω–∫—É –ø—Ä–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

      const withinBand = (dx, dy) => {
        const adx = Math.abs(dx);
        const ady = Math.abs(dy);
        if (isH) {
          // –î–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏: —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π —Ä—è–¥ (—É–∑–∫–∞—è –ø–æ–ª–æ—Å–∞)
          return ady <= bandH;
        }
        // –î–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –ø–æ–∫–∞ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫—É, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–µ–∂–Ω–∏–π –∫–æ–Ω—É—Å/—Ñ–æ–ª–±—ç–∫
        return true;
      };

      const withinCone = (dx, dy) => {
        const adx = Math.abs(dx);
        const ady = Math.abs(dy);
        if (isH) return ady <= adx * slope + pad;
        return adx <= ady * slope + pad;
      };

      const scoreItem = (dx, dy, penalty = 0) => {
        const primary = isH ? Math.abs(dx) : Math.abs(dy);
        const secondary = isH ? Math.abs(dy) : Math.abs(dx);
        return primary + secondary * 0.1 + penalty;
      };

      const pick = (opts) => {
        let best = null;
        let bestScore = Infinity;
        let bestIndex = -1;
        items.forEach((el, idx) => {
          if (el === currentEl) return;
          const c = center(el.getBoundingClientRect());
          const dx = c.x - cur.x;
          const dy = c.y - cur.y;
          if (!fitsDirection(dx, dy)) return;
          if (opts.band && !withinBand(dx, dy)) return;
          if (opts.cone && !withinCone(dx, dy)) return;
          const score = scoreItem(dx, dy, opts.penalty || 0);
          if (score < bestScore - 1e-6 || (Math.abs(score - bestScore) < 1e-6 && idx < bestIndex)) {
            bestScore = score;
            best = el;
            bestIndex = idx;
          }
        });
        return best;
      };

      // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: —Å—Ç–∞—Ä–∞–µ–º—Å—è –¥–µ—Ä–∂–∞—Ç—å —Ç–æ—Ç –∂–µ —Ä—è–¥/–∫–æ–ª–æ–Ω–∫—É
      let cand = pick({ band: true });
      if (cand) return cand;
      // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –∫–æ–Ω—É—Å
      cand = pick({ cone: true });
      if (cand) return cand;
      // –§–æ–ª–±—ç–∫: –ª—é–±–æ–µ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å –ª—ë–≥–∫–∏–º —à—Ç—Ä–∞—Ñ–æ–º
      cand = pick({ cone: false, penalty: 50 });
      return cand;
    }

    function handleDpadInScope(e, scopeEl) {
      const dir = e.key === 'ArrowLeft' ? 'left'
        : e.key === 'ArrowRight' ? 'right'
          : e.key === 'ArrowUp' ? 'up'
            : e.key === 'ArrowDown' ? 'down' : null;
      if (!dir) return;
      const active = document.activeElement;
      if (!scopeEl.contains(active)) return;
      e.preventDefault();
      const next = findNextByDirection(active, dir, scopeEl);
      if (next) {
        try { next.focus({ preventScroll: true }); } catch (_) { next.focus(); }
        try { next.scrollIntoView({ block: 'nearest', inline: 'nearest' }); } catch (_) { next.scrollIntoView(); }
      }
    }

    function focusFirst(scope) {
      const first = getFocusable(scope)[0];
      if (first) {
        try { first.focus({ preventScroll: true }); } catch (_) { first.focus(); }
      }
    }

const NAVIGATION_MODALS = [
      // 'installMethodModal', // –ª–æ–∫–∞–ª—å–Ω—ã–π —Ö–µ–Ω–¥–ª–µ—Ä, –∏—Å–∫–ª—é—á–∞–µ–º –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ DPAD
      'atvAppActionsModal',
      'adbManualConnectModal',
      'screenSaverTimeoutModal',
      'adbCommandsModal',
      'adbScannerModal',
      'miscMoreModal',
      'miscModal',
      'atvAppsModal',
      'screenSaverModal',
      'autostartModal',
      'modal'
    ];

    document.addEventListener('keydown', (e) => {
      // Back/Escape –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∏–∂–µ –æ—Ç–¥–µ–ª—å–Ω–æ
      if (e.key === 'Back' || e.key === 'Escape') return;

      // –°–ø–µ—Ü-–ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ —Ç–∞–π–º–∞—É—Ç–∞ –∑–∞—Å—Ç–∞–≤–∫–∏:
      // –µ—Å–ª–∏ —Ñ–æ–∫—É—Å –≤ –∏–Ω–ø—É—Ç–µ –∏ —Å—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑ ‚Äî –∏–¥—ë–º –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"
      if (document.getElementById('screenSaverTimeoutModal')?.style.display === 'flex') {
        const input = document.getElementById('screenSaverTimeoutInput');
        const applyBtn = document.getElementById('screenSaverTimeoutApply');
        const cancelBtn = document.getElementById('screenSaverTimeoutCancel');
        if (document.activeElement === input && e.key === 'ArrowDown' && applyBtn) {
          e.preventDefault();
          try { applyBtn.focus({ preventScroll: true }); } catch (_) { applyBtn.focus(); }
          return;
        }
        if (document.activeElement === cancelBtn && e.key === 'ArrowLeft' && applyBtn) {
          e.preventDefault();
          try { applyBtn.focus({ preventScroll: true }); } catch (_) { applyBtn.focus(); }
          return;
        }
      }

    // –î–ª—è –º–æ–¥–∞–ª–∫–∏ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö–µ–Ω–¥–ª–µ—Ä–æ–º
    if (document.getElementById('installMethodModal')?.style.display === 'flex') {
      return;
    }

      for (const id of NAVIGATION_MODALS) {
        const m = document.getElementById(id);
        if (m && m.style.display === 'flex') {
          handleDpadInScope(e, m);
          return;
        }
      }
    }, true);

    async function runAllAutoPermissions() {
      const actionLabel = '–ê–≤—Ç–æ—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è';
      if (!getAdbInterfaceOrWarn(actionLabel)) return;
      if (!ensureAdbSessionConnected(actionLabel)) return;
      showToast({ message: '–ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π‚Ä¶', type: 'info' });

      try {
        await Promise.all([
          applyBatteryOptimizationWhitelist(),
          applyUsageStatsAccess(),
          applyManageStorageAccess(),
          applyOverlayAccess(),
          applyWriteSettingsAccess(),
          applyExactAlarmAccess(),
          applyAccessibilityServices(),
          applyScreenSaverDefaults(),
          applyNotificationListeners()
        ]);

        await applyUnknownSourcesPermission();
        await applyMicrophonePermission();

        await wait(2500);
        await applyDefaultKeyboardIme();
        await wait(300);
      } catch (err) {
        console.warn('runAllAutoPermissions error', err);
      } finally {
        try {
          window.AndroidInterface?.onAutoPermissionsFinished?.();
        } catch (err) {
          console.warn('onAutoPermissionsFinished error', err);
        }
      }
    }


    function openAdbCommandsFromButton(triggerBtn) {
      ignoreNextEnter = true;
      lastAdbCommandsTriggerButton = triggerBtn || null;
      try {
        if (window.AndroidInterface?.openRunAdbCommandsModal) {
          window.AndroidInterface.openRunAdbCommandsModal();
          return;
        }
      } catch (err) {
        console.warn('openRunAdbCommandsModal failed, fallback to JS modal', err);
      }
      openAdbCommandsModal(triggerBtn);
    }

    function openScreenSaverModal(triggerBtn = null) {
      lastScreenSaverTrigger = triggerBtn || document.activeElement;
      document.activeElement?.blur();
      const modal = document.getElementById('screenSaverModal');
      if (!modal) return;
  setModalHeaderTitle('screenSaverHeader', (container) => {
    try {
      const btn = triggerBtn || document.querySelector('.system-buttons .sys-btn[onclick*="openScreenSaverModal"]');
      const btnIcon = btn?.querySelector('img');
      const titleText = btn?.innerText?.trim() || '–ó–∞—Å—Ç–∞–≤–∫–∞';
      const fallbackIcon = 'https://appassets.androidplatform.net/assets/webview/icons/misc/ic12_ScreenServer.png';
      const iconSrc = btnIcon?.src || fallbackIcon;
      if (iconSrc) {
        const icon = document.createElement('img');
        icon.src = iconSrc;
        icon.alt = '';
        icon.style.height = '25px';
        icon.style.width = '25px';
        icon.style.objectFit = 'contain';
        container.appendChild(icon);
      }
      const title = document.createElement('span');
      title.textContent = titleText;
      container.appendChild(title);
    } catch (_e) {
      container.textContent = '–ó–∞—Å—Ç–∞–≤–∫–∞';
    }
  });
      modal.style.display = 'flex';
      bringModalToFront(modal);
      document.body.classList.add('modal-open');
      requestScreenSaverState();
      setTimeout(() => {
    const focusTarget = modal.querySelector('.screen-saver-body .sys-btn');
        focusTarget?.focus({ preventScroll: true });
      }, 80);
    }

    function closeScreenSaverModal() {
      const modal = document.getElementById('screenSaverModal');
      if (!modal) return;
      const timeoutModal = document.getElementById('screenSaverTimeoutModal');
      if (timeoutModal && timeoutModal.style.display === 'flex') {
        closeScreenSaverTimeoutModal();
      }
      modal.style.display = 'none';
      modal.style.zIndex = '';
      document.body.classList.remove('modal-open');
      const target = lastScreenSaverTrigger;
      lastScreenSaverTrigger = null;
      if (target && document.body.contains(target)) {
        setTimeout(() => target.focus({ preventScroll: true }), 60);
      }
      restoreGroupModalOverlay();
    }

    function requestScreenSaverState() {
      window.AndroidInterface?.requestScreenSaverState();
    }

    window.updateScreenSaverState = function(payload) {
      let data = payload;
      try {
        if (typeof payload === 'string') {
          data = JSON.parse(payload);
        }
      } catch (e) {
        data = {};
      }
      const stateEl = document.getElementById('screenSaverState');
      const currentEl = document.getElementById('screenSaverCurrent');
      const idleBtn = document.getElementById('screenSaverIdleBtn');
      const sleepBtn = document.getElementById('screenSaverSleepBtn');
      const toggleBtn = document.getElementById('screenSaverToggleBtn');

      const enabled = data?.enabled ?? false;
      currentScreenSaverComponent = typeof data?.component === 'string' && data.component.trim().length ? data.component : null;
      stateEl.textContent = enabled ? '–í–∫–ª—é—á–µ–Ω–∞' : '–û—Ç–∫–ª—é—á–µ–Ω–∞';
      stateEl.style.color = enabled ? '#00e676' : '#ff5252';

      currentEl.textContent = data?.current || '‚Äî';

      const screenMinutes = msToMinutes(data?.screenTimeoutMs);
      const sleepMinutes = msToMinutes(data?.sleepTimeoutMs);
      screenSaverTimeoutState.screen = screenMinutes;
      screenSaverTimeoutState.sleep = sleepMinutes;
      if (idleBtn) {
        idleBtn.textContent = formatMinutesLabel(screenMinutes);
      }
      if (sleepBtn) {
        sleepBtn.textContent = formatMinutesLabel(sleepMinutes);
      }
      if (toggleBtn) {
        toggleBtn.textContent = enabled ? '–û—Ç–∫–ª—é—á–∏—Ç—å –∑–∞—Å—Ç–∞–≤–∫—É' : '–í–∫–ª—é—á–∏—Ç—å –∑–∞—Å—Ç–∞–≤–∫—É';
      }
    }

    function msToMinutes(ms) {
      if (!Number.isFinite(ms) || ms <= 0) return null;
      const minutes = Math.round(ms / 60000);
      if (!Number.isFinite(minutes) || minutes <= 0) return null;
      return minutes;
    }

    function formatMinutesLabel(minutes) {
      if (!Number.isFinite(minutes) || minutes <= 0) return '‚Äî';
      return `${minutes} –º–∏–Ω`;
    }

    function openScreenSaverTimeoutModal(type) {
      const modal = document.getElementById('screenSaverTimeoutModal');
      if (!modal) return;
      screenSaverTimeoutModalType = type;
      const label = SCREEN_SAVER_TIMEOUT_LABELS[type] || '–¢–∞–π–º–µ—Ä';
      const parent = document.getElementById('screenSaverModal');
      modal.dataset.restoreScreen = '0';
      if (parent && parent.style.display === 'flex') {
        parent.setAttribute('inert', '');
        parent.style.pointerEvents = 'none';
        modal.dataset.restoreScreen = '1';
      }
      screenSaverTimeoutReturnEl = document.activeElement;
      document.activeElement?.blur();
      modal.style.display = 'flex';
      bringModalToFront(modal);
      document.body.classList.add('modal-open');
      const value = sanitizeScreenSaverMinutes(screenSaverTimeoutState[type], type);
      setScreenSaverTimeoutInput(value);
      document.getElementById('screenSaverTimeoutTitle').textContent = label;
      document.getElementById('screenSaverTimeoutLabel').textContent = `–ú–∏–Ω—É—Ç—ã –¥–ª—è: ${label}`;
      setTimeout(() => {
        document.getElementById('screenSaverTimeoutInput')?.focus({ preventScroll: true });
      }, 80);
    }

    function closeScreenSaverTimeoutModal() {
      const modal = document.getElementById('screenSaverTimeoutModal');
      if (!modal || modal.style.display !== 'flex') return;
      modal.style.display = 'none';
      modal.style.zIndex = '';
      if (modal.dataset.restoreScreen === '1') {
        const parent = document.getElementById('screenSaverModal');
        if (parent) {
          parent.removeAttribute('inert');
          parent.style.pointerEvents = '';
        }
        modal.dataset.restoreScreen = '0';
      }
      if (!anyModalOpen()) {
        document.body.classList.remove('modal-open');
      } else {
        document.body.classList.add('modal-open');
      }
      if (screenSaverTimeoutReturnEl && document.body.contains(screenSaverTimeoutReturnEl)) {
        screenSaverTimeoutReturnEl.focus({ preventScroll: true });
      }
      screenSaverTimeoutReturnEl = null;
      screenSaverTimeoutModalType = null;
    }

    function sanitizeScreenSaverMinutes(value, type) {
      const fallback = SCREEN_SAVER_TIMEOUT_DEFAULTS[type] ?? SCREEN_SAVER_TIMEOUT_DEFAULTS.screen;
      let minutes = parseInt(value, 10);
      if (!Number.isFinite(minutes) || minutes <= 0) {
        minutes = fallback;
      }
      return clampScreenSaverMinutes(minutes);
    }

    function clampScreenSaverMinutes(value) {
      return Math.min(SCREEN_SAVER_TIMEOUT_LIMITS.max, Math.max(SCREEN_SAVER_TIMEOUT_LIMITS.min, value));
    }

    function setScreenSaverTimeoutInput(value) {
      const input = document.getElementById('screenSaverTimeoutInput');
      if (!input) return;
      input.value = clampScreenSaverMinutes(value);
    }

    function applyScreenSaverTimeout() {
      if (!screenSaverTimeoutModalType) {
        closeScreenSaverTimeoutModal();
        return;
      }
      const input = document.getElementById('screenSaverTimeoutInput');
      if (!input) return;
      let minutes = parseInt(input.value, 10);
      if (!Number.isFinite(minutes)) {
        showToast({ message: '–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º–∏–Ω—É—Ç–∞—Ö', type: 'warning' });
        input.focus({ preventScroll: true });
        return;
      }
      minutes = clampScreenSaverMinutes(minutes);
      const ai = window.AndroidInterface;
      if (!ai || typeof ai.setScreenSaverTimeout !== 'function') {
        showToast({ message: '–§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', type: 'error' });
        closeScreenSaverTimeoutModal();
        return;
      }
      ai.setScreenSaverTimeout(screenSaverTimeoutModalType, minutes * 60000);
      closeScreenSaverTimeoutModal();
    }

    function setScreenSaverPackage(pkg) {
      if (!pkg) return;
      window.AndroidInterface?.setScreenSaverPackage(pkg);
    }

    function RunScreenSaverSettings() {
      const component = currentScreenSaverComponent || '';
      window.AndroidInterface?.runScreenSaverPreview?.(component);
    }

    function toggleScreenSaver() {
      window.AndroidInterface?.toggleScreenSaverEnabled();
    }

    function resetScreenSaverSettings() {
      window.AndroidInterface?.resetScreenSaverSettings();
    }

    // === –ö–æ–Ω—Ñ–∏–≥ (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç) –∏ —Ä–µ–Ω–¥–µ—Ä –≥—Ä—É–ø–ø ===
    function getConfigUrl() {
      // URL –∫–æ–Ω—Ñ–∏–≥–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      return window.AndroidInterface?.getConfigUrl?.() || "";
    }

    async function ensureConfig() {
      if (cachedConfig) return cachedConfig;
      const url = getConfigUrl();
      const r = await fetch(url, { cache: 'no-store' });
      if (!r.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥');
      const cfg = await r.json();
      cachedConfig = cfg;
      return cfg;
    }

    function createGroupIcon(url) {
      const isSvg = /\.svg(\?|$)/i.test(url);
      const makeImg = () => {
        const img = document.createElement('img');
        img.src = url;
        img.alt = '';
        img.style.height = '25px';
        img.style.width = '25px';
        img.style.objectFit = 'contain';
        return img;
      };

      if (!isSvg) return makeImg();

      const img = makeImg();
      img.onerror = () => {
        // –§–æ–ª–±—ç–∫: CSS background-image (—á–∞—Å—Ç–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ WebView, –∫–æ–≥–¥–∞ <img> —Å SVG –Ω–µ—Ç)
        const box = document.createElement('div');
        box.style.width = '25px';
        box.style.height = '25px';
        box.style.backgroundImage = `url("${url}")`;
        box.style.backgroundRepeat = 'no-repeat';
        box.style.backgroundSize = 'contain';
        box.style.backgroundPosition = 'center';
        img.replaceWith(box);
      };
      return img;
    }

    function renderGroupsFromConfig(config) {
      const container = document.getElementById('groupCards') || document.querySelector('.card-container');
      if (!container) return;
      container.innerHTML = '';

      const groups = config.groups || {};
      const entries = Object.entries(groups);
      if (!entries.length) {
        container.innerHTML = '<div style="opacity:.7">–ù–µ—Ç –≥—Ä—É–ø–ø</div>';
        return;
      }

      entries.forEach(([groupKey, groupObj]) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('tabindex', '0');
        card.dataset.group = groupKey;

        if (groupObj && groupObj.icon) {
          const iconEl = createGroupIcon(groupObj.icon);
          card.appendChild(iconEl);
        }
        card.appendChild(document.createTextNode(groupKey));

        card.onclick = () => { selectCard(card); startInstall(); };
        card.onfocus = () => selectCard(card);

        container.appendChild(card);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      initModalAdbHeaders();
      ensureConfig()
        .then(cfg => { renderGroupsFromConfig(cfg); })
        .catch(() => { /* –ø–æ–∫–∞–∂–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å */ });
      refreshAdbStatusIndicator();
      setInterval(refreshAdbStatusIndicator, 5000);
      refreshLastAdbConnection();
    });

    let lastStartAttempt = 0;
    const START_DEBOUNCE_MS = 500;

    async function startInstall() {
      const now = Date.now();
      if (now - lastStartAttempt < START_DEBOUNCE_MS) return;
      lastStartAttempt = now;

      const group = currentGroup;
      const password = savedPassword;
      const status = document.getElementById('status');
      if (!group) { status.innerHTML = "‚ùó –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç."; status.style.color = "red"; status.classList.add('visible'); return; }

      try {
        const config = await ensureConfig();
        const groupInfo = (config.groups || {})[group];
        if (!groupInfo) { status.innerHTML = "‚ùå –ì—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"; status.style.color = "red"; status.classList.add('visible'); return; }
        if ((groupInfo.password || "") !== (password || "")) { showToast({ message: "üîí –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!" }); return; }
        cachedConfig = config;
        lastFocusedElement = document.activeElement;
        showGroupList(config);
      } catch (error) {
        status.innerHTML = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏."; status.style.color = "red"; status.classList.add('visible');
      }
    }

    function showStatus(message, color, timeout = 4000) {
      const status = document.getElementById('status');
      status.innerHTML = message; status.style.color = color; status.classList.add('visible');
      clearTimeout(status.hideTimer);
      status.hideTimer = setTimeout(() => status.classList.remove('visible'), timeout);
    }

    function getToastStack(position = 'bottom-center') {
      const id = `toast-stack-${position}`; let stack = document.getElementById(id);
      if (stack) return stack;
      const [v,h] = position.split('-');
      stack = document.createElement('div');
      stack.id = id;
      stack.className = `toast-stack toast-stack--${v} ${h === 'center' ? 'toast-stack--centerX' : (h === 'left' ? 'toast-stack--left' : 'toast-stack--right')} ${v === 'center' ? 'toast-stack--center' : ''}`;
      document.body.appendChild(stack);
      return stack;
    }
    function showToast({ message, type="info", iconUrl=null, withSpin=false, position="bottom-center", variant="default", duration=3000, anchor=null, offset=10, colors=null }) {
      if (!message) return;
      const styles = {
        success: { bg: "rgba(0,128,0,.85)", text: "#fff" },
        error:   { bg: "rgba(220,0,0,.9)",  text: "#fff" },
        warning: { bg: "rgba(255,165,0,.9)", text: "#000" },
        info:    { bg: "rgba(242,0,0,.85)", text: "#fff" },
        blue:    { bg: "rgba(0,123,255,.9)", text: "#fff" },
        pink:    { bg: "rgba(255,105,180,.9)", text: "#000" }
      };
      const scheme = colors || styles[type] || styles.info;

      const toast = document.createElement('div');
      toast.className = 'toast' + (variant==='pill'?' toast--pill':'') + (variant==='compact'?' toast--compact':'') + (variant==='card'?' toast--card':'');
      toast.style.backgroundColor = scheme.bg; toast.style.color = scheme.text;
      let html = '';
      if (withSpin) html += `<span class="spin">‚è≥</span>`;
      html += `<span>${message}</span>`;
      if (iconUrl) html += `<img src="${iconUrl}" alt="" style="height:20px; width:20px; object-fit:contain; vertical-align:middle;">`;
      toast.innerHTML = html;

      let cleanup;
      if (anchor) {
        const el = typeof anchor === 'string' ? document.querySelector(anchor) : anchor;
        const rect = el?.getBoundingClientRect();
        toast.classList.add('toast--anchored'); document.body.appendChild(toast);
        const top = (rect?.bottom ?? 0) + offset;
        const left = (rect ? rect.left + rect.width / 2 : window.innerWidth / 2);
        toast.style.top = `${top}px`; toast.style.left = `${left}px`; toast.style.transform = 'translateX(-50%)';
        cleanup = () => toast.remove();
      } else {
        const stack = getToastStack(position); stack.appendChild(toast);
        cleanup = () => { toast.remove(); if (!stack.children.length) stack.remove(); };
      }
      requestAnimationFrame(() => toast.classList.add('show'));
      const hide = () => { toast.classList.remove('show'); setTimeout(cleanup, 250); };
      const timer = setTimeout(hide, duration);
      toast.addEventListener('click', () => { clearTimeout(timer); hide(); });
    }

    // ===== –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø—ã =====
    function showGroupList(config)  {
      const modal = document.getElementById('modal');
      const list  = document.getElementById('modalList');
      list.innerHTML = "";


      document.activeElement?.blur();
      document.querySelectorAll('.card.selected').forEach(c => c.classList.remove('selected'));

      modal.style.display = "flex";
      document.body.classList.add("modal-open"); // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      setTimeout(() => { document.querySelector('#modalList .component-btn')?.focus({ preventScroll: true }); }, 80);

      const apps    = (config.apps || []).filter(app => (app.tags || []).includes(currentGroup));
      const backups = (config.backups || []).filter(backup => (backup.tags || []).includes(currentGroup));
      const links   = (config.links || []).filter(link => (link.tags || []).includes(currentGroup));
      if (apps.length === 0 && backups.length === 0 && links.length === 0) list.innerHTML = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.";

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫: –∏–∫–æ–Ω–∫–∞ + –∏–º—è –≥—Ä—É–ø–ø—ã
      setModalHeaderTitle('modalGroupHeader', (container) => {
        const groupInfo = (config.groups || {})[currentGroup];
        if (groupInfo && groupInfo.icon) {
          const iconEl = createGroupIcon(groupInfo.icon);
          iconEl.style.height = '25px';
          iconEl.style.width = '25px';
          container.appendChild(iconEl);
        }
        const title = document.createElement('span');
        title.textContent = currentGroup;
        container.appendChild(title);
      });

      apps.forEach(app => {
        const btn = document.createElement('button');
        btn.className = 'component-btn'; btn.setAttribute('tabindex','0'); btn.textContent = app.file;
        btn.onclick = () => {
          const method = window.AndroidInterface?.getInstallMethod?.() || 'sai';
          const statusMsg = method === 'adb'
            ? `ADB —É—Å—Ç–∞–Ω–æ–≤–∫–∞...<span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`
            : `–ó–∞–≥—Ä—É–∑–∫–∞ APK...<span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`;
          showStatus(statusMsg, "#00cfff", 4000);
          window.AndroidInterface?.installSingle(app.url, app.file || "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ");
        };
        list.appendChild(btn);
      });

      backups.forEach(backup => {
        const btn = document.createElement('button');
        btn.className = 'component-btn'; btn.setAttribute('tabindex','0'); btn.textContent = backup.file;
        btn.onclick = () => {
  if (backup.files) {
    showStatus(`–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤... <span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`, "#00cfff", 4000);
    window.AndroidInterface?.copyFilesWithTargets(JSON.stringify(backup.files));
  } else {
    const urls = backup.urls || (backup.url ? [backup.url] : []);
    if (!urls.length) return;
    showStatus(`–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤... <span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`, "#00cfff", 4000);
    window.AndroidInterface?.copyMultipleBackups(JSON.stringify(urls), backup.target_folder || 'Download');
  }
};
        list.appendChild(btn);
      });

      links.forEach(link => {
        const btn = document.createElement('button');
        btn.className = 'component-btn'; btn.setAttribute('tabindex','0'); btn.textContent = link.file;
        btn.onclick = () => { showStatus("üîó –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏...", "green", 3000); window.AndroidInterface?.openLink(link.url); };
        list.appendChild(btn);
      });

      modal.style.display = "flex";
      setTimeout(() => { document.querySelector('#modalList .component-btn')?.focus({ preventScroll: true }); }, 80);
    }


    

    function installAll() {
  if (window.AndroidInterface) {
    requestAnimationFrame(() => {
      setTimeout(() => {
        window.AndroidInterface.startInstallation(currentGroup);
      }, 100);  // –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ 200-300, –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –Ω–µ –≤–∏–¥–Ω–æ
    });
  }
}

 function installAllSend() {
  /* showStatus("‚è≥ –ù–∞—á–∞–ª–∞—Å—å –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –æ–∂–∏–¥–∞–π—Ç–µ!!! <span class='spin'>‚è≥</span>", "orange", 4000); */
showStatus(`–ù–∞—á–∞–ª–∞—Å—å –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –æ–∂–∏–¥–∞–π—Ç–µ!!!<span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`, "#00cfff", 4000);
 }
    


    function closeModal() {
      const modal = document.getElementById('modal');
      modal.style.display = "none";
      document.body.classList.remove("modal-open"); // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      restoreGroupModalOverlay();
      if (lastFocusedElement && document.body.contains(lastFocusedElement)) {
        if (lastFocusedElement.classList?.contains('card')) selectCard(lastFocusedElement);
        lastFocusedElement.focus?.({ preventScroll: true });
      }
    }

    function handleBackButton() {
      if (document.getElementById('atvAppActionsModal')?.style.display === 'flex') closeAtvAppActions();
      else if (document.getElementById('atvAppsModal')?.style.display === 'flex') closeAtvAppsModal();
      else if (document.getElementById('installMethodModal')?.style.display === 'flex') closeInstallMethodSettings();
      else if (document.getElementById('screenSaverModal')?.style.display === 'flex') closeScreenSaverModal();
      else if (document.getElementById('adbCommandsModal')?.style.display === 'flex') closeAdbCommandsModal();
      else if (document.getElementById('miscMoreModal')?.style.display === 'flex') closeMiscMoreModal();
      else if (document.getElementById('adbManualConnectModal')?.style.display === 'flex') closeAdbManualConnectModal();
      else if (document.getElementById('adbScannerModal')?.style.display === 'flex') closeAdbScanner();
      else if (document.getElementById('miscModal')?.style.display === 'flex') closeMiscModal();
      else if (document.getElementById('autostartModal')?.style.display === 'flex') closeAutostartModal();
      else if (document.getElementById('modal')?.style.display === 'flex') closeModal();
      else { window.AndroidInterface.requestAppExit(); }
    }

    // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ –ø–æ Back/Escape
    document.addEventListener('keydown', (e) => {
      if (e.key !== 'Back' && e.key !== 'Escape') return;
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();
      handleBackButton();
    }, true);

    

   function updateProgress(current=null, total=null, percent=0, label) {
      const container = document.getElementById("progress-container");
      const bar = document.getElementById("progress-bar");
      const text = document.getElementById("progress-text");
      container.style.display = "block"; 
      bar.style.width = percent + "%";
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ undefined –∏ null –∑–Ω–∞—á–µ–Ω–∏—è
      if (current !== null && total !== null && current !== undefined && total !== undefined && label) {
        text.innerHTML = `–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:&nbsp;&nbsp; ${label}&nbsp;&nbsp;&nbsp;&nbsp;${percent}%`;
      } else {
        text.innerText = `–ó–∞–≥—Ä—É–∑–∫–∞...`;
      }
      if (percent >= 100 && (current === null || current === total)) {
        setTimeout(() => { container.style.display = "none"; bar.style.width = "0%"; text.innerHTML = ""; }, 1500);
      }
    }
    function updateProgressWithLabel(current, total, percent, label) {
      const container = document.getElementById("progress-container");
      const bar = document.getElementById("progress-bar");
      const text = document.getElementById("progress-text");
      container.style.display = "block"; bar.style.width = percent + "%"; text.innerText = `–ó–∞–≥—Ä—É–∑–∫–∞ ${label}: ${percent}%`;
      if (percent >= 100 && current === total) setTimeout(() => { container.style.display = "none"; bar.style.width = "0%"; text.innerText = ""; }, 1500);
    }

    function openAutostartModal(opener = null) {
      if (lastAdbIndicatorConnected) {
        showToast({ message: '–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ', type: 'warning', duration: 3500 });
        return;
      }
      autostartOpener = opener instanceof HTMLElement
        ? opener
        : (document.activeElement instanceof HTMLElement ? document.activeElement : null);
      lastFocusedElement = autostartOpener;

      autostartReturnModal = null;
      const miscMore = document.getElementById('miscMoreModal');
      const misc = document.getElementById('miscModal');
      if (miscMore && miscMore.style.display === 'flex') {
        autostartReturnModal = 'miscMore';
        lastFocusedElementMiscMore = null;
        closeMiscMoreModal();
        if (misc && misc.style.display === 'flex') {
          closeMiscModal(false);
        }
      } else if (misc && misc.style.display === 'flex') {
        autostartReturnModal = 'misc';
        closeMiscModal(false);
      }
      const modal = document.getElementById('autostartModal');
      const list = document.getElementById('autostartList');
      const current = document.getElementById('autostartCurrent');
      current.innerHTML = '<span style="color:#00cfff;">–ë–µ–∑ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞</span>';

      window.AndroidInterface?.getCurrentAutostartApp();

      // –°–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–≥–æ —Ñ–æ–∫—É—Å–∞ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º
      document.activeElement?.blur();
      document.body.classList.add('modal-open');
      modal.style.display = 'flex';
      list.innerHTML = '<div style="grid-column:1/-1; text-align:center;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';

      window.AndroidInterface?.getUserApps();

      // –§–æ–ª–±—ç–∫-—Ñ–æ–∫—É—Å, –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–¥—ë—Ç –ø–æ–∑–¥–Ω–æ
      setTimeout(() => {
        const first = list.querySelector('.card');
        if (first) first.focus({ preventScroll: true }); else { modal.setAttribute('tabindex','-1'); modal.focus(); }
      }, 500);
    }

    function setCurrentAutostartApp(appLabel, appIcon) {
      const current = document.getElementById("autostartCurrent");
      current.innerHTML = `
        <span style="font-weight:bold; color:#00cfff;">–ê–∫—Ç–∏–≤–Ω–æ–µ:</span>
        <img src="${appIcon}" alt="" style="height:24px; vertical-align:middle; margin:0 6px;">
        <span style="font-weight:bold;">${appLabel}</span>`;
    }

    function closeAutostartModal() {
      const modal = document.getElementById('autostartModal');
      modal.style.display = 'none';
      document.body.classList.remove('modal-open');

      const returnModal = autostartReturnModal;
      const opener = autostartOpener;
      autostartReturnModal = null;
      autostartOpener = null;

      if (returnModal === 'miscMore') {
        openMiscModal();
        setTimeout(() => {
          openMiscMoreModal();
          if (opener && document.body.contains(opener)) {
            setTimeout(() => opener.focus?.({ preventScroll: true }), 120);
          }
        }, 50);
        return;
      }
      if (returnModal === 'misc') {
        openMiscModal();
        if (opener && document.body.contains(opener)) {
          setTimeout(() => opener.focus?.({ preventScroll: true }), 120);
        }
        return;
      }

      const focusTarget = opener || lastFocusedElement;
      if (focusTarget && document.body.contains(focusTarget)) {
        setTimeout(() => focusTarget.focus?.({ preventScroll: true }), 50);
      }
    }

    /* === helpers –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ === */
    function getAutostartCols() {
      const grid = document.getElementById('autostartList');
      if (!grid) return 5;
      const cs = getComputedStyle(grid);
      const tpl = cs.getPropertyValue('grid-template-columns');
      const count = (tpl || '').split(' ').filter(Boolean).length;
      return count || 5;
    }
    function focusAndRevealAuto(el, margin = 12) {
      const container = document.getElementById('autostartListContainer');
      if (!el || !container) return;
      const cr = container.getBoundingClientRect();
      const er = el.getBoundingClientRect();
      if (er.top < cr.top + margin) container.scrollTop -= (cr.top + margin - er.top);
      else if (er.bottom > cr.bottom - margin) container.scrollTop += (er.bottom - (cr.bottom - margin));
      requestAnimationFrame(() => el.focus({ preventScroll: true }));
    }

    function renderAppSelection(json) {
      const apps = JSON.parse(json);
      const list = document.getElementById('autostartList');
      list.innerHTML = '';

      apps.forEach(app => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('tabindex', '0');
        card.innerHTML = `<img src="${app.icon}" alt="" style="height:24px;"><br>${app.label}`;

        card.onclick = (ev) => {
          ev.preventDefault(); ev.stopPropagation();
          window.AndroidInterface.saveAutostartPackage(app.package);
          setCurrentAutostartApp(app.label, app.icon);
          showToast({ message: `${app.label} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–∞–∫ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫`, iconUrl: app.icon, type: "success" });
        };

        // –í–ê–ñ–ù–û: –Ω–µ –º–µ–Ω—è—Ç—å "–í—ã–±—Ä–∞–Ω–æ" –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ —Ç—ã –ø—Ä–æ—Å–∏–ª
        card.onfocus = () => {
          document.querySelectorAll('#autostartList .card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          const cur = document.getElementById("autostartCurrent");
          if (cur) cur.textContent = "–í—ã–±—Ä–∞–Ω–æ: " + applabel;
          focusAndRevealAuto(card);
        };
        card.onblur = () => card.classList.remove('selected');

        list.appendChild(card);
      });

      // –Ø–≤–Ω–æ —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É –∏ —Å—Ç—Ä–∞—Ö—É–µ–º—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Ñ–æ–∫—É—Å–∞
      const ensureFirstFocus = () => {
        const first = list.querySelector('.card');
        if (!first) return;
        const active = document.activeElement;
        if (!list.contains(active)) first.focus({ preventScroll: true });
      };
      setTimeout(ensureFirstFocus, 50);
      setTimeout(ensureFirstFocus, 200);
      setTimeout(ensureFirstFocus, 600);

      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ª—é–±—ã–µ —Å—Ç–∞—Ä—ã–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
      const hardResetFocus = () => {
        const container = document.getElementById('autostartListContainer');
        if (container) container.scrollTop = 0;
        list.querySelectorAll('.card.selected').forEach(c => c.classList.remove('selected'));
        const first = list.querySelector('.card');
        if (first) {
          first.classList.add('selected');
          first.focus({ preventScroll: true });
        }
      };
      requestAnimationFrame(hardResetFocus);
      setTimeout(hardResetFocus, 0);
      setTimeout(hardResetFocus, 150);
    }

    function disableAutostart() {
      window.AndroidInterface?.DeleteAutostartPackage("");
      const current = document.getElementById('autostartCurrent');
      if (current) current.innerHTML = '<span style="color:#00cfff;">–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –æ—Ç–∫–ª—é—á—ë–Ω</span>';
      showToast({ message: "–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –æ—Ç–∫–ª—é—á—ë–Ω" });
    }

    function hideProgress() {
      const container = document.getElementById('progress-container');
      const bar = document.getElementById('progress-bar');
      const text = document.getElementById('progress-text');
      if (container) container.style.display = 'none';
      if (bar) bar.style.width = '0%';
      if (text) text.innerText = '';
    }

    function onInstalledAppsReceived(appsJson) {
      const container = document.getElementById('appList');
      if (!container) return;
      container.innerHTML = '';
      let apps;
      try { apps = JSON.parse(appsJson); }
      catch (e) { container.innerHTML = '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞.'; return; }

      apps.forEach(app => {
        const btn = document.createElement('button');
        btn.textContent = `${app.name} (${app.package})`;
        btn.onclick = () => { window.AndroidInterface.setAutostartPackage(app.package); alert("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: " + app.name); closeAutostartModal(); };
        container.appendChild(btn);
        container.appendChild(document.createElement('br'));
      });
    }

    // –°–Ω—è—Ç–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å –≥—Ä—É–ø–ø—ã –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –Ω–∏–∂–Ω–∏—Ö –∫–Ω–æ–ø–∫–∞—Ö
    document.querySelectorAll(".system-buttons .sys-btn, #passwordBtn, #startBtn").forEach(btn => {
      btn.addEventListener("focus", () => { document.querySelectorAll(".card").forEach(c => c.classList.remove("selected")); });
    });

    setTimeout(() => {
      document.getElementById('splash').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      document.body.classList.remove('splash-open');
      document.documentElement.classList.remove('splash-open');
      // –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø–æ—Å–ª–µ —Å–ø–ª—ç—à–∞ (—Å–±—Ä–∞—Å—ã–≤–∞–µ–º inline overflow —É <html>)
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    }, 4000);

    // misc modal open/close
    function openMiscModal(triggerBtn=null) {
      lastFocusedElement = document.activeElement;
      const modal = document.getElementById("miscModal");

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–∫–æ–Ω–∫–æ–π –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏–∑ –∫–Ω–æ–ø–∫–∏-—Ç—Ä–∏–≥–≥–µ—Ä–∞ (fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π h3, –µ—Å–ª–∏ #miscHeader –Ω–µ—Ç)
      setModalHeaderTitle('miscHeader', (container) => {
        try {
          const btn = triggerBtn || document.querySelector('.system-buttons .sys-btn[onclick*="openMiscModal"]');
          const img = btn?.querySelector('img');
          const titleText = btn?.innerText?.trim() || '–†–∞–∑–Ω–æ–µ';
          if (img) {
            const icon = document.createElement('img');
            icon.src = img.src;
            icon.alt = '';
            icon.style.height = '25px';
            icon.style.width = '25px';
            icon.style.objectFit = 'contain';
            container.appendChild(icon);
          }
          const title = document.createElement('span');
          title.textContent = titleText;
          container.appendChild(title);
        } catch (e) {
          container.textContent = '–†–∞–∑–Ω–æ–µ';
        }
      });
      modal.style.display = "flex";
      document.body.classList.add("modal-open");
      document.activeElement?.blur();
      const firstBtn = modal.querySelector('.sys-btn');
      if (firstBtn) setTimeout(() => firstBtn.focus(), 100); else modal.focus();
    }
    function closeMiscModal(restoreFocus = true) {
      const modal = document.getElementById("miscModal");
      if (!modal) return;
      modal.style.display = "none";
      document.body.classList.remove("modal-open");
      // –°–±—Ä–æ—Å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –≤–Ω—É—Ç—Ä–∏ ¬´–†–∞–∑–Ω–æ–µ¬ª, —á—Ç–æ–±—ã –Ω–µ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å —Ñ–∏–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
      modal.querySelectorAll('.misc-buttons-container .sys-btn.selected').forEach(b => b.classList.remove('selected'));
      if (restoreFocus) {
        setTimeout(() => {
          if (lastFocusedElement && document.body.contains(lastFocusedElement)) lastFocusedElement.focus?.();
          lastFocusedElement = null;
        }, 50);
      }
    }

    function openMiscMoreModal(triggerBtn = null) {
      const mainModal = document.getElementById("miscModal");
      const moreModal = document.getElementById("miscMoreModal");
      if (!moreModal) return;

      lastFocusedElementMiscMore = triggerBtn || document.activeElement;

      setModalHeaderTitle('miscMoreHeader', (container) => {
        const btn = triggerBtn || document.querySelector('#miscModal .sys-btn[onclick*="openMiscMoreModal"]');
        const img = btn?.querySelector('img');
        const titleText = btn?.innerText?.trim() || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏';
        if (img) {
          const icon = document.createElement('img');
          icon.src = img.src;
          icon.alt = '';
          icon.style.height = '25px';
          icon.style.width = '25px';
          icon.style.objectFit = 'contain';
          container.appendChild(icon);
        }
        const title = document.createElement('span');
        title.textContent = titleText;
        container.appendChild(title);
      });

      if (mainModal) {
        mainModal.setAttribute("inert", "");
        mainModal.style.pointerEvents = "none";
      }

      document.activeElement?.blur();
      moreModal.style.display = "flex";
      document.body.classList.add("modal-open");

      const scrollContainer = moreModal.querySelector('.misc-buttons-container');
      if (scrollContainer) {
        scrollContainer.scrollTop = 0;
      }

      const firstBtn = moreModal.querySelector('.sys-btn');
      if (firstBtn) setTimeout(() => firstBtn.focus({ preventScroll: true }), 100);
      else moreModal.focus();
    }

    function closeMiscMoreModal() {
      const mainModal = document.getElementById("miscModal");
      const moreModal = document.getElementById("miscMoreModal");
      if (!moreModal) return;

      moreModal.style.display = "none";
      document.body.classList.remove("modal-open");

      if (mainModal) {
        mainModal.removeAttribute("inert");
        mainModal.style.pointerEvents = "";
        document.body.classList.add("modal-open");
      }

      setTimeout(() => {
        if (lastFocusedElementMiscMore && document.body.contains(lastFocusedElementMiscMore)) {
          lastFocusedElementMiscMore.focus?.({ preventScroll: true });
        }
        lastFocusedElementMiscMore = null;
      }, 50);
    }

  </script>
<script>
// 1) –†–µ–∂–µ–º –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä –∫–ª–∞–≤–∏—à–∏ Enter/OK –ø–æ –≤—Å–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é (CAPTURE + immediate)
document.addEventListener('keydown', function(e) {
  const isEnter = (e.key === 'Enter' || e.code === 'Enter' || e.key === 'NumpadEnter' || e.key === 'OK');
  if (isEnter && e.repeat) {
    e.preventDefault();
    e.stopImmediatePropagation();
  }
}, true);

// 2) –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–µ–±–∞—É–Ω—Å ¬´–∫–ª–∏–∫–æ–≤ –æ—Ç —É–¥–µ—Ä–∂–∞–Ω–∏—è¬ª ‚Äî –ø–µ—Ä-—ç–ª–µ–º–µ–Ω—Ç–Ω—ã–π
const __lastClickByEl = new WeakMap();
document.addEventListener('click', function(e) {
  const target = e.target.closest('button, [role="button"], .component-btn, #installAllBtn');
  if (!target) return;
  const now = Date.now();
  const last = __lastClickByEl.get(target) || 0;
  const interval = 700; // –º–æ–∂–Ω–æ 500..900 –º—Å

  if (now - last < interval) {
    e.preventDefault();
    e.stopImmediatePropagation();
    return;
  }
  __lastClickByEl.set(target, now);
}, true);

// –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–∞–∫ –º–æ–¥–∞–ª–∫–∞ "–†–∞–∑–Ω–æ–µ")
function showInstallMethodSettings() {
    lastFocusedElement = document.activeElement;
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    const currentMethod = window.AndroidInterface?.getInstallMethod?.() || 'sai';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥ –≤ —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏
    const radioBtn = document.getElementById('method_' + currentMethod);
    if (radioBtn) {
        radioBtn.checked = true;
        document.querySelectorAll('#installMethodModal .method-option').forEach(option => option.classList.remove('selected'));
        radioBtn.closest('.method-option')?.classList.add('selected');
    }
    
    // freeze –†–∞–∑–Ω–æ–µ, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ
    const misc = document.getElementById('miscModal');
    if (misc && misc.style.display === 'flex') {
      misc.setAttribute('inert', '');
      misc.style.pointerEvents = 'none';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
    const modal = document.getElementById("installMethodModal");
    modal.style.display = "flex";
    document.body.classList.add("modal-open");
    document.activeElement?.blur();
    __installMethodIndex = 0;
    const firstOption = modal.querySelector('.method-option');
    if (firstOption) setTimeout(() => firstOption.focus({ preventScroll: true }), 80); else modal.focus();
}

// –ó–∞–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–∞–∫ –º–æ–¥–∞–ª–∫–∞ "–†–∞–∑–Ω–æ–µ")
function closeInstallMethodSettings() {
    const modal = document.getElementById("installMethodModal");
    modal.style.display = "none";
    document.body.classList.remove("modal-open");
    
    // unfreeze –†–∞–∑–Ω–æ–µ
    const misc = document.getElementById('miscModal');
    if (misc) { 
      misc.removeAttribute('inert'); 
      misc.style.pointerEvents = ''; 
    }
    
    setTimeout(() => { if (lastFocusedElement && document.body.contains(lastFocusedElement)) lastFocusedElement.focus?.(); lastFocusedElement = null; }, 50);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
document.addEventListener('DOMContentLoaded', function() {
    const radioButtons = document.querySelectorAll('input[name="install_method"]');
    
    radioButtons.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.checked) {
                selectInstallMethod(this.value, this.closest('.method-option'));
            }
        });
    });
});

// –ù–µ –ø–æ–∑–≤–æ–ª—è–µ–º —Ñ–æ–∫—É—Å—É –ø–æ–ø–∞–¥–∞—Ç—å –≤ radio, –¥–µ—Ä–∂–∏–º –µ–≥–æ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
let __installMethodIndex = 0;

(function ensureInstallMethodFocus() {
  const modal = document.getElementById('installMethodModal');
  if (!modal) return;
  const radios = modal.querySelectorAll('.method-option input[type="radio"]');
  const cards = Array.from(modal.querySelectorAll('.method-option'));

  // –Ω–∞–∑–Ω–∞—á–∞–µ–º tabindex –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –ø–æ—Ä—è–¥–æ–∫
  cards.forEach((card, idx) => {
    card.tabIndex = 0;
    card.dataset.methodIdx = String(idx);
  });

  radios.forEach(r => {
    r.setAttribute('tabindex', '-1');
    r.setAttribute('aria-hidden', 'true');
    r.disabled = true; // —É–±–∏—Ä–∞–µ–º —Ñ–æ–∫—É—Å/–Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤–Ω—É—Ç—Ä—å radio
    r.style.pointerEvents = 'none';
    r.addEventListener('focus', (e) => {
      e.preventDefault();
      const card = r.closest('.method-option');
      if (card) card.focus({ preventScroll: true });
    }, true);
  });

  modal.addEventListener('focusin', (e) => {
    const cardTarget = e.target?.closest?.('.method-option');
    if (cardTarget) {
      const idx = Number(cardTarget.dataset.methodIdx ?? cards.indexOf(cardTarget));
      if (Number.isFinite(idx)) __installMethodIndex = Math.max(0, Math.min(idx, cards.length - 1));
      return; // —É–∂–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º
    }

    const radio = e.target?.closest?.('input[type="radio"]');
    if (!radio) return;
    e.preventDefault();
    const radioCard = radio.closest('.method-option');
    if (radioCard) requestAnimationFrame(() => radioCard.focus({ preventScroll: true }));
  }, true);

  // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  modal.addEventListener('transitionend', () => {
    const first = cards[0];
    if (first && modal.style.display === 'flex') {
      first.focus({ preventScroll: true });
    }
  });
})();

// –ü—Ä–æ—Å—Ç–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º installMethodModal
document.addEventListener('keydown', (e) => {
  const modal = document.getElementById('installMethodModal');
  if (!modal || modal.style.display !== 'flex') return;
  const keys = ['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Enter','Back','Escape'];
  if (!keys.includes(e.key)) return;

  const cards = Array.from(modal.querySelectorAll('.method-option'));
  if (!cards.length) return;

  e.stopPropagation();
  e.stopImmediatePropagation();
  e.preventDefault();

  const activeCard = document.activeElement?.closest?.('.method-option');
  if (activeCard) {
    const idx = Number(activeCard.dataset.methodIdx ?? cards.indexOf(activeCard));
    if (Number.isFinite(idx)) __installMethodIndex = idx;
  }

  const clamp = (i) => Math.min(Math.max(i, 0), cards.length - 1);

  if (e.key === 'Enter') {
    const card = cards[clamp(__installMethodIndex)];
    card?.click();
    return;
  }
  if (e.key === 'Back' || e.key === 'Escape') {
    closeInstallMethodSettings();
    return;
  }

  const delta = (e.key === 'ArrowDown' || e.key === 'ArrowRight') ? 1 : -1;
  const next = clamp(__installMethodIndex + delta);
  __installMethodIndex = next;
  cards[next]?.focus({ preventScroll: true });
}, true);

function selectInstallMethod(method, targetElement = null) {
  if (__installMethodApplying) return;
  __installMethodApplying = true;
  try {
    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –æ–ø—Ü–∏–π
    document.querySelectorAll('#installMethodModal .method-option').forEach(option => {
      option.classList.remove('selected');
    });

    const radio = document.getElementById('method_' + method);
    const target = targetElement || radio?.closest('.method-option');

    if (target) {
      target.classList.add('selected');
    }

    if (radio && !radio.checked) {
      radio.checked = true;
    }

    if (window.AndroidInterface && window.AndroidInterface.setInstallMethod) {
      window.AndroidInterface.setInstallMethod(method);
    }
  } finally {
    setTimeout(() => { __installMethodApplying = false; }, 0);
  }
}

  
</script>

	<script>
  function openExternal(url) {
    try {
      if (window.AndroidInterface) {
        if (typeof AndroidInterface.openExternalLink === 'function') {
          AndroidInterface.openExternalLink(url);   // –≤–∞—à –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
          return;
        }
        if (typeof AndroidInterface.openLink === 'function') {
          AndroidInterface.openLink(url);
          return;
        }
        if (typeof AndroidInterface.openUrl === 'function') {
          AndroidInterface.openUrl(url);
          return;
        }
      }
    } catch (e) { console.log(e); }
    // –§–æ–ª–±—ç–∫: –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ WebView, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å shouldOverrideUrlLoading
    window.location.href = url;
  }
	 function openInternal(url) {
    try {
      if (window.AndroidInterface && typeof AndroidInterface.openInternalLink === 'function') {
        AndroidInterface.openInternalLink(url);
        return;
      }
    } catch(e){ console.log(e); }

    window.location.assign(url);
  }
</script>

<!-- ATV Apps state and functions -->
<script>
const atvAppsState = {
  apps: [],
  filter: 'all',
  source: 'local',
  sourceLabel: '–õ–æ–∫–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ',
  localIcons: {},
  localLabels: {},
  localVersions: {},
  defaultIcon: null,
  loading: false
};

let atvLastFocusedAppEl = null;

const atvDefaultIcons = {
  user: 'https://appassets.androidplatform.net/assets/webview/icons/list/user.png',
  system: 'https://appassets.androidplatform.net/assets/webview/icons/list/system.png'
};
const atvLoadingHtml = `
  <div class="atv-loading">
    <span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" alt=""></span>
    <div style="opacity:0.85;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞‚Ä¶</div>
  </div>
`;

function openAtvAppsModalFast(btn) {
  ignoreNextEnter = true;
  // –¢—Ä–µ–±—É–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ ADB-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
  if (!isAdbSessionConnected()) {
    showToast({ message: 'ADB –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω', type: 'warning', position: 'top-center' });
    ignoreNextEnter = false;
    return;
  }
  showToast({ message: '–û—Ç–∫—Ä—ã–≤–∞—é —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π', type: 'warning', position: 'bottom-center', duration: 2000 });

  const modal = document.getElementById('atvAppsModal');
  if (!modal) return;
  document.activeElement?.blur();
  modal.style.display = 'flex';
  document.body.classList.add('modal-open');
  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∏–∫–æ–Ω–∫—É –∏–∑ –∫–Ω–æ–ø–∫–∏-—Ç—Ä–∏–≥–≥–µ—Ä–∞
  const header = document.getElementById('atvAppsHeader');
  const iconSrc = btn?.querySelector('img')?.src || 'https://appassets.androidplatform.net/assets/webview/icons/main/ic20_ATV.png';
  const titleText = (btn?.innerText || '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è Android TV').trim();
  if (header) {
    header.innerHTML = `<img src="${iconSrc}" alt="" style="height:22px; vertical-align:middle; margin-right:6px;">${titleText}`;
  }
  setAtvAppsFilter('all', false);
  refreshAtvAppsList('remote');
  
  setTimeout(() => {
    const firstFilter = modal.querySelector('.app-filters .sys-btn');
    if (firstFilter) {
      firstFilter.focus({ preventScroll: true });
    } else {
      modal.focus();
    }
  }, 120);
}

function closeAtvAppsModal() {
  const modal = document.getElementById('atvAppsModal');
  if (!modal) return;
  modal.style.display = 'none';
  modal.style.zIndex = '';
  closeAtvAppActions();
  if (!anyModalOpen()) {
    document.body.classList.remove('modal-open');
  }
  setTimeout(() => {
    ignoreNextEnter = false;
  }, 100);
}

function setAtvAppsFilter(filter, rerender = true) {
  atvAppsState.filter = filter;
  document.querySelectorAll('#atvAppsFilters .sys-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.filter === filter);
  });
  if (rerender) renderAtvAppsList();
}

function refreshAtvAppsList(source = 'auto') {
  setAtvLoading(true);
  // –î–∞–µ–º –±—Ä–∞—É–∑–µ—Ä—É –≤—Ä–µ–º—è –ø—Ä–æ—Ä–∏—Å–æ–≤–∞—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä, –∑–∞—Ç–µ–º –¥–µ—Ä–≥–∞–µ–º —Ç—è–∂—ë–ª—ã–π –≤—ã–∑–æ–≤
  renderAtvAppsList();
  setTimeout(() => {
    try {
      const raw = window.AndroidInterface?.getAppsInventory?.(source) || '';
      handleAtvAppsPayload(raw);
    } catch (e) {
      handleAtvAppsPayload('{}');
      console.warn('getAppsInventory error', e);
      showToast?.({ message: '‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞', type: 'error' });
    }
  }, 30);
}

function handleAtvAppsPayload(raw) {
  let data = null;
  try { data = JSON.parse(raw); } catch (_) {}
  if (!data || !Array.isArray(data.apps)) {
    showToast({ message: '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π', type: 'error' });
    renderAtvAppsList([]);
    setAtvLoading(false);
    return;
  }
  atvAppsState.apps = data.apps || [];
  atvAppsState.source = data.source || 'local';
  atvAppsState.sourceLabel = data.sourceLabel || (atvAppsState.source === 'adb' ? 'ADB —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ' : '–õ–æ–∫–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ');
  atvAppsState.localIcons = data.localIcons || {};
  atvAppsState.localLabels = data.localLabels || {};
  atvAppsState.localVersions = data.localVersions || {};
  atvAppsState.defaultIcon = data.defaultIcon || null;
  if (data.error) {
    showToast({ message: `–û—à–∏–±–∫–∞: ${data.error}`, type: 'warning' });
  }
  setAtvAdbIndicator(data?.adbConnected, atvAppsState.sourceLabel);
  setAtvLoading(false);
  renderAtvAppsList();
}

function setAtvLoading(flag) {
  atvAppsState.loading = !!flag;
  const modal = document.getElementById('atvAppsModal');
  if (modal) modal.classList.toggle('atv-loading-active', !!flag);
  const refreshBtn = document.getElementById('modal-action-atv-refresh');
  if (refreshBtn) refreshBtn.disabled = !!flag;
}

function setAtvAdbIndicator(connected, label) {
  const btn = document.getElementById('atvAdbIndicator');
  if (!btn) return;
  btn.classList.toggle('connected', !!connected);
  btn.classList.toggle('disconnected', !connected);
  const img = btn.querySelector('img');
  if (img) {
    img.src = connected
      ? 'https://appassets.androidplatform.net/assets/webview/icons/network/ic_ADB_on.png'
      : 'https://appassets.androidplatform.net/assets/webview/icons/network/ic_ADB_off.png';
    img.alt = connected ? 'ADB –ø–æ–¥–∫–ª—é—á–µ–Ω' : 'ADB –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω';
  }
  btn.title = label || (connected ? 'ADB –ø–æ–¥–∫–ª—é—á–µ–Ω' : 'ADB –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
}

function getFilteredAtvApps() {
  const f = atvAppsState.filter;
  if (f === 'all') return atvAppsState.apps;
  if (f === 'user') return atvAppsState.apps.filter(a => a.type === 'user');
  if (f === 'system') return atvAppsState.apps.filter(a => a.type === 'system');
  if (f === 'system_launchable') return atvAppsState.apps.filter(a => a.type === 'system' && a.launchable === true);
  if (f === 'disabled') return atvAppsState.apps.filter(a => a.state === 'disabled');
  if (f === 'deleted') return atvAppsState.apps.filter(a => a.state === 'deleted');
  return atvAppsState.apps;
}

function renderAtvAppsList() {
  const list = document.getElementById('atvAppsList');
  if (!list) return;
  list.innerHTML = '';
  if (atvAppsState.loading) {
    list.innerHTML = atvLoadingHtml;
    return;
  }
  const apps = getFilteredAtvApps();
  if (!apps.length) {
    list.innerHTML = '<div style="text-align:center; opacity:0.7;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>';
    return;
  }

  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É (–ø–æ label –∏–ª–∏ package)
  const sortedApps = [...apps].sort((a, b) => {
    const nameA = (a.label || atvAppsState.localLabels?.[a.package] || a.package).toLowerCase();
    const nameB = (b.label || atvAppsState.localLabels?.[b.package] || b.package).toLowerCase();
    return nameA.localeCompare(nameB, 'ru');
  });

  sortedApps.forEach(app => {
    const row = document.createElement('div');
    row.className = 'app-row';
    row.tabIndex = 0;
    row.onclick = () => openAtvAppActions(app);
    row.onkeydown = (e) => { if (e.key === 'Enter') { e.preventDefault(); openAtvAppActions(app); } };
    row.onfocus = () => { atvLastFocusedAppEl = row; };

    const img = document.createElement('img');
    img.className = 'app-icon';
    img.loading = 'lazy';
    const fallbackIcon = atvAppsState.defaultIcon || atvDefaultIcons[app.type === 'system' ? 'system' : 'user'];
    const localIcon = atvAppsState.localIcons?.[app.package];
    img.src = app.icon || localIcon || fallbackIcon;
    img.alt = app.label || app.package;

    const meta = document.createElement('div');
    meta.className = 'app-meta';

    const title = document.createElement('div');
    title.className = 'app-title';
    const localLabel = atvAppsState.localLabels?.[app.package];
    title.textContent = app.label || localLabel || app.package;

    const sub = document.createElement('div');
    sub.className = 'app-sub';

    const left = document.createElement('div');
    left.style.display = 'flex';
    left.style.flexDirection = 'column';
    left.style.gap = '2px';
    left.style.maxWidth = '70%';

    const pkg = document.createElement('span');
    pkg.textContent = app.package;
    pkg.style.whiteSpace = 'normal';
    pkg.style.wordBreak = 'break-all';

    const versionText = app.version || atvAppsState.localVersions?.[app.package];
    const version = document.createElement('span');
    version.textContent = versionText ? `v${versionText}` : '';
    version.style.opacity = '0.85';
    const state = document.createElement('span');
    state.className = 'app-state';
    const isDisabled = app.state === 'disabled';
    const isDeleted = app.state === 'deleted';
    if (isDisabled || isDeleted) {
      state.textContent = isDeleted ? '—É–¥–∞–ª–µ–Ω–æ' : '–æ—Ç–∫–ª—é—á–µ–Ω–æ';
      state.style.display = 'inline-flex';
      state.style.alignItems = 'center';
      state.style.gap = '4px';
      state.style.padding = '2px 8px';
      state.style.borderRadius = '10px';
      state.style.fontWeight = '700';
      state.style.textTransform = 'uppercase';
      state.style.fontSize = '11px';
      state.style.background = isDeleted ? 'red' : '#e66909';
      state.style.color = '#000';
    } else {
      state.textContent = '';
    }

    const bottomLine = document.createElement('div');
    bottomLine.style.display = 'flex';
    bottomLine.style.alignItems = 'center';
    bottomLine.style.gap = '6px';
    if (version.textContent) bottomLine.appendChild(version);
    if (state.textContent) bottomLine.appendChild(state);

    left.appendChild(pkg);
    if (bottomLine.children.length) left.appendChild(bottomLine);

    const badge = document.createElement('span');
    badge.className = 'app-badge';
    badge.classList.add(app.type === 'system' ? 'badge-system' : 'badge-user');
    badge.textContent = app.type === 'system' ? 'system' : 'user';

    sub.appendChild(left);
    sub.appendChild(badge);

    meta.appendChild(title);
    meta.appendChild(sub);

    row.appendChild(img);
    row.appendChild(meta);
    list.appendChild(row);
  });
}

function dumpLocalApps() {
  try {
    const msg = window.AndroidInterface?.dumpLocalAppsToDownloads?.() || '';
    showToast({ message: msg || '–ì–æ—Ç–æ–≤–æ', type: 'info', position: 'top-center' });
  } catch (e) {
    console.warn('dumpLocalApps error', e);
    showToast({ message: '–û—à–∏–±–∫–∞ –¥–∞–º–ø–∞', type: 'error', position: 'top-center' });
  }
}

let atvSelectedApp = null;
function openAtvAppActions(app) {
  atvSelectedApp = app;
  // –∑–∞–ø–æ–º–∏–Ω–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–æ–∫—É —Å–ø–∏—Å–∫–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ–∫—É—Å–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
  if (!atvLastFocusedAppEl) {
    const activeRow = document.activeElement?.closest?.('.app-row');
    if (activeRow) atvLastFocusedAppEl = activeRow;
  }
  const modal = document.getElementById('atvAppActionsModal');
  if (!modal) return;
  const parentModal = document.getElementById('atvAppsModal');
  if (parentModal && parentModal.style.display === 'flex') {
    modal.dataset.restoreParent = '1';
    parentModal.setAttribute('inert', '');
    parentModal.style.pointerEvents = 'none';
  } else {
    modal.dataset.restoreParent = '0';
  }
  const title = document.getElementById('atvAppActionsTitle');
  if (title) {
    const iconSrc = app.icon
      || atvAppsState.localIcons?.[app.package]
      || atvAppsState.defaultIcon
      || atvDefaultIcons[app.type === 'system' ? 'system' : 'user'];
    const label = app.label || app.package;
    title.style.display = 'inline-flex';
    title.style.alignItems = 'center';
    title.style.justifyContent = 'center';
    title.style.gap = '8px';
    title.style.width = '100%';
    title.style.textAlign = 'center';
    title.innerHTML = iconSrc
      ? `<img src="${iconSrc}" alt="" style="height:22px;width:22px;object-fit:contain;"> <span>${label}</span>`
      : label;
  }
  const info = document.getElementById('atvAppActionsInfo');
  if (info) {
    const typeBadge = `
      <span style="display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:12px;
        background:${app.type === 'system' ? '#d0a447' : '#2abf6d'}; color:#000; font-weight:700; text-transform:uppercase; font-size:12px;">
        ${app.type === 'system' ? 'system' : 'user'}
      </span>`;
    const stateBadge = (app.state === 'disabled' || app.state === 'deleted') ? `
      <span style="display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:12px;
        background:${app.state === 'deleted' ? 'red' : '#e66909'}; color:#000; font-weight:700; text-transform:uppercase; font-size:12px;">
        ${app.state === 'deleted' ? '—É–¥–∞–ª–µ–Ω–æ' : '–æ—Ç–∫–ª—é—á–µ–Ω–æ'}
      </span>` : '';
    info.innerHTML = `
      <div style="display:flex;flex-direction:column;align-items:center;gap:4px;flex-wrap:wrap;justify-content:center;color:#fff; margin-top:-4px;">
        <span style="color:#fff; font-size:11px; opacity:0.9; text-align:center;">${app.package}</span>
        <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;justify-content:center;">
          ${typeBadge}
          ${stateBadge}
        </div>
      </div>
    `;
  }

  const buttons = document.getElementById('atvAppActionsButtons');
  if (buttons) {
    buttons.innerHTML = '';
    
    // –î–ª—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ "–í–∫–ª—é—á–∏—Ç—å" (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)
    if (app.state === 'deleted') {
      buttons.appendChild(makeAtvActionBtn('enable', '–í–∫–ª—é—á–∏—Ç—å'));
    } 
    // –î–ª—è –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã—Ö: "–í–∫–ª—é—á–∏—Ç—å" + "–û—Ç–∫—Ä—ã—Ç—å"
    else if (app.state === 'disabled') {
      buttons.appendChild(makeAtvActionBtn('enable', '–í–∫–ª—é—á–∏—Ç—å'));
      buttons.appendChild(makeAtvActionBtn('open', '–û—Ç–∫—Ä—ã—Ç—å'));
    } 
    // –î–ª—è –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö: "–û—Ç–∫–ª—é—á–∏—Ç—å" + "–û—Ç–∫—Ä—ã—Ç—å"
    else {
      buttons.appendChild(makeAtvActionBtn('disable', '–û—Ç–∫–ª—é—á–∏—Ç—å'));
      buttons.appendChild(makeAtvActionBtn('open', '–û—Ç–∫—Ä—ã—Ç—å'));
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è user –≤—Å–µ–≥–¥–∞, –¥–ª—è system —Ç–æ–ª—å–∫–æ –ø–æ ADB, –∏ –Ω–µ –¥–ª—è deleted
    const allowDelete = (app.type === 'user') || (atvAppsState.source === 'adb');
    if (allowDelete && app.state !== 'deleted') {
      buttons.appendChild(makeAtvActionBtn('delete', '–£–¥–∞–ª–∏—Ç—å'));
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ APK –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ-deleted
    if (app.state !== 'deleted') {
      buttons.appendChild(makeAtvActionBtn('save', '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å (APK)'));
    }
    // –ò–Ω—Ñ–æ –ø–æ –ø–∞–∫–µ—Ç—É ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ-deleted
    if (app.state !== 'deleted') {
      buttons.appendChild(makeAtvActionBtn('info', '–ò–Ω—Ñ–æ'));
    }
  }

  modal.style.display = 'flex';
  document.body.classList.add('modal-open');
}

function closeAtvAppActions() {
  const modal = document.getElementById('atvAppActionsModal');
  if (!modal) return;
  modal.style.display = 'none';
  modal.style.zIndex = '';
  
  // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞—è –º–æ–¥–∞–ª–∫–∞ ATV Apps, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –Ω–µ—ë modal-open
  const parentModal = document.getElementById('atvAppsModal');
  if (parentModal && parentModal.style.display === 'flex') {
    if (modal.dataset.restoreParent === '1') {
      parentModal.removeAttribute('inert');
      parentModal.style.pointerEvents = '';
      modal.dataset.restoreParent = '0';
    }
    document.body.classList.add('modal-open');

    // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å–ø–∏—Å–∫–∞
    if (atvLastFocusedAppEl && document.body.contains(atvLastFocusedAppEl)) {
      const container = document.getElementById('atvAppsContainer');
      if (container) {
        const cr = container.getBoundingClientRect();
        const er = atvLastFocusedAppEl.getBoundingClientRect();
        if (er.top < cr.top + 12) container.scrollTop -= (cr.top + 12 - er.top);
        else if (er.bottom > cr.bottom - 12) container.scrollTop += (er.bottom - (cr.bottom - 12));
      }
      requestAnimationFrame(() => atvLastFocusedAppEl?.focus({ preventScroll: true }));
    }
  } else {
    document.body.classList.remove('modal-open');
  }
}

function makeAtvActionBtn(action, label) {
  const btn = document.createElement('button');
  btn.className = 'sys-btn';
  btn.textContent = label;
  btn.onclick = (e) => { e.stopPropagation(); handleAtvAppAction(action); };
  return btn;
}

function handleAtvAppAction(action) {
  if (!atvSelectedApp) return;
  if (action === 'info') {
    try {
      window.AndroidInterface?.openSettingsForPackage?.(atvSelectedApp.package);
    } catch (_) {}
    closeAtvAppActions();
    return;
  }
  if (action === 'disable' || action === 'enable' || action === 'delete') {
    const name = atvSelectedApp.label || atvSelectedApp.package;
    try {
      window.AndroidInterface?.confirmAndPerformAppAction?.(
        action,
        atvSelectedApp.package,
        name,
        atvAppsState.source
      );
    } catch (_) {
      // fallback: –Ω–∏—á–µ–≥–æ
    }
    return;
  }
  // –î–ª—è –ø—Ä–æ—á–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π ‚Äî —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  try {
    const raw = window.AndroidInterface?.performAppAction?.(action, atvSelectedApp.package, atvAppsState.source) || '{"success":false}';
    let data = null;
    try { data = JSON.parse(raw); } catch (_) {}
    const ok = data?.success;
    const msg = data?.message || (ok ? '–ì–æ—Ç–æ–≤–æ' : '–û—à–∏–±–∫–∞');
    if (ok) {
      showToast?.({ message: `‚úÖ ${msg}`, type: 'success' });
    } else {
      showToast?.({ message: `‚ùå ${msg}`, type: 'error' });
    }
  } catch (e) {
    showToast?.({ message: '‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è', type: 'error' });
  } finally {
    closeAtvAppActions();
    if (atvSelectedApp) {
      const targetState =
        action === 'enable' ? 'enabled' :
        action === 'disable' ? 'disabled' :
        action === 'delete' ? 'deleted' :
        atvSelectedApp.state;

      const apps = atvAppsState.apps || [];
      const idx = apps.findIndex(a => a.package === atvSelectedApp.package);
      if (idx !== -1) {
        apps[idx] = { ...apps[idx], state: targetState };
        atvAppsState.apps = apps;
        renderAtvAppsList();
      }
    }
  }
}

// –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ native –¥–∏–∞–ª–æ–≥–µ)
window.applyAtvActionState = function(action, pkg) {
  const apps = atvAppsState.apps || [];
  const idx = apps.findIndex(a => a.package === pkg);
  if (idx === -1) return;
  const targetState =
    action === 'enable' ? 'enabled' :
    action === 'disable' ? 'disabled' :
    action === 'delete' ? 'deleted' :
    apps[idx].state;
  apps[idx] = { ...apps[idx], state: targetState };
  atvAppsState.apps = apps;
  renderAtvAppsList();
};

// Back/Escape –∑–∞–∫—Ä—ã–≤–∞—é—Ç –º–æ–¥–∞–ª–∫–∏
document.addEventListener('keydown', function(e) {
  if (e.key === 'Back' || e.key === 'Escape') {
    const actions = document.getElementById('atvAppActionsModal');
    const main = document.getElementById('atvAppsModal');
    if (actions && actions.style.display === 'flex') {
      e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
      closeAtvAppActions(); return;
    }
    if (main && main.style.display === 'flex') {
      e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
      closeAtvAppsModal(); return;
    }
  }
}, true);

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ native back —á–µ—Ä–µ–∑ AndroidInterface, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
window.AndroidInterface?.registerOnBackPressed?.("atvAppsBackHandler");
window.atvAppsBackHandler = function() {
  const actions = document.getElementById('atvAppActionsModal');
  const main = document.getElementById('atvAppsModal');
  if (actions && actions.style.display === 'flex') {
    closeAtvAppActions();
    return true;
  }
  if (main && main.style.display === 'flex') {
    closeAtvAppsModal();
    return true;
  }
  return false;
};
</script>

<!-- –ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ -->
<div id="installMethodModal" class="modal" style="display:none;" tabindex="-1">
  <div class="modal-content">
    <h3>–°–ø–æ—Å–æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–∏:</h3>
    <div class="install-method-settings">
      <div class="method-option" onclick="selectInstallMethod('sai', this)" tabindex="0">
        <input type="radio" id="method_sai" name="install_method" value="sai" checked tabindex="-1">
        <label for="method_sai">
          <strong>–ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞</strong><br>
          <small>FAST-–º–µ—Ç–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</small>
        </label>
      </div>
      <div class="method-option" onclick="selectInstallMethod('standard', this)" tabindex="0">
        <input type="radio" id="method_standard" name="install_method" value="standard" tabindex="-1">
        <label for="method_standard">
          <strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞</strong><br>
          <small>–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –ø–∞–∫–µ—Ç–æ–≤</small>
        </label>
      </div>
      <div class="method-option" onclick="selectInstallMethod('adb', this)" tabindex="0">
        <input type="radio" id="method_adb" name="install_method" value="adb" tabindex="-1">
        <label for="method_adb">
          <strong>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ ADB</strong><br>
          <small>–¢—Ä–µ–±—É–µ—Ç—Å—è –≤ –º–µ–Ω—é –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤–∫–ª—é—á–∏—Ç—å ¬´–û—Ç–ª–∞–¥–∫—É –ø–æ USB</small>
        </label>
      </div>
    </div>
  </div>
</div>
  
  
</body>
</html>
