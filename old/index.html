

<!DOCTYPE html>
<html lang="ru" class="splash-open" style="overflow:hidden;">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
  <title>FastInstaller_cloud</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; background-color: #000; color: #fff; }
    select, input, button { font-size: 18px; padding: 10px; margin: 10px; width: 250px; }
    #status { margin-top: 20px; font-weight: bold; min-height: 24px; transition: opacity .5s ease; opacity: 0; position: fixed; top: 10px; left: 0; right: 0; text-align: center; z-index: 1001; }
    #status.visible { opacity: 1; }
    .spin { display: inline-block; animation: spin 1s linear infinite; }
    @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
    #adbScanStatus {
      transition: color .2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    #adbScanStatus .adb-scan-spinner {
      height: 18px;
      width: 18px;
      vertical-align: middle;
      filter: drop-shadow(0 0 2px rgba(0,0,0,0.35));
    }
    #adbScanStatus .adb-scan-spinwrap {
      display: inline-flex;
      align-items: center;
    }
    #adbScanStatus.adb-scan-complete {
      color: #4caf50;
    }

    
    .card-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 20px; }
    .card {
      background-color: #2a2a2a; border-radius: 16px; padding: 20px;
      width: 80px; height: 62px; display: flex; flex-direction: column; align-items: center; justify-content: center;
      color: #fff; font-size: 13px; border: 2px solid transparent; transition: all .2s ease; cursor: pointer;
    }
    .card:hover, .card:focus { background-color: #004d61; border-color: #00cfff; box-shadow: 0 0 10px rgba(0,0,0,.5); outline: none; }
    .card.selected { background-color: #00cfff; color: #000; border: 2px solid #fff; }

    .modal { 
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,.7); 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      z-index: 999; 
      outline: none;
      overscroll-behavior: contain;
      touch-action: none; /* –ë–ª–æ–∫–∏—Ä—É–µ–º touch —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Ñ–æ–Ω–µ –º–æ–¥–∞–ª–∫–∏ */
    }

    .adb-status-indicator {
      font-size: 14px;
      text-align: center;
      margin-top: -4px;
      margin-bottom: 12px;
      color: rgba(255,255,255,0.75);
      transition: color .2s ease;
    }
    .adb-status-indicator.connected {
      color: #0ff;
      font-weight: 600;
    }
    .modal-content {
      background: #111; color: #fff; padding: 20px; border-radius: 10px;
      max-height: 80vh; overflow: hidden; width: 80%; border: 1px solid #333;
      touch-action: auto; /* –†–∞–∑—Ä–µ—à–∞–µ–º touch —Å–æ–±—ã—Ç–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
      overscroll-behavior: contain;
    }

    /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ "–†–∞–∑–Ω–æ–µ" */
    #miscModal .modal-content {
      display: flex;
      flex-direction: column;
      max-height: 80vh;
    }

    #miscModal .misc-buttons-container {
      max-height: 60vh;
      overflow-y: auto;
      overscroll-behavior: contain;
      scroll-behavior: auto;
      scrollbar-gutter: stable both-edges;
      margin-bottom: 20px;
    }

    body.modal-open { 
      overflow: hidden; 
      position: fixed; 
      width: 100%; 
      height: 100%; 
      overscroll-behavior: none; 
    }
    body.splash-open { overflow: hidden; height: 100vh; }
    html.splash-open { overflow: hidden; height: 100vh; }
    body.splash-open > :not(#splash) { display: none !important; }
    html, body { overscroll-behavior: none; }
    html.splash-open::-webkit-scrollbar, body.splash-open::-webkit-scrollbar { width: 0; height: 0; }

    /* –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ –≥—Ä—É–ø–ø */
    #modalListContainer { max-height: 60vh; overflow-y: auto; overscroll-behavior: contain; scroll-behavior: auto; scrollbar-gutter: stable both-edges; }
    #modalList { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; justify-items: center; }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ - 1 –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –ª—É—á—à–µ–π —ç—Å—Ç–µ—Ç–∏–∫–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö */
    @media (orientation: portrait) {
      #modalList { 
        grid-template-columns: 1fr; 
        gap: 12px; 
        max-width: 320px; 
        margin: 0 auto; 
      }
      
      #modalList .component-btn {
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
      }
      
      #installAllBtn {
        width: 100%;
        max-width: 300px;
        margin: 12px auto 0;
      }
    }
    #modalList .component-btn { transition: none !important; }
    #modalList .component-btn:focus,
    #installAllBtn:focus,
    #installAllBtn.selected { background-color: #00cfff; box-shadow: 0 0 0 1px rgba(255, 255, 255, 0) !important; border-color: #fff !important; outline: none; }
    /* –ü–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –æ–±—Ä–µ–∑–∫–∞ –¥–æ 2 —Å—Ç—Ä–æ–∫ */
#modalList .component-btn {
  white-space: normal;
  overflow-wrap: anywhere;   /* –¥–ª—è —Å–ø–ª–æ—à–Ω—ã—Ö —Å—Ç—Ä–æ–∫ */
  word-break: break-word;    /* fallback */
  line-height: 1.25;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;     /* –º–∞–∫—Å–∏–º—É–º 2 —Å—Ç—Ä–æ–∫–∏ */
  line-clamp: 2;             /* —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ */
  overflow: hidden;
  text-overflow: ellipsis;
  min-height: 48px;          /* —á—Ç–æ–±—ã –≤—ã—Å–æ—Ç–∞ –Ω–µ "–ø—Ä—ã–≥–∞–ª–∞" */
  max-height: 48px; 
}
    /* –ö–Ω–æ–ø–∫–∏ –≤ —Å—Ç–∏–ª–µ Google TV */
    button {
      background-color: #004d61; color: #fff; border: 2px solid transparent; border-radius: 8px;
      padding: 10px 20px; font-size: 14px; width: 250px; cursor: pointer;
      transition: background-color .2s ease, box-shadow .2s ease, border-color .2s ease; box-sizing: border-box;
    }
    button:hover { background-color: #00cfff; }
    button:focus { outline: none; border-color: #fff; box-shadow: 0 0 10px #004d61; }

    .system-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 12px; }
    .sys-btn {
      flex: 1 1 calc(33.33% - 20px); min-width: 100px; max-width: 240px; padding: 10px; font-size: 13px; text-align: center;
      background-color: #004d61; color: #fff; border: 2px solid transparent; border-radius: 10px; cursor: pointer; transition: background-color .3s ease;
    }
    .sys-btn:hover { background-color: #00cfff; }
    .sys-btn:focus {
      border-color: #fff;
      box-shadow: 0 0 10px #004d61;
    }
    #mainSystemButtons .sys-btn:focus {
      background-color: #00cfff;
      color: #000;
      border-color: #fff;
      box-shadow: 0 0 10px #004d61;
    }
    /* –í –º–æ–¥–∞–ª–∫–µ "–†–∞–∑–Ω–æ–µ" –æ—Ç–∫–ª—é—á–∞–µ–º hover, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –ø–æ–¥—Å–≤–µ—Ç–∫–µ –ø–æ —Ñ–æ–∫—É—Å—É */
    #miscModal .sys-btn { background-color: #004d61; color:#fff; }
    #miscModal .sys-btn:hover { background-color: #004d61; }
    #miscModal .sys-btn:focus {
      background-color: #00cfff; color:#000;
       border: 2px solid #fff;
    }
    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –≤ –º–æ–¥–∞–ª–∫–µ "–†–∞–∑–Ω–æ–µ" */
    #miscModal .sys-btn.selected { background-color: #00cfff; color: #000; border: 2px solid #fff; }
    
    /* –í –º–æ–¥–∞–ª–∫–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏" –æ—Ç–∫–ª—é—á–∞–µ–º hover, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –ø–æ–¥—Å–≤–µ—Ç–∫–µ –ø–æ —Ñ–æ–∫—É—Å—É */
    #miscMoreModal .sys-btn { background-color: #004d61; color:#fff; }
    #miscMoreModal .sys-btn:hover { background-color: #004d61; }
    #miscMoreModal .sys-btn:focus {
      background-color: #00cfff; color:#000;
      border: 2px solid #fff;
    }
    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –≤ –º–æ–¥–∞–ª–∫–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏" */
    #miscMoreModal .sys-btn.selected { background-color: #00cfff; color: #000; border: 2px solid #fff; }
    
    /* === –°–ö–ê–ù–ï–† ADB === */
    #adbScanListContainer { max-height: 60vh; overflow-y: auto; overscroll-behavior: contain; scroll-behavior: auto; scrollbar-gutter: stable both-edges; }
    #adbScanList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      justify-items: center;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ADB */
    .adb-device-card {
      background-color: #2a2a2a;
      border-radius: 12px;
      padding: 12px 14px;
      width: 100%;
      max-width: 240px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      color: #fff;
      border: 2px solid transparent;
      transition: all .2s ease;
      cursor: pointer;
      min-height: unset;
    }
    
    .adb-device-card:hover, .adb-device-card:focus {
      background-color: #004d61;
      border-color: #00cfff;
      box-shadow: 0 0 10px rgba(0,0,0,.5);
      outline: none;
    }
    
    .adb-device-card.selected {
      background-color: #00cfff;
      color: #000;
      border: 2px solid #fff;
    }
    
    .adb-device-name {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 2px;
      color: #fff;
    }

    .adb-device-name--placeholder {
      opacity: .65;
      font-style: italic;
    }
    
    .adb-device-ip {
      font-size: 14px;
      font-weight: 600;
      margin: 0;
      opacity: .9;
    }
    
    /* –û—Ç–∫–ª—é—á–∞–µ–º hover –≤ —Å–∫–∞–Ω–µ—Ä–µ ADB, —á—Ç–æ–±—ã –º—ã—à—å –Ω–µ –º–µ—à–∞–ª–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
    #adbScannerModal .adb-device-card:hover { background-color: #2a2a2a; border-color: transparent; box-shadow: none; }
    #adbScannerModal .adb-device-card.selected:hover { background-color: #00cfff; color: #000; border: 2px solid #fff; }
    
    /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–∞–Ω–µ—Ä–æ–º */
    #adbScannerModal .sys-btn { background-color: #004d61; color: #fff; }
    #adbScannerModal .sys-btn:hover { background-color: #004d61; }
    #adbScannerModal .sys-btn:focus {
      background-color: #00cfff;
      color: #000;
      border: 2px solid #fff;
    }
    #adbScannerModal .sys-btn.selected { background-color: #00cfff; color: #000; border: 2px solid #fff; }
    

    #splash { position: fixed; inset: 0; background-color: #000; display: flex; justify-content: center; align-items: center; z-index: 9999; }
     #logo { position: fixed; inset: 0; z-index: 9999; background-repeat: no-repeat; background-position: center; background-size: cover; }

    /* –¢–æ—Å—Ç—ã */
    .toast {
      display: inline-flex; align-items: center; gap: 8px; box-sizing: border-box; background: rgba(0,0,0,.85); color: #fff;
      border-radius: 10px; padding: 12px 18px; font-size: 14px; line-height: 1.3; max-width: min(70vw,720px);
      white-space: normal; overflow-wrap: anywhere; word-break: break-word; opacity: 0; transform: translateY(8px);
      transition: opacity .25s ease, transform .25s ease; pointer-events: auto;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast--pill { border-radius: 999px; padding: 10px 16px; }
    .toast--compact { padding: 8px 12px; font-size: 16px; }
    .toast--card { box-shadow: 0 8px 24px rgba(0,0,0,.35); }
    .toast .spin { display:inline-block; animation: spin 1s linear infinite; }
    .toast-stack { position: fixed; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
    .toast-stack--top{ top: 40px; } .toast-stack--bottom{ bottom: 40px; } .toast-stack--center{ top: 50%; transform: translateY(-50%); }
    .toast-stack--left{ left: 40px; align-items: flex-start; } .toast-stack--centerX{ left: 50%; transform: translateX(-50%); align-items: center; }
    .toast-stack--right{ right: 40px; align-items: flex-end; }
    .toast--anchored { position: fixed; z-index: 10000; }

    /* === –ê–í–¢–û–ó–ê–ü–£–°–ö === */
    #autostartListContainer { max-height: 60vh; overflow-y: auto; overscroll-behavior: contain; scroll-behavior: auto; scrollbar-gutter: stable both-edges; }
    #autostartList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ —à–∏—Ä–∏–Ω–µ –º–æ–¥–∞–ª–∫–∏ */
      gap: 10px;
      justify-items: center;
    }
    #autostartList .card { transition: none !important; }
    #autostartList .card:focus { box-shadow: 0 0 0 3px rgba(255,255,255,.6) !important; border-color: #fff !important; outline: none; }
    /* –û—Ç–∫–ª—é—á–∞–µ–º hover –≤ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–µ, —á—Ç–æ–±—ã –º—ã—à—å –Ω–µ –¥–∞–≤–∞–ª–∞ "–ª–æ–∂–Ω—É—é" –ø–æ–¥—Å–≤–µ—Ç–∫—É */
    #autostartList .card:hover { background-color: #2a2a2a; border-color: transparent; box-shadow: none; }
    #autostartList .card.selected:hover { background-color: #00cfff; color:#000; border: 2px solid #fff; }

    /* –°–¥–µ–ª–∞–µ–º ¬´–ó–∞–∫—Ä—ã—Ç—å¬ª –≤–∏–¥–∏–º–æ–π –∫–∞–∫ "–Ω–∏–∑ —Å–ø–∏—Å–∫–∞" */
    #autostartCloseBtn { margin: 12px auto 0; width: 100%; max-width: 320px; }


     /* –ö—Ä–∞—Å–∏–º –∏–º—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è*/
  .app-name {
    color: #00cfff;       /* –æ—Ç—Ç–µ–Ω–æ–∫ –±–∏—Ä—é–∑–æ–≤–æ–≥–æ, –∫–∞–∫ —É –∫–Ω–æ–ø–æ–∫ */
    font-weight: 700;
  }

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–∞–∫ –º–æ–¥–∞–ª–∫–∞ "–†–∞–∑–Ω–æ–µ") */
#installMethodModal {
  z-index: 1000 !important; /* –í—ã—à–µ —á–µ–º —É –º–æ–¥–∞–ª–∫–∏ "–†–∞–∑–Ω–æ–µ" (999) */
}

#installMethodModal .modal-content {
  display: flex;
  flex-direction: column;
  max-height: 80vh;
}

#installMethodModal .sys-btn {
  width: 100%;
  max-width: 320px;
  margin: 0 auto;
}

#miscMoreModal .modal-content {
  display: flex;
  flex-direction: column;
  max-height: 80vh;
}

#miscMoreModal .misc-buttons-container {
  max-height: 60vh;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: auto;
  scrollbar-gutter: stable both-edges;
  margin-bottom: 20px;
}

#installMethodModal .method-option {
  margin: 10px 0;
  padding: 10px;
  border: 2px solid #333;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: flex-start;
  gap: 0px;
  position: relative;
}
/* –£–ø–ª–æ—Ç–Ω—è–µ–º –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ä–∞–¥–∏–æ-–æ–ø—Ü–∏–∏ */
#installMethodModal .install-method-settings{
  max-width: 560px;         /* —Å–ø–∏—Å–æ–∫ —É–∂–µ, –Ω–µ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —ç–∫—Ä–∞–Ω–∞ */
  margin: 0 auto;
}

/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–æ–¥–∞–ª–∫–∏ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
@media (orientation: portrait) {
  #installMethodModal .modal-content {
    max-height: 90vh;
    width: 95%;
    padding: 15px;
  }
  
  #installMethodModal .install-method-settings {
    max-width: 100%;
    margin: 0;
  }
  
  #installMethodModal .method-option {
    margin: 8px 0;
    padding: 12px;
    column-gap: 1px;
  }
}


#installMethodModal .method-option:focus {
  border-color: #00cfff;
  background-color: rgba(0, 207, 255, 0.1);
  outline: none;
}

#installMethodModal .method-option input[type="radio"] {
  margin: 0;
  transform: scale(1.2);
  flex-shrink: 0;
}

#installMethodModal .method-option label {
  margin-left: -5px;
  cursor: pointer;
  display: block;
  margin: 0;
  flex: 1;
}

#installMethodModal .method-option label small {
  color: #d0d0d0;
  transition: color 0.2s ease;
}

#installMethodModal .method-option.selected label small {
  color: #4caf50;
}

    
    /* –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ */
    html {
      -webkit-text-size-adjust: 100% !important;
      -moz-text-size-adjust: 100% !important;
      -ms-text-size-adjust: 100% !important;
      text-size-adjust: 100% !important;
      font-size: 16px !important; /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä */
    }

    body {
      font-size: 1rem !important; /* –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ html */
      -webkit-text-size-adjust: none !important;
      -moz-text-size-adjust: none !important;
      -ms-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    *, *::before, *::after {
      -webkit-text-size-adjust: none !important;
      -moz-text-size-adjust: none !important;
      -ms-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    /* –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ */
    select, input, button {
      font-size: 18px !important; /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
      -webkit-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    .card {
      font-size: 13px !important;
      -webkit-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    .sys-btn {
      font-size: 13px !important;
      -webkit-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }

    button {
      font-size: 14px !important;
      -webkit-text-size-adjust: none !important;
      text-size-adjust: none !important;
    }
    
  </style>
</head>

<body style="margin:0; padding:0;" class="splash-open">
  <div id="splash"><div id="logo"></div></div>
  <div id="main-content" style="display:none;"></div>

   <script>
  (function(){
    const logo = document.getElementById('logo');
    if (!logo) return;
    const LAND = "url('https://appassets.androidplatform.net/assets/webview/logo/usr.gif')";
    const PORT = "url('https://appassets.androidplatform.net/assets/webview/logo/usrPort.gif')";
    const mql = window.matchMedia('(orientation: portrait)');
    function apply() { logo.style.backgroundImage = mql.matches ? PORT : LAND; }
    apply();
    if (mql.addEventListener) mql.addEventListener('change', apply);
    else if (mql.addListener) mql.addListener(apply);
    window.addEventListener('orientationchange', apply);
  })();
  </script>

  <h5 style="margin-top:0; display:inline-flex; align-items:center; gap:4px;">
  <img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_launcher_round.png" alt="" style="height:18px; width:18px; object-fit:contain;">
  FastInstaller
</h5>
  <div id="adbStatusIndicator" class="adb-status-indicator">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ADB‚Ä¶</div>

  <div id="progress-container" style="display:none; width:100%; background:#000; padding:5px; z-index:1002; position:fixed; bottom:0; left:0; right:0;">
    <div id="progress-text" style="color:#fff; margin-bottom:5px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div style="width:100%; background:#000; height:8px; border-radius:6px;">
      <div id="progress-bar" style="height:8px; width:0%; background:#42A5F5; border-radius:6px;"></div>
    </div>
  </div>

  <div class="card-container" id="groupCards"></div>

  <script>
    // Enter/OK –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
    document.addEventListener('keydown', function (e) {
      const isOk = e.key === 'Enter' || e.key === 'NumpadEnter' || e.key === 'OK' || e.code === 'Enter';
      if (!isOk) return;
      if (anyModalOpen()) return;

      const selected = document.querySelector('.card.selected');
      if (!selected) return;
      currentGroup = selected.dataset.group;
      startInstall();
    });
  </script>

  <select id="groupSelect" style="display:none;"></select>
  <button type="button" id="passwordBtn">üîë –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</button>
  <div id="status"></div>

  <div class="system-buttons" id="mainSystemButtons">
    <button onclick="event.stopPropagation();window.AndroidInterface.openUnknownSources()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic1_unknow.png" alt="" style="height:30px;"><br>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAppSettingsList()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic2_appsSettings.png" alt="" style="height:28px;"><br>–í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAccessibilitySettings()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic3_accessibility.png" alt="" style="height:28px;"><br>–°–ø–µ—Ü –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openBatteryOptimization()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic4_allSettings.png" alt="" style="height:28px;"><br>–û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openFileManagerPlus()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic5_FileManagerPlus.png" alt="" style="height:26px;"><br>File Manager
    </button>
    <button onclick="openMiscModal(this)" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic6_fastPlus.png" alt="" style="height:28px;"><br>FastInstaller+
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAllAppsSide()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic7_appsdriver.png" alt="" style="height:28px;"><br>–ú–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
          </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAnydesk()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic8_anydesk.png" alt="" style="height:28px;"><br>AnyDesk
    </button>
    <button onclick="ignoreNextEnter=true;window.AndroidInterface.openPlayMarket()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic9_googleplay.png" alt="" style="height:24px;"><br>Google Play
    </button>
    <button onclick="AndroidInterface.updateWebView()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic10_updWebView.png" alt="" style="height:28px;"><br>–û–±–Ω–æ–≤–∏—Ç—å AndroidWebView
    </button>
	  <button onclick="ignoreNextEnter=true; openInternal('https://tvboxsetup.ru/sv/');" class="sys-btn">
  <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic11_about.png" alt="" style="height:28px;"><br>–û –ø—Ä–æ–≥—Ä–∞–º–º–µ
</button>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ -->
  <div id="autostartModal" class="modal" style="display:none;">
    <div class="modal-content">
      <div id="autostartCurrent" style="margin-bottom:10px; font-weight:bold;">–í—ã–±—Ä–∞–Ω–æ: –ù–µ—Ç</div>
      <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:</h3>
      <button onclick="disableAutostart()" class="sys-btn">üö´ –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫</button>
      <button onclick="ignoreNextEnter=true;window.AndroidInterface.testAutostart()" class="sys-btn">üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞</button>

      <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –°–û –°–ö–†–û–õ–õ–û–ú (–∏ –∑–¥–µ—Å—å –∂–µ –∫–Ω–æ–ø–∫–∞ –ó–∞–∫—Ä—ã—Ç—å) -->
      <div id="autostartListContainer">
        <div id="autostartList"></div>
        <button id="autostartCloseBtn" onclick="closeAutostartModal()">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ ¬´–†–∞–∑–Ω–æ–µ¬ª -->
  <div id="miscModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="miscHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">–†–∞–∑–Ω–æ–µ</h3>
      <div class="misc-buttons-container">
        <div class="system-buttons">
          <!-- <button onclick="ignoreNextEnter=true;window.AndroidInterface.openFilePicker()" class="sys-btn">
            <img src="https://raw.githubusercontent.com/F4IPTV/Play/main/Pictures/–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è (15).svg" alt="" style="height:26px;"><br>–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
          </button> -->
	  <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ -->
  <button onclick="showInstallMethodSettings()" class="sys-btn">
    <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic1_tools.png" alt="" style="height:26px;"><br>–í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
  </button>
  
          <button onclick="openAutostartModal()" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic2_autostart.png" alt="" style="height:28px;"><br>–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    </button>
	<button onclick="ignoreNextEnter=true;window.AndroidInterface.openWirelessDebuggingSettings()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic3_developer.png" alt="" style="height:26px;"><br>–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
          </button>
        <button onclick="ignoreNextEnter=true;requestLocalAdbConnection()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:26px;"><br>–ü–æ–¥–∫–ª—é—á–∏—Ç—å ADB (RSA)
		  </button>
			<button onclick="ignoreNextEnter=true;openAdbScanner()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:26px;"><br>–ö –¥—Ä—É–≥–æ–º—É (RSA)
          </button>
			<button onclick="ignoreNextEnter=true;window.AndroidInterface.openApkFilePicker()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic11_usb.png" alt="" style="height:26px;"><br>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å APK+
          </button>
			<button onclick="disablePackages(['com.amazon.amazonvideo.livingroom','com.android.cts.priv.ctsshim','com.android.printspooler','com.android.providers.calendar','com.android.providers.contacts','com.apple.atve.androidtv.appletv','com.google.android.feedback','com.xiaomi.mitv.mediaexplorer','com.google.android.play.games','com.google.android.syncadapters.calendar','com.iqiyi.i18n.tv','com.mitv.tvhome.michannel','com.mitv.tvhome.mitvplus','com.mitv.videoplayer','com.miui.tv.analytics','com.netflix.ninja','com.google.android.videos','com.sonyliv','in.startv.hotstar','com.android.dreams.basic','com.google.android.apps.tv.dreamx','com.mitv.tvhome.atv','com.mitv.dream'])" class="sys-btn">
      <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic7_clearcash7.png" alt="" style="height:28px;"><br>–û—Ç–∫/–≤–∫–ª –Ω–µ–Ω—É–∂–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    </button>
			
			<button onclick="ignoreNextEnter=true;window.AndroidInterface.openFilesPermissionSettings()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic_launcher_round.png" alt="" style="height:28px;"><br>–î–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏
          </button>
			
			<button onclick="ignoreNextEnter=true;window.AndroidInterface.openFilesPermissionSettingsForPackage('com.anydesk.anydeskandroid')" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/main/ic8_anydesk.png" alt="" style="height:28px;"><br>–î–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏
          </button>

			<button onclick="openMiscMoreModal(this)" class="sys-btn">
    <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic1_disable.png" alt="" style="height:26px;"><br>–î–æ–ø. —Ñ—É–Ω–∫—Ü–∏–∏
  </button>

		  
          
        </div>
      </div>
    </div>
  </div>

  <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ –≤–Ω—É—Ç—Ä–∏ ¬´–†–∞–∑–Ω–æ–µ¬ª -->
  <div id="miscMoreModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="miscMoreHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
      <div class="misc-buttons-container">
        <div class="system-buttons">

			  <button onclick="ignoreNextEnter=true; window.AndroidInterface.openActivityStubOneButton()" class="sys-btn">
  <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic9_AndroidWebView.png" alt="" style="height:24px;"><br>
  Activity Stub
</button>

          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openSettingsForPackage('com.android.documentsui')" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic10_Files.webp" alt="" style="height:22px;"><br> –§–∞–π–ª—ã
          </button>
			<button onclick="ignoreNextEnter=true;window.AndroidInterface.clearWebCache()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic7_clearcash.png" alt="" style="height:28px;"><br>–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.deleteCopiedBackups()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic8_cleartrash.png" alt="" style="height:28px;"><br>–£–¥–∞–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤
          </button>
           <button onclick="ignoreNextEnter=true;window.AndroidInterface.openSettingsForPackage('com.google.android.katniss')" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic5_googlekatniss.png" alt="" style="height:24px;"><br>Google Katniss
          </button>
          <button onclick="ignoreNextEnter=true;window.AndroidInterface.openAddAccountSettings()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic6_account.png" alt="" style="height:28px;"><br>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç
          </button>
           <button onclick="ignoreNextEnter=true;window.AndroidInterface.confirmWipeThirdPartyApps()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic8_cleartrash.png" alt="" style="height:28px;"><br>–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
          </button>
        
			<button onclick="ignoreNextEnter=true;window.AndroidInterface.openNetworkSettings()" class="sys-btn">
            <img src="https://appassets.androidplatform.net/assets/webview/icons/network/ic_wifi.png" alt="" style="height:28px;"><br>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Wi-Fi
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞ ADB -->
  <div id="adbScannerModal" class="modal" style="display:none;" tabindex="-1">
    <div class="modal-content">
      <h3 id="adbScannerHeader" style="display:flex;align-items:center;justify-content:center;gap:8px;">
        <img src="https://appassets.androidplatform.net/assets/webview/icons/misc/ic4_developer.png" alt="" style="height:25px;">
        –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ADB
      </h3>
      <div id="adbScanStatus" style="font-size:13px;opacity:.85;margin-bottom:12px;text-align:center;">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
      
      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º –¥–ª—è —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
      <div id="adbScanListContainer" style="max-height:60vh;overflow-y:auto;overscroll-behavior:contain;scroll-behavior:auto;scrollbar-gutter:stable both-edges;margin-bottom:20px;">
        <div id="adbScanList" style="display:flex;flex-direction:column;gap:12px;"></div>
      </div>
      
      <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
      <div class="system-buttons" style="justify-content:center;">
        <button class="sys-btn" onclick="restartAdbScan()" tabindex="0">‚Üª –ü–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="sys-btn" onclick="closeAdbScanner()" tabindex="0">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ -->
  <div id="modal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3 id="modalGroupHeader" style="display:flex;gap:8px;align-items:center;justify-content:center;"></h3>
      <div id="modalListContainer">
        <div id="modalList"></div>
        <button id="installAllBtn" onclick="installAll()" class="component-btn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë</button>
      </div>
    </div>
  </div>

  <script>
    let currentGroup = "";
    let cachedConfig = null;
    let lastFocusedElement = null;
    let lastPassword = "";
    let backupQueue = [];
    let backupTarget = "";
    let savedPassword = "";
    let ignoreNextEnter = false;
let __installMethodApplying = false;
let lastFocusedElementMiscMore = null;

    document.getElementById('passwordBtn').addEventListener('click', () => {
      const ai = window.AndroidInterface;
      if (ai?.requestPasswordPrefill) { ai.requestPasswordPrefill(savedPassword || ""); return; }
      if (ai?.requestPassword) { try { ai.requestPassword(savedPassword || ""); return; } catch (e) { ai.requestPassword(); return; } }
      const pwd = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å", savedPassword || "");
      if (pwd !== null) { savedPassword = pwd.trim(); updatePasswordBtn(); }
    });

    function setPasswordFromAndroid(pwd) { savedPassword = (pwd || "").trim(); updatePasswordBtn(); }
    function updatePasswordBtn() {
      const btn = document.getElementById('passwordBtn');
      btn.textContent = savedPassword ? `üîë –ü–∞—Ä–æ–ª—å: ${'*'.repeat(savedPassword.length)}` : "üîë –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å";
    }
    function anyModalOpen() { return ['modal','autostartModal','miscModal','installMethodModal','adbScannerModal'].some(id => document.getElementById(id)?.style.display === 'flex'); }

    function copyBackupsSequentially(urls, folder) { if (!urls.length) return; backupQueue = urls; backupTarget = folder; copyNextBackup(); }
    function copyNextBackup() {
      if (backupQueue.length === 0) { showStatus("‚úÖ –í—Å–µ –±—ç–∫–∞–ø—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã", "green"); return; }
      const url = backupQueue.shift(); const fileName = url.split('/').pop();
      showStatus(`‚è≥ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: ${fileName} <span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`, "#00cfff", 4000);
      window.AndroidInterface?.copyBackup(url, backupTarget);
    }
    function onBackupCopied() { copyNextBackup(); }

    const disablePackageStates = new Map();

let adbStatusRetryTimer = null;

function setAdbIndicator(text, connected) {
  const el = document.getElementById('adbStatusIndicator');
  if (!el) return;
  el.textContent = text;
  el.classList.toggle('connected', !!connected);
}

function refreshAdbStatusIndicator() {
  try {
    const raw = window.AndroidInterface?.getAdbConnectionInfo?.();
    if (!raw || raw === 'undefined') {
      setAdbIndicator('–õ–æ–∫–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', false);
      scheduleAdbStatusRetry();
      return;
    }
    const info = JSON.parse(raw);
    const fallback = info.connected ? 'ADB –ø–æ–¥–∫–ª—é—á–µ–Ω' : '–õ–æ–∫–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ';
    setAdbIndicator(info.label || fallback, info.connected);
  } catch (e) {
    console.warn('ADB status update error', e);
    setAdbIndicator('ADB: —Å—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω', false);
  }
}

function scheduleAdbStatusRetry() {
  clearTimeout(adbStatusRetryTimer);
  adbStatusRetryTimer = setTimeout(refreshAdbStatusIndicator, 2000);
}

window.refreshAdbStatusIndicator = refreshAdbStatusIndicator;

const adbScanState = {
  hosts: [],
  running: false,
  status: '–û–∂–∏–¥–∞–Ω–∏–µ...'
};
const FRIENDLY_NAME_FALLBACK = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ';

function applyFriendlyNameNode(node, friendlyName) {
  if (!node) return;
  const label = (friendlyName || '').trim();
  if (label) {
    node.textContent = label;
    node.classList.remove('adb-device-name--placeholder');
  } else {
    node.textContent = FRIENDLY_NAME_FALLBACK;
    node.classList.add('adb-device-name--placeholder');
  }
}

function resetAdbConnectionState() {
  window.AndroidInterface?.disconnectAdb?.();
}

function requestLocalAdbConnection() {
  resetAdbConnectionState();
  window.AndroidInterface?.connectAdb?.();
}

function openAdbScanner() {
  resetAdbConnectionState();
  const modal = document.getElementById('adbScannerModal');
  if (!modal) return;
  lastFocusedElement = document.activeElement;
  adbScanState.hosts = [];
  renderAdbScanHosts();
  updateAdbScanStatus('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏...', 0);
  modal.style.display = 'flex';
  document.body.classList.add('modal-open');
  document.activeElement?.blur();
  setTimeout(() => {
    const firstBtn = modal.querySelector('.system-buttons .sys-btn');
    if (firstBtn) {
      firstBtn.focus({ preventScroll: true });
    } else {
      modal.focus();
    }
  }, 100);
  try {
    window.AndroidInterface?.startNativeAdbScan?.();
  } catch (e) {}
}

function closeAdbScanner() {
  const modal = document.getElementById('adbScannerModal');
  if (!modal) return;
  modal.style.display = 'none';
  document.body.classList.remove('modal-open');
  try {
    window.AndroidInterface?.stopNativeAdbScan?.();
  } catch (e) {}
  if (lastFocusedElement && document.body.contains(lastFocusedElement)) {
    lastFocusedElement.focus({ preventScroll: true });
  }
  lastFocusedElement = null;
}

function restartAdbScan() {
  try {
    window.AndroidInterface?.stopNativeAdbScan?.();
  } catch (e) {}
  setTimeout(() => {
    try { window.AndroidInterface?.startNativeAdbScan?.(); } catch (err) {}
  }, 250);
}

function renderAdbScanHosts() {
  const list = document.getElementById('adbScanList');
  if (!list) return;
  list.innerHTML = '';
  if (!adbScanState.hosts.length) {
    const placeholder = document.createElement('div');
    placeholder.style.gridColumn = '1 / -1';
    placeholder.style.opacity = '.7';
    placeholder.style.textAlign = 'center';
    placeholder.textContent = adbScanState.running ? '–ò—â–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞...' : '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
    list.appendChild(placeholder);
    return;
  }
  adbScanState.hosts.forEach(host => {
    const card = document.createElement('div');
    card.className = 'adb-device-card';
    card.setAttribute('tabindex', '0');
    let connectTriggered = false;

    const nameEl = document.createElement('div');
    nameEl.className = 'adb-device-name';
    applyFriendlyNameNode(nameEl, host?.friendlyName);

    const ipEl = document.createElement('div');
    ipEl.className = 'adb-device-ip';
    ipEl.textContent = host?.ip || '‚Äî';

    card.append(nameEl, ipEl);
    const handleConnect = () => {
      if (connectTriggered) return;
      const ip = host?.ip;
      if (!ip) return;
      connectTriggered = true;
      closeAdbScanner();
      setTimeout(() => {
        connectToRemoteAdb(ip, host?.port || 5555);
        connectTriggered = false;
      }, 150);
    };
    const activationKeys = ['Enter', 'OK', 'Select', ' '];

    card.addEventListener('click', (event) => {
      event.preventDefault();
      document.querySelectorAll('#adbScanList .adb-device-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      handleConnect();
    });
    card.addEventListener('focus', () => {
      document.querySelectorAll('#adbScanList .adb-device-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      focusAndRevealAdbCard(card);
    });
    const handleKeyActivation = (event) => {
      if (!activationKeys.includes(event.key)) return;
      event.preventDefault();
      handleConnect();
    };
    card.addEventListener('keydown', handleKeyActivation);
    card.addEventListener('keyup', handleKeyActivation);
    card.addEventListener('keypress', handleKeyActivation);
    list.appendChild(card);
  });
}

function updateAdbScanStatus(message = null, totalOverride = null) {
  const status = document.getElementById('adbScanStatus');
  if (!status) return;
  if (typeof message === 'string' && message.length) {
    adbScanState.status = message;
  }
  const running = !!adbScanState.running;
  const fallback = running ? '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏‚Ä¶' : '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ';
  const base = adbScanState.status || fallback;
  const total = typeof totalOverride === 'number' ? totalOverride : adbScanState.hosts.length;

  status.classList.toggle('adb-scan-complete', !running);
  status.textContent = '';

  const label = document.createElement('span');
  label.className = 'adb-scan-label';
  label.textContent = base;
  status.appendChild(label);

  if (running) {
    const spinnerWrap = document.createElement('span');
    spinnerWrap.className = 'spin adb-scan-spinwrap';
    const spinnerImg = document.createElement('img');
    spinnerImg.src = 'https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png';
    spinnerImg.alt = '';
    spinnerImg.className = 'adb-scan-spinner';
    spinnerWrap.appendChild(spinnerImg);
    status.appendChild(spinnerWrap);
  }

  const totalSpan = document.createElement('span');
  totalSpan.className = 'adb-scan-total';
  totalSpan.textContent = `‚Ä¢ –ù–∞–π–¥–µ–Ω–æ: ${total}`;
  status.appendChild(totalSpan);
}

window.__applyAdbScanResults = function(payload) {
  let data = [];
  try {
    data = Array.isArray(payload) ? payload : JSON.parse(payload);
  } catch (e) {
    console.error('applyAdbScanResults parse error', e);
    return;
  }
  if (!Array.isArray(data)) data = [];
  adbScanState.hosts = data;
  renderAdbScanHosts();
  updateAdbScanStatus();
};

window.__handleAdbScanStatus = function(message, running, total) {
  if (typeof running === 'boolean') {
    adbScanState.running = running;
  }
  updateAdbScanStatus(typeof message === 'string' ? message : null, typeof total === 'number' ? total : null);
};

function connectToRemoteAdb(ip, port) {
  ignoreNextEnter = true;
  try {
    if (window.AndroidInterface?.connectAdbToHost) {
      window.AndroidInterface.connectAdbToHost(ip, port);
    } else if (window.AndroidInterface?.connectAdbTo) {
      window.AndroidInterface.connectAdbTo(`${ip}:${port}`);
    } else if (window.AndroidInterface?.connectAdb) {
      window.AndroidInterface.connectAdb(`${ip}:${port}`);
    } else {
      showToast({ message: '–ú–µ—Ç–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ADB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', type: 'error' });
    }
  } catch (e) {
    showToast({ message: '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ADB', type: 'error' });
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ –≤ —Å–∫–∞–Ω–µ—Ä–µ ADB
function focusAndRevealAdbCard(el, margin = 12) {
  if (!el) return;
  const container = document.getElementById('adbScanListContainer');
  if (!container) return;
  const cr = container.getBoundingClientRect();
  const er = el.getBoundingClientRect();
  if (er.top < cr.top + margin) container.scrollTop -= (cr.top + margin - er.top);
  else if (er.bottom > cr.bottom - margin) container.scrollTop += (er.bottom - (cr.bottom - margin));
  requestAnimationFrame(() => el.focus({ preventScroll: true }));
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –º–æ–¥–∞–ª–∫–µ —Å–∫–∞–Ω–µ—Ä–∞ ADB
(function attachAdbScannerNavOnce(){
  if (window.__adbScannerNavBound) return;
  window.__adbScannerNavBound = true;

  let lastIndexBeforeFooter = null;

  document.addEventListener('keydown', function (e) {
    const modal = document.getElementById('adbScannerModal');
    if (!modal || modal.style.display !== 'flex') return;
    
    // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –º–æ–¥–∞–ª–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
    const installModal = document.getElementById('installMethodModal');
    if (installModal && installModal.style.display === 'flex') return;

    e.stopPropagation();
    e.stopImmediatePropagation();

    const cards = Array.from(modal.querySelectorAll('.adb-device-card'));
    const buttons = Array.from(modal.querySelectorAll('.system-buttons .sys-btn'));
    const active = document.activeElement;

    if (e.key === 'Back' || e.key === 'Escape') {
      e.preventDefault();
      closeAdbScanner();
      return;
    }

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–Ω–æ–ø–∫–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≤–Ω–∏–∑—É)
    if (buttons.includes(active)) {
      const i = buttons.indexOf(active);
      switch (e.key) {
        case 'ArrowLeft':
          e.preventDefault();
          buttons[(i - 1 + buttons.length) % buttons.length].focus();
          break;
        case 'ArrowRight':
          e.preventDefault();
          buttons[(i + 1) % buttons.length].focus();
          break;
        case 'ArrowUp': {
          e.preventDefault();
          if (cards.length > 0) {
            const col = (lastIndexBeforeFooter != null) ? (lastIndexBeforeFooter % getAdbColumnsCount()) : 0;
            const lastRowStart = Math.floor((cards.length - 1) / getAdbColumnsCount()) * getAdbColumnsCount();
            const targetIndex = Math.min(lastRowStart + col, cards.length - 1);
            focusAndRevealAdbCard(cards[targetIndex]);
          }
          break;
        }
        case 'ArrowDown':
          e.preventDefault();
          break;
        case 'Enter':
          e.preventDefault();
          active.click();
          break;
      }
      return;
    }

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    if (cards.includes(active)) {
      const index = cards.indexOf(active);
      const cols = getAdbColumnsCount();
      const total = cards.length;
      const row = Math.floor(index / cols);
      const col = index % cols;
      const lastRow = Math.floor((total - 1) / cols);

      switch (e.key) {
        case 'ArrowDown': {
          e.preventDefault();
          if (row < lastRow) {
            const nextIndex = (row + 1) * cols + col;
            const targetIndex = (nextIndex < total) ? nextIndex : Math.min((lastRow * cols) + col, total - 1);
            focusAndRevealAdbCard(cards[targetIndex]);
          } else {
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–Ω–æ–ø–∫–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            lastIndexBeforeFooter = index;
            if (buttons.length > 0) buttons[0].focus();
          }
          break;
        }
        case 'ArrowUp': {
          e.preventDefault();
          if (row === 0) return; // —É–ø–æ—Ä –≤–≤–µ—Ä—Ö—É
          const prevIndex = (row - 1) * cols + col;
          focusAndRevealAdbCard(cards[prevIndex]);
          break;
        }
        case 'ArrowLeft': {
          e.preventDefault();
          if (col === 0) return;
          focusAndRevealAdbCard(cards[index - 1]);
          break;
        }
        case 'ArrowRight': {
          e.preventDefault();
          if ((col === cols - 1) || (index + 1 >= total)) return;
          focusAndRevealAdbCard(cards[index + 1]);
          break;
        }
        case 'Enter': {
          e.preventDefault();
          // –ù–∞–∂–∞—Ç–∏–µ Enter –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ = –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
          const connectBtn = active.querySelector('.adb-connect-btn');
          if (connectBtn) connectBtn.click();
          break;
        }
      }
      return;
    }

    // –ï—Å–ª–∏ —Ñ–æ–∫—É—Å –Ω–µ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö –º–æ–¥–∞–ª–∫–∏ - –ø–µ—Ä–µ–≤–æ–¥–∏–º –Ω–∞ –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É –∏–ª–∏ –∫–Ω–æ–ø–∫—É
    if (cards.length > 0) {
      e.preventDefault();
      focusAndRevealAdbCard(cards[0]);
    } else if (buttons.length > 0) {
      e.preventDefault();
      buttons[0].focus();
    }
  }, true);

  // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–ª–æ–Ω–æ–∫
  function getAdbColumnsCount() {
    const cards = Array.from(document.querySelectorAll('#adbScanList .adb-device-card'));
    if (cards.length < 2) return 1;
    const firstTop = cards[0].getBoundingClientRect().top;
    let cols = 1;
    for (let i = 1; i < cards.length; i++) {
      if (Math.abs(cards[i].getBoundingClientRect().top - firstTop) < 5) {
        cols++;
      } else break;
    }
    return cols;
  }
})();

    function selectCard(card) {
      document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      currentGroup = card.dataset.group;
      const s = document.getElementById('status'); s.innerHTML = ""; s.classList.remove('visible');
    }

    function disablePackages(packages) {
      const list = Array.isArray(packages)
        ? packages
        : String(packages || "")
            .split(',')
            .map(p => p.trim())
            .filter(Boolean);

      if (!list.length) return;

      const key = list.join('|').toLowerCase();
      const nextDisable = !(disablePackageStates.get(key) ?? false);
      disablePackageStates.set(key, nextDisable);

      const payload = { packages: list, disable: nextDisable };

      try {
        window.AndroidInterface?.disablePackage(JSON.stringify(payload));
      } catch (e) {
        window.AndroidInterface?.disablePackage(JSON.stringify(payload));
      }
    }

    // === –ö–æ–Ω—Ñ–∏–≥ (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç) –∏ —Ä–µ–Ω–¥–µ—Ä –≥—Ä—É–ø–ø ===
    function getConfigUrl() {
      // URL –∫–æ–Ω—Ñ–∏–≥–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      return window.AndroidInterface?.getConfigUrl?.() || "";
    }

    async function ensureConfig() {
      if (cachedConfig) return cachedConfig;
      const url = getConfigUrl();
      const r = await fetch(url, { cache: 'no-store' });
      if (!r.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥');
      const cfg = await r.json();
      cachedConfig = cfg;
      return cfg;
    }

    function createGroupIcon(url) {
      const isSvg = /\.svg(\?|$)/i.test(url);
      const makeImg = () => {
        const img = document.createElement('img');
        img.src = url;
        img.alt = '';
        img.style.height = '25px';
        img.style.width = '25px';
        img.style.objectFit = 'contain';
        return img;
      };

      if (!isSvg) return makeImg();

      const img = makeImg();
      img.onerror = () => {
        // –§–æ–ª–±—ç–∫: CSS background-image (—á–∞—Å—Ç–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ WebView, –∫–æ–≥–¥–∞ <img> —Å SVG –Ω–µ—Ç)
        const box = document.createElement('div');
        box.style.width = '25px';
        box.style.height = '25px';
        box.style.backgroundImage = `url("${url}")`;
        box.style.backgroundRepeat = 'no-repeat';
        box.style.backgroundSize = 'contain';
        box.style.backgroundPosition = 'center';
        img.replaceWith(box);
      };
      return img;
    }

    function renderGroupsFromConfig(config) {
      const container = document.getElementById('groupCards') || document.querySelector('.card-container');
      if (!container) return;
      container.innerHTML = '';

      const groups = config.groups || {};
      const entries = Object.entries(groups);
      if (!entries.length) {
        container.innerHTML = '<div style="opacity:.7">–ù–µ—Ç –≥—Ä—É–ø–ø</div>';
        return;
      }

      entries.forEach(([groupKey, groupObj]) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('tabindex', '0');
        card.dataset.group = groupKey;

        if (groupObj && groupObj.icon) {
          const iconEl = createGroupIcon(groupObj.icon);
          card.appendChild(iconEl);
        }
        card.appendChild(document.createTextNode(groupKey));

        card.onclick = () => { selectCard(card); startInstall(); };
        card.onfocus = () => selectCard(card);

        container.appendChild(card);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      ensureConfig()
        .then(cfg => { renderGroupsFromConfig(cfg); })
        .catch(() => { /* –ø–æ–∫–∞–∂–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å */ });
      refreshAdbStatusIndicator();
      setInterval(refreshAdbStatusIndicator, 5000);
    });

    let lastStartAttempt = 0;
    const START_DEBOUNCE_MS = 500;

    async function startInstall() {
      const now = Date.now();
      if (now - lastStartAttempt < START_DEBOUNCE_MS) return;
      lastStartAttempt = now;

      const group = currentGroup;
      const password = savedPassword;
      const status = document.getElementById('status');
      if (!group) { status.innerHTML = "‚ùó –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç."; status.style.color = "red"; status.classList.add('visible'); return; }

      try {
        const config = await ensureConfig();
        const groupInfo = (config.groups || {})[group];
        if (!groupInfo) { status.innerHTML = "‚ùå –ì—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"; status.style.color = "red"; status.classList.add('visible'); return; }
        if ((groupInfo.password || "") !== (password || "")) { showToast({ message: "üîí –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!" }); return; }
        cachedConfig = config;
        lastFocusedElement = document.activeElement;
        showGroupList(config);
      } catch (error) {
        status.innerHTML = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏."; status.style.color = "red"; status.classList.add('visible');
      }
    }

    function showStatus(message, color, timeout = 4000) {
      const status = document.getElementById('status');
      status.innerHTML = message; status.style.color = color; status.classList.add('visible');
      clearTimeout(status.hideTimer);
      status.hideTimer = setTimeout(() => status.classList.remove('visible'), timeout);
    }

    function getToastStack(position = 'bottom-center') {
      const id = `toast-stack-${position}`; let stack = document.getElementById(id);
      if (stack) return stack;
      const [v,h] = position.split('-');
      stack = document.createElement('div');
      stack.id = id;
      stack.className = `toast-stack toast-stack--${v} ${h === 'center' ? 'toast-stack--centerX' : (h === 'left' ? 'toast-stack--left' : 'toast-stack--right')} ${v === 'center' ? 'toast-stack--center' : ''}`;
      document.body.appendChild(stack);
      return stack;
    }
    function showToast({ message, type="info", iconUrl=null, withSpin=false, position="bottom-center", variant="default", duration=3000, anchor=null, offset=10, colors=null }) {
      if (!message) return;
      const styles = {
        success: { bg: "rgba(0,128,0,.85)", text: "#fff" },
        error:   { bg: "rgba(220,0,0,.9)",  text: "#fff" },
        warning: { bg: "rgba(255,165,0,.9)", text: "#000" },
        info:    { bg: "rgba(242,0,0,.85)", text: "#fff" },
        blue:    { bg: "rgba(0,123,255,.9)", text: "#fff" },
        pink:    { bg: "rgba(255,105,180,.9)", text: "#000" }
      };
      const scheme = colors || styles[type] || styles.info;

      const toast = document.createElement('div');
      toast.className = 'toast' + (variant==='pill'?' toast--pill':'') + (variant==='compact'?' toast--compact':'') + (variant==='card'?' toast--card':'');
      toast.style.backgroundColor = scheme.bg; toast.style.color = scheme.text;
      let html = '';
      if (withSpin) html += `<span class="spin">‚è≥</span>`;
      html += `<span>${message}</span>`;
      if (iconUrl) html += `<img src="${iconUrl}" alt="" style="height:20px; width:20px; object-fit:contain; vertical-align:middle;">`;
      toast.innerHTML = html;

      let cleanup;
      if (anchor) {
        const el = typeof anchor === 'string' ? document.querySelector(anchor) : anchor;
        const rect = el?.getBoundingClientRect();
        toast.classList.add('toast--anchored'); document.body.appendChild(toast);
        const top = (rect?.bottom ?? 0) + offset;
        const left = (rect ? rect.left + rect.width / 2 : window.innerWidth / 2);
        toast.style.top = `${top}px`; toast.style.left = `${left}px`; toast.style.transform = 'translateX(-50%)';
        cleanup = () => toast.remove();
      } else {
        const stack = getToastStack(position); stack.appendChild(toast);
        cleanup = () => { toast.remove(); if (!stack.children.length) stack.remove(); };
      }
      requestAnimationFrame(() => toast.classList.add('show'));
      const hide = () => { toast.classList.remove('show'); setTimeout(cleanup, 250); };
      const timer = setTimeout(hide, duration);
      toast.addEventListener('click', () => { clearTimeout(timer); hide(); });
    }

    // ===== –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø—ã =====
    function showGroupList(config)  {
      const modal = document.getElementById('modal');
      const list  = document.getElementById('modalList');
      const header = document.getElementById('modalGroupHeader');
      list.innerHTML = "";


      document.activeElement?.blur();
      document.querySelectorAll('.card.selected').forEach(c => c.classList.remove('selected'));

      if (header) {
  header.innerHTML = "";
  const groupInfo = (config.groups || {})[currentGroup];
  if (groupInfo?.icon) header.appendChild(createGroupIcon(groupInfo.icon));
      header.appendChild(document.createTextNode(currentGroup));
}

      modal.style.display = "flex";
      document.body.classList.add("modal-open"); // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      setTimeout(() => { document.querySelector('#modalList .component-btn')?.focus({ preventScroll: true }); }, 80);

      const apps    = (config.apps || []).filter(app => (app.tags || []).includes(currentGroup));
      const backups = (config.backups || []).filter(backup => (backup.tags || []).includes(currentGroup));
      const links   = (config.links || []).filter(link => (link.tags || []).includes(currentGroup));
      if (apps.length === 0 && backups.length === 0 && links.length === 0) list.innerHTML = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.";

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫: –∏–∫–æ–Ω–∫–∞ + –∏–º—è –≥—Ä—É–ø–ø—ã
      if (header) {
        header.innerHTML = "";
        const groupInfo = (config.groups || {})[currentGroup];
        if (groupInfo && groupInfo.icon) {
          const iconEl = createGroupIcon(groupInfo.icon);
          iconEl.style.height = '25px';
          iconEl.style.width = '25px';
          header.appendChild(iconEl);
        }
        const title = document.createElement('span');
        title.textContent = currentGroup;
        header.appendChild(title);
      }

      apps.forEach(app => {
        const btn = document.createElement('button');
        btn.className = 'component-btn'; btn.setAttribute('tabindex','0'); btn.textContent = app.file;
        btn.onclick = () => {
          const method = window.AndroidInterface?.getInstallMethod?.() || 'sai';
          const statusMsg = method === 'adb'
            ? `ADB —É—Å—Ç–∞–Ω–æ–≤–∫–∞...<span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`
            : `–ó–∞–≥—Ä—É–∑–∫–∞ APK...<span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`;
          showStatus(statusMsg, "#00cfff", 4000);
          window.AndroidInterface?.installSingle(app.url, app.file || "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ");
        };
        list.appendChild(btn);
      });

      backups.forEach(backup => {
        const btn = document.createElement('button');
        btn.className = 'component-btn'; btn.setAttribute('tabindex','0'); btn.textContent = backup.file;
        btn.onclick = () => {
  if (backup.files) {
    showStatus(`–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤... <span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`, "#00cfff", 4000);
    window.AndroidInterface?.copyFilesWithTargets(JSON.stringify(backup.files));
  } else {
    const urls = backup.urls || (backup.url ? [backup.url] : []);
    if (!urls.length) return;
    showStatus(`–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤... <span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`, "#00cfff", 4000);
    window.AndroidInterface?.copyMultipleBackups(JSON.stringify(urls), backup.target_folder || 'Download');
  }
};
        list.appendChild(btn);
      });

      links.forEach(link => {
        const btn = document.createElement('button');
        btn.className = 'component-btn'; btn.setAttribute('tabindex','0'); btn.textContent = link.file;
        btn.onclick = () => { showStatus("üîó –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏...", "green", 3000); window.AndroidInterface?.openLink(link.url); };
        list.appendChild(btn);
      });

      modal.style.display = "flex";
      setTimeout(() => { document.querySelector('#modalList .component-btn')?.focus({ preventScroll: true }); }, 80);
    }


    

    function installAll() {
  if (window.AndroidInterface) {
    requestAnimationFrame(() => {
      setTimeout(() => {
        window.AndroidInterface.startInstallation(currentGroup);
      }, 100);  // –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ 200-300, –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –Ω–µ –≤–∏–¥–Ω–æ
    });
  }
}

 function installAllSend() {
  /* showStatus("‚è≥ –ù–∞—á–∞–ª–∞—Å—å –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –æ–∂–∏–¥–∞–π—Ç–µ!!! <span class='spin'>‚è≥</span>", "orange", 4000); */
showStatus(`–ù–∞—á–∞–ª–∞—Å—å –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –æ–∂–∏–¥–∞–π—Ç–µ!!!<span class="spin"><img src="https://appassets.androidplatform.net/assets/webview/icons/title/ic_load_round.png" style="height:29px; vertical-align:middle;"></span>`, "#00cfff", 4000);
 }
    


    function closeModal() {
      const modal = document.getElementById('modal');
      modal.style.display = "none";
      document.body.classList.remove("modal-open"); // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      if (lastFocusedElement && document.body.contains(lastFocusedElement)) {
        if (lastFocusedElement.classList?.contains('card')) selectCard(lastFocusedElement);
        lastFocusedElement.focus?.({ preventScroll: true });
      }
    }

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –º–æ–¥–∞–ª–∫–µ –≥—Ä—É–ø–ø (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏)
    (function () {
      const modal     = document.getElementById('modal');
      const list      = document.getElementById('modalList');
      const container = document.getElementById('modalListContainer');
      let navLock = false;
      let lastIndexBeforeFooter = null;
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–ª–æ–Ω–æ–∫
      function getColumnsCount() {
        const buttons = Array.from(list.querySelectorAll('.component-btn'));
        if (buttons.length < 2) return 1;
        
        const firstTop = buttons[0].getBoundingClientRect().top;
        let cols = 1;
        for (let i = 1; i < buttons.length; i++) {
          if (Math.abs(buttons[i].getBoundingClientRect().top - firstTop) < 5) {
            cols++;
          } else break;
        }
        return cols;
      }

      function focusAndReveal(el, margin = 12) {
        if (!el || !container) return;
        const cr = container.getBoundingClientRect();
        const er = el.getBoundingClientRect();
        if (er.top < cr.top + margin) container.scrollTop -= (cr.top + margin - er.top);
        else if (er.bottom > cr.bottom - margin) container.scrollTop += (er.bottom - (cr.bottom - margin));
        requestAnimationFrame(() => el.focus({ preventScroll: true }));
      }

      document.addEventListener('keydown', (e) => {
        if (modal.style.display !== 'flex') return;
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –º–æ–¥–∞–ª–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
        const installModal = document.getElementById('installMethodModal');
        if (installModal && installModal.style.display === 'flex') return;
        
        const keys = ['ArrowDown','ArrowUp','ArrowLeft','ArrowRight','Enter'];
        if (!keys.includes(e.key)) return;
        if (e.repeat) { e.preventDefault(); return; }

        const buttons = Array.from(list.querySelectorAll('.component-btn'));
        if (!buttons.length) return;
        
        const cols = getColumnsCount(); // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫
        const installBtn = document.getElementById('installAllBtn');
        const active = document.activeElement;

        if (active === installBtn) {
          e.preventDefault(); e.stopPropagation();
          if (e.key === 'ArrowDown') return;

          const lastRowStart = Math.floor((buttons.length - 1) / cols) * cols;
          const fallbackCol = 0;
          const colFromMemory = (lastIndexBeforeFooter != null) ? (lastIndexBeforeFooter % cols) : fallbackCol;
          const targetIndex = Math.min(lastRowStart + colFromMemory, buttons.length - 1);

          if (e.key === 'ArrowUp') { focusAndReveal(buttons[targetIndex]); return; }
          if (e.key === 'ArrowLeft' && cols > 1) { const leftIndex = Math.max(targetIndex - 1, lastRowStart); focusAndReveal(buttons[leftIndex]); return; }
          if (e.key === 'ArrowRight' && cols > 1) { const rowEnd = Math.min(lastRowStart + cols - 1, buttons.length - 1); const rightIndex = Math.min(targetIndex + 1, rowEnd); focusAndReveal(buttons[rightIndex]); return; }
          if (e.key === 'Enter') { installBtn.click(); return; }
          return;
        }

        let index = buttons.indexOf(active);
        if (index === -1) { e.preventDefault(); focusAndReveal(buttons[0]); return; }

        e.preventDefault(); e.stopPropagation();
        if (e.key === 'Enter') { active?.click(); return; }
        if (navLock) return;
        navLock = true; setTimeout(() => (navLock = false), 90);

        if (e.key === 'ArrowDown') {
          if (index + cols < buttons.length) { focusAndReveal(buttons[index + cols]); }
          else {
            lastIndexBeforeFooter = index;
            if (installBtn) { focusAndReveal(installBtn); }
          }
          return;
        }
        if (e.key === 'ArrowUp') { const prev = index - cols; focusAndReveal(buttons[Math.max(prev, 0)]); return; }
        if (e.key === 'ArrowRight' && cols > 1) { if ((index % cols) < (cols - 1) && index + 1 < buttons.length) focusAndReveal(buttons[index + 1]); return; }
        if (e.key === 'ArrowLeft' && cols > 1) { if ((index % cols) > 0) focusAndReveal(buttons[index - 1]); return; }
      });
    })();

    function handleBackButton() {
      if (document.getElementById('installMethodModal')?.style.display === 'flex') closeInstallMethodSettings();
      else if (document.getElementById('miscMoreModal')?.style.display === 'flex') closeMiscMoreModal();
      else if (document.getElementById('miscModal')?.style.display === 'flex') closeMiscModal();
      else if (document.getElementById('adbScannerModal')?.style.display === 'flex') closeAdbScanner();
      else if (document.getElementById('autostartModal')?.style.display === 'flex') closeAutostartModal();
      else if (document.getElementById('modal')?.style.display === 'flex') closeModal();
      else { window.AndroidInterface.requestAppExit(); }
    }

    

   function updateProgress(current=null, total=null, percent=0, label) {
      const container = document.getElementById("progress-container");
      const bar = document.getElementById("progress-bar");
      const text = document.getElementById("progress-text");
      container.style.display = "block"; 
      bar.style.width = percent + "%";
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ undefined –∏ null –∑–Ω–∞—á–µ–Ω–∏—è
      if (current !== null && total !== null && current !== undefined && total !== undefined && label) {
        text.innerHTML = `–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:&nbsp;&nbsp; ${label}&nbsp;&nbsp;&nbsp;&nbsp;${percent}%`;
      } else {
        text.innerText = `–ó–∞–≥—Ä—É–∑–∫–∞...`;
      }
      if (percent >= 100 && (current === null || current === total)) {
        setTimeout(() => { container.style.display = "none"; bar.style.width = "0%"; text.innerHTML = ""; }, 1500);
      }
    }
    function updateProgressWithLabel(current, total, percent, label) {
      const container = document.getElementById("progress-container");
      const bar = document.getElementById("progress-bar");
      const text = document.getElementById("progress-text");
      container.style.display = "block"; bar.style.width = percent + "%"; text.innerText = `–ó–∞–≥—Ä—É–∑–∫–∞ ${label}: ${percent}%`;
      if (percent >= 100 && current === total) setTimeout(() => { container.style.display = "none"; bar.style.width = "0%"; text.innerText = ""; }, 1500);
    }

    function openAutostartModal() {
      // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –º–æ–¥–∞–ª–∫–∞ ¬´–†–∞–∑–Ω–æ–µ¬ª, –∑–∞–∫—Ä—ã–≤–∞–µ–º –µ—ë –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –ø–æ—Ç–æ–º –Ω–∞ –∫–Ω–æ–ø–∫—É FastInstaller+
      const misc = document.getElementById('miscModal');
      if (misc && misc.style.display === 'flex') {
        const fastPlusBtn = document.querySelector('.system-buttons .sys-btn[onclick*="openMiscModal"]');
        lastFocusedElement = fastPlusBtn || document.activeElement;
        closeMiscModal(false); // –∑–∞–∫—Ä—ã—Ç—å –±–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ–∫—É—Å–∞ —Å–µ–π—á–∞—Å
      } else {
        lastFocusedElement = document.activeElement;
      }
      const modal = document.getElementById('autostartModal');
      const list = document.getElementById('autostartList');
      const current = document.getElementById('autostartCurrent');
      current.innerHTML = '<span style="color:#00cfff;">–ë–µ–∑ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞</span>';

      window.AndroidInterface?.getCurrentAutostartApp();

      // –°–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–≥–æ —Ñ–æ–∫—É—Å–∞ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º
      document.activeElement?.blur();
      modal.style.display = 'flex';
      list.innerHTML = '<div style="grid-column:1/-1; text-align:center;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';

      window.AndroidInterface?.getUserApps();

      // –§–æ–ª–±—ç–∫-—Ñ–æ–∫—É—Å, –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–¥—ë—Ç –ø–æ–∑–¥–Ω–æ
      setTimeout(() => {
        const first = list.querySelector('.card');
        if (first) first.focus({ preventScroll: true }); else { modal.setAttribute('tabindex','-1'); modal.focus(); }
      }, 500);
    }

    function setCurrentAutostartApp(appLabel, appIcon) {
      const current = document.getElementById("autostartCurrent");
      current.innerHTML = `
        <span style="font-weight:bold; color:#00cfff;">–ê–∫—Ç–∏–≤–Ω–æ–µ:</span>
        <img src="${appIcon}" alt="" style="height:24px; vertical-align:middle; margin:0 6px;">
        <span style="font-weight:bold;">${appLabel}</span>`;
    }

    function closeAutostartModal() {
      document.getElementById('autostartModal').style.display = 'none';
      if (lastFocusedElement && document.body.contains(lastFocusedElement)) lastFocusedElement.focus();
    }

    /* === helpers –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ === */
    function getAutostartCols() {
      const grid = document.getElementById('autostartList');
      if (!grid) return 5;
      const cs = getComputedStyle(grid);
      const tpl = cs.getPropertyValue('grid-template-columns');
      const count = (tpl || '').split(' ').filter(Boolean).length;
      return count || 5;
    }
    function focusAndRevealAuto(el, margin = 12) {
      const container = document.getElementById('autostartListContainer');
      if (!el || !container) return;
      const cr = container.getBoundingClientRect();
      const er = el.getBoundingClientRect();
      if (er.top < cr.top + margin) container.scrollTop -= (cr.top + margin - er.top);
      else if (er.bottom > cr.bottom - margin) container.scrollTop += (er.bottom - (cr.bottom - margin));
      requestAnimationFrame(() => el.focus({ preventScroll: true }));
    }

    function renderAppSelection(json) {
      const apps = JSON.parse(json);
      const list = document.getElementById('autostartList');
      list.innerHTML = '';

      apps.forEach(app => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('tabindex', '0');
        card.innerHTML = `<img src="${app.icon}" alt="" style="height:24px;"><br>${app.label}`;

        card.onclick = (ev) => {
          ev.preventDefault(); ev.stopPropagation();
          window.AndroidInterface.saveAutostartPackage(app.package);
          setCurrentAutostartApp(app.label, app.icon);
          showToast({ message: `${app.label} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–∞–∫ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫`, iconUrl: app.icon, type: "success" });
        };

        // –í–ê–ñ–ù–û: –Ω–µ –º–µ–Ω—è—Ç—å "–í—ã–±—Ä–∞–Ω–æ" –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ —Ç—ã –ø—Ä–æ—Å–∏–ª
        card.onfocus = () => {
          document.querySelectorAll('#autostartList .card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          const cur = document.getElementById("autostartCurrent");
          if (cur) cur.textContent = "–í—ã–±—Ä–∞–Ω–æ: " + applabel;
          focusAndRevealAuto(card);
        };
        card.onblur = () => card.classList.remove('selected');

        list.appendChild(card);
      });

      // –Ø–≤–Ω–æ —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É –∏ —Å—Ç—Ä–∞—Ö—É–µ–º—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Ñ–æ–∫—É—Å–∞
      const ensureFirstFocus = () => {
        const first = list.querySelector('.card');
        if (!first) return;
        const active = document.activeElement;
        if (!list.contains(active)) first.focus({ preventScroll: true });
      };
      setTimeout(ensureFirstFocus, 50);
      setTimeout(ensureFirstFocus, 200);
      setTimeout(ensureFirstFocus, 600);

      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ª—é–±—ã–µ —Å—Ç–∞—Ä—ã–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
      const hardResetFocus = () => {
        const container = document.getElementById('autostartListContainer');
        if (container) container.scrollTop = 0;
        list.querySelectorAll('.card.selected').forEach(c => c.classList.remove('selected'));
        const first = list.querySelector('.card');
        if (first) {
          first.classList.add('selected');
          first.focus({ preventScroll: true });
        }
      };
      requestAnimationFrame(hardResetFocus);
      setTimeout(hardResetFocus, 0);
      setTimeout(hardResetFocus, 150);
    }

    function disableAutostart() {
      window.AndroidInterface?.DeleteAutostartPackage("");
      const current = document.getElementById('autostartCurrent');
      if (current) current.innerHTML = '<span style="color:#00cfff;">–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –æ—Ç–∫–ª—é—á—ë–Ω</span>';
      showToast({ message: "–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –æ—Ç–∫–ª—é—á—ë–Ω" });
    }

    function hideProgress() {
      const container = document.getElementById('progress-container');
      const bar = document.getElementById('progress-bar');
      const text = document.getElementById('progress-text');
      if (container) container.style.display = 'none';
      if (bar) bar.style.width = '0%';
      if (text) text.innerText = '';
    }

    function onInstalledAppsReceived(appsJson) {
      const container = document.getElementById('appList');
      if (!container) return;
      container.innerHTML = '';
      let apps;
      try { apps = JSON.parse(appsJson); }
      catch (e) { container.innerHTML = '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞.'; return; }

      apps.forEach(app => {
        const btn = document.createElement('button');
        btn.textContent = `${app.name} (${app.package})`;
        btn.onclick = () => { window.AndroidInterface.setAutostartPackage(app.package); alert("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: " + app.name); closeAutostartModal(); };
        container.appendChild(btn);
        container.appendChild(document.createElement('br'));
      });
    }

    // –°–Ω—è—Ç–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å –≥—Ä—É–ø–ø—ã –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –Ω–∏–∂–Ω–∏—Ö –∫–Ω–æ–ø–∫–∞—Ö
    document.querySelectorAll(".system-buttons .sys-btn, #passwordBtn, #startBtn").forEach(btn => {
      btn.addEventListener("focus", () => { document.querySelectorAll(".card").forEach(c => c.classList.remove("selected")); });
    });

    setTimeout(() => {
      document.getElementById('splash').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      document.body.classList.remove('splash-open');
      document.documentElement.classList.remove('splash-open');
      // –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø–æ—Å–ª–µ —Å–ø–ª—ç—à–∞ (—Å–±—Ä–∞—Å—ã–≤–∞–µ–º inline overflow —É <html>)
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    }, 4000);

    // === –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–µ (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏, ¬´–ó–∞–∫—Ä—ã—Ç—å¬ª –≤–Ω—É—Ç—Ä–∏ —Ç–æ–≥–æ –∂–µ —Å–∫—Ä–æ–ª–ª–∞) ===
    (function attachAutostartNavOnce(){
      if (window.__autoStartNavBoundV4) return;
      window.__autoStartNavBoundV4 = true;

      let lastIndexBeforeHeader = null; // –æ—Ç–∫—É–¥–∞ —É—à–ª–∏ –ù–ê –≤–µ—Ä—Ö–Ω—é—é –∫–Ω–æ–ø–∫—É
      let lastIndexBeforeFooter = null; // –æ—Ç–∫—É–¥–∞ —É—à–ª–∏ –ù–ê "–ó–∞–∫—Ä—ã—Ç—å"

      document.addEventListener('keydown', function (e) {
        const modal = document.getElementById('autostartModal');
        if (!modal || modal.style.display !== 'flex') return;
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –º–æ–¥–∞–ª–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
        const installModal = document.getElementById('installMethodModal');
        if (installModal && installModal.style.display === 'flex') return;

        e.stopPropagation();
        e.stopImmediatePropagation();

const list      = document.getElementById('autostartList');
const cards     = Array.from(list.querySelectorAll('.card'));
const headerBtns = Array.from(modal.querySelectorAll('.sys-btn')); // –æ–±–µ –≤–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
const closeBtn  = document.getElementById('autostartCloseBtn');
if (!cards.length) return;

const cols   = getAutostartCols();
const active = document.activeElement;

// –§–æ–∫—É—Å –Ω–∞ –≤–µ—Ä—Ö–Ω–∏—Ö –∫–Ω–æ–ø–∫–∞—Ö // === –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–µ (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏, ¬´–ó–∞–∫—Ä—ã—Ç—å¬ª –≤–Ω—É—Ç—Ä–∏ —Ç–æ–≥–æ –∂–µ —Å–∫—Ä–æ–ª–ª–∞) ===
if (headerBtns.includes(active)) {
  document.querySelectorAll('#autostartList .card.selected').forEach(c => c.classList.remove('selected'));
  const i = headerBtns.indexOf(active);
  switch (e.key) {
    case 'ArrowLeft':
      e.preventDefault();
      headerBtns[(i - 1 + headerBtns.length) % headerBtns.length].focus();
      break;
    case 'ArrowRight':
      e.preventDefault();
      headerBtns[(i + 1) % headerBtns.length].focus();
      break;
    case 'ArrowDown': {
      e.preventDefault();
      const col = (lastIndexBeforeHeader != null) ? (lastIndexBeforeHeader % cols) : 0;
      const targetIndex = Math.min(col, cards.length - 1);
      focusAndRevealAuto(cards[targetIndex]);
      break;
    }
    case 'ArrowUp':
      e.preventDefault(); // –Ω–µ —É—Ö–æ–¥–∏–º –≤—ã—à–µ
      break;
    case 'Enter':
      e.preventDefault(); active.click(); break;
    case 'Back':
    case 'Escape':
      e.preventDefault(); closeAutostartModal(); break;
  }
  return;
}

// –§–æ–∫—É—Å –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö: —Å—Ç—Ä–µ–ª–∫–∞ –í–≤–µ—Ä—Ö –∏–∑ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ ‚Äî –∫ –≤–µ—Ä—Ö–Ω–∏–º –∫–Ω–æ–ø–∫–∞–º
if (cards.includes(active)) {
  const idx = cards.indexOf(active);
  if (e.key === 'ArrowUp' && idx < cols) {
    e.preventDefault();
    lastIndexBeforeHeader = idx;
    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –±–ª–∏–∂–∞–π—à–µ–π –≤–µ—Ä—Ö–Ω–µ–π –∫–Ω–æ–ø–∫–µ: 0 -> –ø–µ—Ä–≤–∞—è, 1 -> –≤—Ç–æ—Ä–∞—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
    headerBtns[Math.min(idx, headerBtns.length - 1)].focus();
    return;
  }
}

        // –ù–∏–∂–Ω—è—è –∫–Ω–æ–ø–∫–∞ (–≤–Ω—É—Ç—Ä–∏ —Ç–æ–≥–æ –∂–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
        if (active === closeBtn) {
          document.querySelectorAll('#autostartList .card.selected').forEach(c => c.classList.remove('selected'));
          switch (e.key) {
            case 'ArrowUp': {
              e.preventDefault();
              const total = cards.length;
              const lastRow = Math.floor((total - 1) / cols);
              const lastRowStart = lastRow * cols;
              const col = (lastIndexBeforeFooter != null) ? (lastIndexBeforeFooter % cols) : 0;
              const targetIndex = Math.min(lastRowStart + col, total - 1);
              focusAndRevealAuto(cards[targetIndex]);
              break;
            }
            case 'ArrowDown':
            case 'ArrowLeft':
            case 'ArrowRight':
              e.preventDefault(); break; // —É–ø–æ—Ä –≤–Ω–∏–∑—É
            case 'Enter':
              e.preventDefault(); closeBtn.click(); break;
            case 'Back':
            case 'Escape':
              e.preventDefault(); closeAutostartModal(); break;
          }
          return;
        }

        // –û–±—ã—á–Ω–∞—è —Å–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
        const index = cards.indexOf(active);
        if (index === -1 && e.key.startsWith('Arrow')) {
          e.preventDefault();
          focusAndRevealAuto(cards[0]);
          return;
        }

        const total = cards.length;
        const row   = Math.floor(index / cols);
        const col   = index % cols;
        const lastRow = Math.floor((total - 1) / cols);
        const lastRowStart = lastRow * cols;

        switch (e.key) {
          case 'ArrowDown': {
            e.preventDefault();
            if (row < lastRow) {
              // –ö–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–¥ –Ω–∞–º–∏
              const nextIndex = (row + 1) * cols + col;
              const targetIndex = (nextIndex < total) ? nextIndex : Math.min(lastRowStart + col, total - 1);
              focusAndRevealAuto(cards[targetIndex]);
            } else {
              // –£–∂–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–µ ‚Äî —É—Ö–æ–¥–∏–º –Ω–∞ ¬´–ó–∞–∫—Ä—ã—Ç—å¬ª
              lastIndexBeforeFooter = index;
              cards[index]?.classList.remove('selected');
              if (closeBtn) focusAndRevealAuto(closeBtn);
            }
            break;
          }
          case 'ArrowUp': {
            e.preventDefault();
            if (row === 0) {
              lastIndexBeforeHeader = index;
              cards[index]?.classList.remove('selected');
              headerBtn?.focus({ preventScroll: true });
            } else {
              const prevIndex = (row - 1) * cols + col;
              focusAndRevealAuto(cards[prevIndex]);
            }
            break;
          }
          case 'ArrowLeft': {
            e.preventDefault();
            if (col === 0) return;
            const target = index - 1;
            if (target >= 0) focusAndRevealAuto(cards[target]);
            break;
          }
          case 'ArrowRight': {
            e.preventDefault();
            const inRowEnd = (col === cols - 1) || (index + 1 >= total);
            if (inRowEnd) return;
            focusAndRevealAuto(cards[index + 1]);
            break;
          }
          case 'Enter':
            e.preventDefault(); active?.click(); break;
          case 'Back':
          case 'Escape':
            e.preventDefault(); closeAutostartModal(); break;
        }
      });
    })();

    // misc modal open/close
    function openMiscModal(triggerBtn=null) {
      lastFocusedElement = document.activeElement;
      const modal = document.getElementById("miscModal");

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–∫–æ–Ω–∫–æ–π –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏–∑ –∫–Ω–æ–ø–∫–∏-—Ç—Ä–∏–≥–≥–µ—Ä–∞ (fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π h3, –µ—Å–ª–∏ #miscHeader –Ω–µ—Ç)
      const header = document.getElementById('miscHeader');
      if (header) {
        header.innerHTML = '';
        header.style.display = 'flex';
        header.style.gap = '8px';
        header.style.alignItems = 'center';
        header.style.justifyContent = 'center';
        try {
          const btn = triggerBtn || document.querySelector('.system-buttons .sys-btn[onclick*="openMiscModal"]');
          const img = btn?.querySelector('img');
          const titleText = btn?.innerText?.trim() || '–†–∞–∑–Ω–æ–µ';
          if (img) {
            const icon = document.createElement('img');
            icon.src = img.src;
            icon.alt = '';
            icon.style.height = '25px';
            icon.style.width = '25px';
            icon.style.objectFit = 'contain';
            header.appendChild(icon);
          }
          const title = document.createElement('span');
          title.textContent = titleText;
          header.appendChild(title);
        } catch(e) {
          header.textContent = '–†–∞–∑–Ω–æ–µ';
        }
      }
      modal.style.display = "flex";
      document.body.classList.add("modal-open");
      document.activeElement?.blur();
      const firstBtn = modal.querySelector('.sys-btn');
      if (firstBtn) setTimeout(() => firstBtn.focus(), 100); else modal.focus();
    }
    function closeMiscModal(restoreFocus = true) {
      const modal = document.getElementById("miscModal");
      if (!modal) return;
      modal.style.display = "none";
      document.body.classList.remove("modal-open");
      // –°–±—Ä–æ—Å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –≤–Ω—É—Ç—Ä–∏ ¬´–†–∞–∑–Ω–æ–µ¬ª, —á—Ç–æ–±—ã –Ω–µ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å —Ñ–∏–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
      modal.querySelectorAll('.misc-buttons-container .sys-btn.selected').forEach(b => b.classList.remove('selected'));
      if (restoreFocus) {
        setTimeout(() => {
          if (lastFocusedElement && document.body.contains(lastFocusedElement)) lastFocusedElement.focus?.();
          lastFocusedElement = null;
        }, 50);
      }
    }

    function openMiscMoreModal(triggerBtn = null) {
      const mainModal = document.getElementById("miscModal");
      const moreModal = document.getElementById("miscMoreModal");
      if (!moreModal) return;

      lastFocusedElementMiscMore = triggerBtn || document.activeElement;

      const header = document.getElementById('miscMoreHeader');
      if (header) {
        header.innerHTML = '';
        header.style.display = 'flex';
        header.style.alignItems = 'center';
        header.style.justifyContent = 'center';
        header.style.gap = '8px';
        const btn = triggerBtn || document.querySelector('#miscModal .sys-btn[onclick*="openMiscMoreModal"]');
        const img = btn?.querySelector('img');
        const titleText = btn?.innerText?.trim() || '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏';
        if (img) {
          const icon = document.createElement('img');
          icon.src = img.src;
          icon.alt = '';
          icon.style.height = '25px';
          icon.style.width = '25px';
          icon.style.objectFit = 'contain';
          header.appendChild(icon);
        }
        const title = document.createElement('span');
        title.textContent = titleText;
        header.appendChild(title);
      }

      if (mainModal) {
        mainModal.setAttribute("inert", "");
        mainModal.style.pointerEvents = "none";
      }

      document.activeElement?.blur();
      moreModal.style.display = "flex";
      document.body.classList.add("modal-open");

      const scrollContainer = moreModal.querySelector('.misc-buttons-container');
      if (scrollContainer) {
        scrollContainer.scrollTop = 0;
      }

      const firstBtn = moreModal.querySelector('.sys-btn');
      if (firstBtn) setTimeout(() => firstBtn.focus({ preventScroll: true }), 100);
      else moreModal.focus();
    }

    function closeMiscMoreModal() {
      const mainModal = document.getElementById("miscModal");
      const moreModal = document.getElementById("miscMoreModal");
      if (!moreModal) return;

      moreModal.style.display = "none";
      document.body.classList.remove("modal-open");

      if (mainModal) {
        mainModal.removeAttribute("inert");
        mainModal.style.pointerEvents = "";
        document.body.classList.add("modal-open");
      }

      setTimeout(() => {
        if (lastFocusedElementMiscMore && document.body.contains(lastFocusedElementMiscMore)) {
          lastFocusedElementMiscMore.focus?.({ preventScroll: true });
        }
        lastFocusedElementMiscMore = null;
      }, 50);
    }

    (function attachMiscMoreNavOnce(){
      if (window.__miscMoreNavBound) return;
      window.__miscMoreNavBound = true;

      function focusAndRevealMore(el, margin = 12) {
        if (!el) return;
        const container = document.querySelector('#miscMoreModal .misc-buttons-container');
        if (!container) return;
        const cr = container.getBoundingClientRect();
        const er = el.getBoundingClientRect();
        if (er.top < cr.top + margin) container.scrollTop -= (cr.top + margin - er.top);
        else if (er.bottom > cr.bottom - margin) container.scrollTop += (er.bottom - (cr.bottom - margin));
        requestAnimationFrame(() => el.focus({ preventScroll: true }));
      }

      document.addEventListener('keydown', function (e) {
        const modal = document.getElementById('miscMoreModal');
        if (!modal || modal.style.display !== 'flex') return;

        const installModal = document.getElementById('installMethodModal');
        if (installModal && installModal.style.display === 'flex') return;

        e.stopPropagation();
        e.stopImmediatePropagation();

        const buttons = Array.from(modal.querySelectorAll('.misc-buttons-container .sys-btn'));
        if (!buttons.length) {
          if (e.key === 'Back' || e.key === 'Escape') {
            e.preventDefault();
            closeMiscMoreModal();
          }
          return;
        }

        const active = document.activeElement;
        const index = buttons.indexOf(active);
        const cols = (() => {
          if (buttons.length < 2) return 1;
          const firstTop = buttons[0].getBoundingClientRect().top;
          let c = 1;
          for (let i = 1; i < buttons.length; i++) {
            if (Math.abs(buttons[i].getBoundingClientRect().top - firstTop) < 5) c++;
            else break;
          }
          return c;
        })();

        if (index === -1 && e.key.startsWith('Arrow')) {
          e.preventDefault();
          focusAndRevealMore(buttons[0]);
          return;
        }

        const total = buttons.length;
        const row   = Math.floor(index / cols);
        const col   = index % cols;
        const lastRow = Math.floor((total - 1) / cols);
        const lastRowStart = lastRow * cols;

        switch (e.key) {
          case 'ArrowDown': {
            e.preventDefault();
            if (row < lastRow) {
              const nextIndex = (row + 1) * cols + col;
              const targetIndex = (nextIndex < total) ? nextIndex : Math.min(lastRowStart + col, total - 1);
              focusAndRevealMore(buttons[targetIndex]);
            }
            break;
          }
          case 'ArrowUp': {
            e.preventDefault();
            if (row === 0) return;
            const prevIndex = (row - 1) * cols + col;
            focusAndRevealMore(buttons[prevIndex]);
            break;
          }
          case 'ArrowLeft': {
            e.preventDefault();
            if (col === 0) return;
            focusAndRevealMore(buttons[index - 1]);
            break;
          }
          case 'ArrowRight': {
            e.preventDefault();
            if ((col === cols - 1) || (index + 1 >= total)) return;
            focusAndRevealMore(buttons[index + 1]);
            break;
          }
          case 'Enter':
            e.preventDefault();
            active?.click();
            break;
          case 'Back':
          case 'Escape':
            e.preventDefault();
            closeMiscMoreModal();
            break;
        }
      });
    })();

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –º–æ–¥–∞–ª–∫–µ "–†–∞–∑–Ω–æ–µ" 
    (function attachMiscNavOnce(){
      if (window.__miscNavBound) return;
      window.__miscNavBound = true;

      let lastIndexBeforeFooter = null;

      function focusAndReveal(el, margin = 12) {
        if (!el) return;
        const container = document.querySelector('#miscModal .misc-buttons-container');
        if (!container) return;
        const cr = container.getBoundingClientRect();
        const er = el.getBoundingClientRect();
        if (er.top < cr.top + margin) container.scrollTop -= (cr.top + margin - er.top);
        else if (er.bottom > cr.bottom - margin) container.scrollTop += (er.bottom - (cr.bottom - margin));
        requestAnimationFrame(() => el.focus({ preventScroll: true }));
      }
      // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å—Ç—Ä–æ–≥–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ñ–æ–∫—É—Å–æ–º
      const misc = document.getElementById('miscModal');
      misc?.addEventListener('focusin', (e)=>{
        const modal = document.getElementById('miscModal');
        if (!modal) return;
        modal.querySelectorAll('.misc-buttons-container .sys-btn.selected').forEach(b => b.classList.remove('selected'));
        const btn = e.target.closest('.misc-buttons-container .sys-btn');
        if (btn) btn.classList.add('selected');
      });
      // –ü—Ä–∏ –∫–ª–∏–∫–µ –ø—Ä–∏–≤–æ–¥–∏–º —Ñ–æ–∫—É—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ, —á—Ç–æ–±—ã –Ω–µ —Ä–∞—Å—Ö–æ–¥–∏–ª—Å—è —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
      misc?.addEventListener('click', (e)=>{
        const btn = e.target.closest('.misc-buttons-container .sys-btn');
        if (btn) btn.focus({ preventScroll: true });
      }, true);

      document.addEventListener('keydown', function (e) {
        const modal = document.getElementById('miscModal');
        if (!modal || modal.style.display !== 'flex') return;
        const childModal = document.getElementById('miscMoreModal');
        if (childModal && childModal.style.display === 'flex') return;
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –º–æ–¥–∞–ª–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
        const installModal = document.getElementById('installMethodModal');
        if (installModal && installModal.style.display === 'flex') {
          // –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –º–æ–¥–∞–ª–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
          return;
        }

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º
        if (e.defaultPrevented) return;

        e.stopPropagation();
        e.stopImmediatePropagation();

        const buttons = Array.from(modal.querySelectorAll('.misc-buttons-container .sys-btn'));
        if (!buttons.length) return;

        // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–ª–æ–Ω–æ–∫ –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫
        function getColumnsCount(buttons) {
          if (buttons.length < 2) return 1;
          const firstTop = buttons[0].getBoundingClientRect().top;
          let cols = 1;
          for (let i = 1; i < buttons.length; i++) {
            if (Math.abs(buttons[i].getBoundingClientRect().top - firstTop) < 5) {
              cols++;
            } else break;
          }
          return cols;
        }
        const cols = getColumnsCount(buttons);
        const active = document.activeElement;

        // –û–±—ã—á–Ω–∞—è —Å–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
        const index = buttons.indexOf(active);
        if (index === -1 && e.key.startsWith('Arrow')) {
          e.preventDefault();
          focusAndReveal(buttons[0]);
          return;
        }

        const total = buttons.length;
        const row   = Math.floor(index / cols);
        const col   = index % cols;
        const lastRow = Math.floor((total - 1) / cols);
        const lastRowStart = lastRow * cols;

        switch (e.key) {
          case 'ArrowDown': {
            e.preventDefault();
            if (row < lastRow) {
              const nextIndex = (row + 1) * cols + col;
              const targetIndex = (nextIndex < total) ? nextIndex : Math.min(lastRowStart + col, total - 1);
              focusAndReveal(buttons[targetIndex]);
            }
            // –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∫–Ω–æ–ø–∫–µ "–ó–∞–∫—Ä—ã—Ç—å" - –µ—ë –±–æ–ª—å—à–µ –Ω–µ—Ç
            break;
          }
          case 'ArrowUp': {
            e.preventDefault();
            if (row === 0) return; // —É–ø–æ—Ä –≤–≤–µ—Ä—Ö—É
            const prevIndex = (row - 1) * cols + col;
            focusAndReveal(buttons[prevIndex]);
            break;
          }
          case 'ArrowLeft': {
            e.preventDefault();
            if (col === 0) return;
            const target = index - 1;
            if (target >= 0) focusAndReveal(buttons[target]);
            break;
          }
          case 'ArrowRight': {
            e.preventDefault();
            const inRowEnd = (col === cols - 1) || (index + 1 >= total);
            if (inRowEnd) return;
            focusAndReveal(buttons[index + 1]);
            break;
          }
          case 'Enter':
            e.preventDefault(); active?.click(); break;
          case 'Back':
          case 'Escape':
            e.preventDefault(); closeMiscModal(); break;
        }
      });
    })();

  </script>
<script>
// 1) –†–µ–∂–µ–º –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä –∫–ª–∞–≤–∏—à–∏ Enter/OK –ø–æ –≤—Å–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é (CAPTURE + immediate)
document.addEventListener('keydown', function(e) {
  const isEnter = (e.key === 'Enter' || e.code === 'Enter' || e.key === 'NumpadEnter' || e.key === 'OK');
  if (isEnter && e.repeat) {
    e.preventDefault();
    e.stopImmediatePropagation();
  }
}, true);

// 2) –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–µ–±–∞—É–Ω—Å ¬´–∫–ª–∏–∫–æ–≤ –æ—Ç —É–¥–µ—Ä–∂–∞–Ω–∏—è¬ª ‚Äî –ø–µ—Ä-—ç–ª–µ–º–µ–Ω—Ç–Ω—ã–π
const __lastClickByEl = new WeakMap();
document.addEventListener('click', function(e) {
  const target = e.target.closest('button, [role="button"], .component-btn, #installAllBtn');
  if (!target) return;
  const now = Date.now();
  const last = __lastClickByEl.get(target) || 0;
  const interval = 700; // –º–æ–∂–Ω–æ 500..900 –º—Å

  if (now - last < interval) {
    e.preventDefault();
    e.stopImmediatePropagation();
    return;
  }
  __lastClickByEl.set(target, now);
}, true);

// –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–∞–∫ –º–æ–¥–∞–ª–∫–∞ "–†–∞–∑–Ω–æ–µ")
function showInstallMethodSettings() {
    lastFocusedElement = document.activeElement;
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    const currentMethod = window.AndroidInterface?.getInstallMethod?.() || 'sai';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥ –≤ —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏
    const radioBtn = document.getElementById('method_' + currentMethod);
    if (radioBtn) {
        radioBtn.checked = true;
        document.querySelectorAll('#installMethodModal .method-option').forEach(option => option.classList.remove('selected'));
        radioBtn.closest('.method-option')?.classList.add('selected');
    }
    
    // freeze –†–∞–∑–Ω–æ–µ, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ
    const misc = document.getElementById('miscModal');
    if (misc && misc.style.display === 'flex') {
      misc.setAttribute('inert', '');
      misc.style.pointerEvents = 'none';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
    const modal = document.getElementById("installMethodModal");
    modal.style.display = "flex";
    document.body.classList.add("modal-open");
    document.activeElement?.blur();
    const firstOption = modal.querySelector('.method-option');
    if (firstOption) setTimeout(() => firstOption.focus(), 100); else modal.focus();
}

// –ó–∞–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–∞–∫ –º–æ–¥–∞–ª–∫–∞ "–†–∞–∑–Ω–æ–µ")
function closeInstallMethodSettings() {
    const modal = document.getElementById("installMethodModal");
    modal.style.display = "none";
    document.body.classList.remove("modal-open");
    
    // unfreeze –†–∞–∑–Ω–æ–µ
    const misc = document.getElementById('miscModal');
    if (misc) { 
      misc.removeAttribute('inert'); 
      misc.style.pointerEvents = ''; 
    }
    
    setTimeout(() => { if (lastFocusedElement && document.body.contains(lastFocusedElement)) lastFocusedElement.focus?.(); lastFocusedElement = null; }, 50);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
document.addEventListener('DOMContentLoaded', function() {
    const radioButtons = document.querySelectorAll('input[name="install_method"]');
    
    radioButtons.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.checked) {
                selectInstallMethod(this.value, this.closest('.method-option'));
            }
        });
    });
});

// –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –º–æ–¥–∞–ª–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–∞–∫ –º–æ–¥–∞–ª–∫–∞ "–†–∞–∑–Ω–æ–µ")
(function attachInstallMethodNavOnce(){
  if (window.__installMethodNavBound) return;
  window.__installMethodNavBound = true;

  let lastIndexBeforeFooter = null;
  
  // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Back —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
  window.addEventListener('keydown', function (e) {
    if (e.key === 'Back' || e.key === 'Escape') {
      const installModal = document.getElementById('installMethodModal');
      if (installModal && installModal.style.display === 'flex') {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        closeInstallMethodSettings();
        return;
      }
    }
  }, true);

  document.addEventListener('keydown', function (e) {
    const modal = document.getElementById('installMethodModal');
    if (!modal || modal.style.display !== 'flex') return;

    // –ë–ª–æ–∫–∏—Ä—É–µ–º –í–°–ï —Å–æ–±—ã—Ç–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –º–æ–¥–∞–ª–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    e.preventDefault();
    e.stopPropagation();
    e.stopImmediatePropagation();
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Back
    if (e.key === 'Back' || e.key === 'Escape') {
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();
    }

    const options = Array.from(document.querySelectorAll('#installMethodModal .method-option'));
    const closeBtn = document.querySelector('#installMethodModal .sys-btn');
    if (!options.length) return;

    const cols = 1; // 1 –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    const active = document.activeElement;

    // –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å"
    if (active === closeBtn) {
      switch (e.key) {
        case 'ArrowUp': {
          const total = options.length;
          const lastRow = Math.floor((total - 1) / cols);
          const lastRowStart = lastRow * cols;
          const col = (lastIndexBeforeFooter != null) ? (lastIndexBeforeFooter % cols) : 0;
          const targetIndex = Math.min(lastRowStart + col, total - 1);
          options[targetIndex]?.focus({ preventScroll: true });
          break;
        }
        case 'ArrowDown':
        case 'ArrowLeft':
        case 'ArrowRight':
          break;
        case 'Enter':
          closeBtn.click(); break;
        case 'Back':
        case 'Escape':
          closeInstallMethodSettings(); break;
      }
      return;
    }

    // –û–±—ã—á–Ω–∞—è —Å–µ—Ç–∫–∞ –æ–ø—Ü–∏–π
    const index = options.indexOf(active);
    if (index === -1 && e.key.startsWith('Arrow')) {
      options[0]?.focus({ preventScroll: true });
      return;
    }

    const total = options.length;
    const row   = Math.floor(index / cols);
    const col   = index % cols;
    const lastRow = Math.floor((total - 1) / cols);
    const lastRowStart = lastRow * cols;

    switch (e.key) {
      case 'ArrowDown': {
        if (row < lastRow) {
          const nextIndex = (row + 1) * cols + col;
          const targetIndex = (nextIndex < total) ? nextIndex : Math.min(lastRowStart + col, total - 1);
          options[targetIndex]?.focus({ preventScroll: true });
        } else {
          lastIndexBeforeFooter = index;
          closeBtn?.focus({ preventScroll: true });
        }
        break;
      }
      case 'ArrowUp': {
        if (row === 0) return; // —É–ø–æ—Ä –≤–≤–µ—Ä—Ö—É
        const prevIndex = (row - 1) * cols + col;
        options[prevIndex]?.focus({ preventScroll: true });
        break;
      }
      case 'ArrowLeft':
      case 'ArrowRight':
        break; // –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
      case 'Enter':
        if (index >= 0) {
          const method = options[index].querySelector('input[type="radio"]').value;
          selectInstallMethod(method, options[index]);
        }
        break;
      case 'Back':
      case 'Escape':
        closeInstallMethodSettings(); break;
    }
  }, true); // –î–æ–±–∞–≤–ª—è–µ–º capture: true –¥–ª—è –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
})();

function selectInstallMethod(method, targetElement = null) {
  if (__installMethodApplying) return;
  __installMethodApplying = true;
  try {
    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –æ–ø—Ü–∏–π
    document.querySelectorAll('#installMethodModal .method-option').forEach(option => {
      option.classList.remove('selected');
    });

    const radio = document.getElementById('method_' + method);
    const target = targetElement || radio?.closest('.method-option');

    if (target) {
      target.classList.add('selected');
    }

    if (radio && !radio.checked) {
      radio.checked = true;
    }

    if (window.AndroidInterface && window.AndroidInterface.setInstallMethod) {
      window.AndroidInterface.setInstallMethod(method);
    }
  } finally {
    setTimeout(() => { __installMethodApplying = false; }, 0);
  }
}

  
</script>

	<script>
  function openExternal(url) {
    try {
      if (window.AndroidInterface) {
        if (typeof AndroidInterface.openExternalLink === 'function') {
          AndroidInterface.openExternalLink(url);   // –≤–∞—à –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
          return;
        }
        if (typeof AndroidInterface.openLink === 'function') {
          AndroidInterface.openLink(url);
          return;
        }
        if (typeof AndroidInterface.openUrl === 'function') {
          AndroidInterface.openUrl(url);
          return;
        }
      }
    } catch (e) { console.log(e); }
    // –§–æ–ª–±—ç–∫: –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ WebView, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å shouldOverrideUrlLoading
    window.location.href = url;
  }
	 function openInternal(url) {
    try {
      if (window.AndroidInterface && typeof AndroidInterface.openInternalLink === 'function') {
        AndroidInterface.openInternalLink(url);
        return;
      }
    } catch(e){ console.log(e); }

    window.location.assign(url);
  }
</script>

<!-- –ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–µ—Ç–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ -->
<div id="installMethodModal" class="modal" style="display:none;" tabindex="-1">
  <div class="modal-content">
    <h3>–°–ø–æ—Å–æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–∏:</h3>
    <div class="install-method-settings">
      <div class="method-option" onclick="selectInstallMethod('sai', this)" tabindex="0">
        <input type="radio" id="method_sai" name="install_method" value="sai" checked>
        <label for="method_sai">
          <strong>–ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞</strong><br>
          <small>FAST-–º–µ—Ç–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</small>
        </label>
      </div>
      <div class="method-option" onclick="selectInstallMethod('standard', this)" tabindex="0">
        <input type="radio" id="method_standard" name="install_method" value="standard">
        <label for="method_standard">
          <strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞</strong><br>
          <small>–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –ø–∞–∫–µ—Ç–æ–≤</small>
        </label>
      </div>
      <div class="method-option" onclick="selectInstallMethod('adb', this)" tabindex="0">
        <input type="radio" id="method_adb" name="install_method" value="adb">
        <label for="method_adb">
          <strong>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ ADB</strong><br>
          <small>–¢—Ä–µ–±—É–µ—Ç—Å—è –≤ –º–µ–Ω—é –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤–∫–ª—é—á–∏—Ç—å ¬´–û—Ç–ª–∞–¥–∫—É –ø–æ USB</small>
        </label>
      </div>
    </div>
    <button onclick="closeInstallMethodSettings()" class="sys-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>
  
  
</body>
</html>

